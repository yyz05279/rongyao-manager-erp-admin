# 海棠企业管理系统 - Excel数据导入功能

## 功能概述

本模块为海棠企业管理系统的盐化工艺数据记录模块提供Excel导入功能，支持两种类型的数据表格：

1. **熔盐入库统计表** - 记录钠盐、钾盐的入库数据
2. **化盐量记录表** - 记录化盐工艺过程的详细数据

## 功能特性

### 🚀 核心功能
- **智能识别**: 自动识别Excel文件类型（熔盐入库统计表/化盐量记录表）
- **数据预览**: 导入前预览数据，支持错误检查和数据验证
- **自动计算**: 根据规格自动计算缺失字段
  - 钠盐规格：1.2吨/袋
  - 钾盐规格：1.0吨/袋
- **数据验证**: 完整的数据验证规则，确保数据质量
- **错误处理**: 详细的错误信息提示，帮助用户修正数据

### 📊 数据展示
- **统计概览**: 显示总记录数、有效记录、错误记录等统计信息
- **筛选功能**: 支持按日期范围、记录人、重量范围等条件筛选
- **分页显示**: 大数据量时支持分页展示
- **数据导出**: 支持将处理后的数据导出为Excel文件

### 🔧 技术特性
- **Vue 3 + TypeScript**: 使用最新的Vue 3 Composition API和TypeScript
- **Element Plus**: 基于Element Plus UI组件库
- **XLSX.js**: 使用XLSX.js库处理Excel文件
- **响应式设计**: 支持不同屏幕尺寸的设备

## 文件结构

```
src/views/erp/saltprocess/records/excel-import/
├── index.vue                          # 主页面
├── components/
│   ├── EnhancedImportDialog.vue       # 增强的导入对话框
│   └── DataDisplayTable.vue          # 数据展示表格组件
├── test-data.ts                       # 测试数据
└── README.md                          # 说明文档

src/api/erp/saltprocess/records/excel-import/
└── types.ts                          # 类型定义

src/utils/
├── excel-parser.ts                    # Excel解析工具类
└── salt-calculator.ts                # 盐化工艺计算工具
```

## 使用方法

### 1. 访问功能
在系统中导航到：**化盐工艺流程 > Excel数据导入**

### 2. 导入Excel文件
1. 点击"导入Excel数据"按钮
2. 选择或拖拽Excel文件到上传区域
3. 系统自动识别文件类型并显示文件信息
4. 预览数据并检查是否有错误
5. 点击"开始导入"完成数据导入

### 3. 查看和管理数据
- 使用数据类型切换按钮在不同类型数据间切换
- 使用筛选功能查找特定数据
- 导出处理后的数据

## 支持的Excel格式

### 熔盐入库统计表
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| 日期 | 日期 | ✓ | 记录日期，格式：YYYY-MM-DD |
| 钠（单位：袋） | 数字 | ✓ | 钠盐袋数，必须≥0 |
| 钾（单位：袋） | 数字 | ✓ | 钾盐袋数，必须≥0 |
| 总粉碎量 | 数字 | - | 总粉碎量，可自动计算 |
| 备注 | 文本 | - | 备注信息 |

**系统自动生成字段：**
- 记录编码：系统自动生成，格式：TEMP_YYYYMMDDHHMMSS_XXXX_行号
- 批次号：系统自动生成，格式：BATCH_YYYYMMDD_行号

**自动计算字段：**
- 钠重量(吨) = 钠袋数 × 1.2
- 钾重量(吨) = 钾袋数 × 1.0
- 总重量(吨) = 钠重量 + 钾重量

### 化盐量记录表
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| 序号 | 数字 | ✓ | 记录序号，必须>0 |
| 日期 | 日期 | ✓ | 记录日期 |
| 垃圾 | 数字 | ✓ | 垃圾处理量 |
| 硝酸钠 | 数字 | - | 硝酸钠用量 |
| 硝酸钾 | 数字 | - | 硝酸钾用量 |
| 每垃圾化盐量 | 数字 | - | 单位垃圾的化盐量 |
| 累积化盐量 | 数字 | - | 累计化盐量，可自动计算 |
| 熔盐罐熔盐温度 | 数字 | - | 温度(°C)，范围0-1000 |
| 熔盐罐熔盐液位 | 数字 | - | 液位(m)，必须≥0 |
| 每垃圾天然气耗量 | 数字 | - | 天然气消耗(Nm³) |
| 每垃圾用电量 | 数字 | - | 电力消耗(kWh) |
| 人数 | 数字 | - | 操作人员数量，必须>0 |
| 记录人 | 文本 | ✓ | 记录员姓名 |
| 备注 | 文本 | - | 备注信息 |

**系统自动生成字段：**
- 记录编码：系统自动生成，格式：TEMP_YYYYMMDDHHMMSS_XXXX_行号
- 批次号：系统自动生成，格式：BATCH_YYYYMMDD_行号

**自动计算字段：**
- 总硝酸盐 = 硝酸钠 + 硝酸钾
- 处理效率(%) = (每垃圾化盐量 / 垃圾量) × 100

## 数据验证规则

### 通用规则
- 必填字段不能为空
- 数字字段必须是有效数字
- 日期字段必须是有效日期格式

### 特定规则
- 袋数、重量、温度等必须≥0
- 温度范围：0-1000°C
- 人数必须>0
- 序号必须>0

## 错误处理

系统会在以下情况显示错误信息：
1. **文件格式错误**: 不支持的文件格式
2. **数据验证失败**: 字段值不符合验证规则
3. **解析错误**: Excel文件结构异常
4. **计算错误**: 自动计算过程中的错误

每个错误都会显示具体的行号、字段名和错误描述，帮助用户快速定位和修正问题。

## 性能优化

- 支持大文件导入（建议单次不超过10MB）
- 分批处理数据，避免浏览器卡顿
- 虚拟滚动支持大量数据展示
- 智能分页减少内存占用

## 浏览器兼容性

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## 常见问题

### Q: 为什么我的Excel文件无法识别类型？
A: 请确保Excel文件包含正确的表头信息，系统通过表头关键字自动识别文件类型。

### Q: 自动计算的字段可以手动修改吗？
A: 导入时自动计算的字段会覆盖Excel中的原始值，如需保留原始值，请在导入后手动调整。

### Q: 支持哪些Excel文件格式？
A: 支持.xlsx和.xls格式的Excel文件。

### Q: 导入的数据会保存到数据库吗？
A: 当前版本仅在前端展示，如需保存到数据库，请联系系统管理员配置后端接口。

## 更新日志

### v1.0.0 (2024-12-01)
- 初始版本发布
- 支持熔盐入库统计表和化盐量记录表导入
- 实现自动计算和数据验证功能
- 提供完整的数据展示和筛选功能
