# 物料明细接口数据结构规范

## 1. 接口信息

**接口路径**: `GET /erp/saltprocess/material/list`

**请求参数** (MaterialQuery):

```typescript
{
  pageNum?: number;      // 页码，默认1
  pageSize?: number;     // 每页数量，默认10
  projectId?: string;    // 项目ID（必填）
  materialName?: string; // 物料名称（模糊查询）
  materialType?: string; // 物料类型
  batchNumber?: string;  // 批次号
}
```

## 2. 响应数据结构

### 2.1 顶层结构

```json
{
  "code": 200,
  "msg": "查询成功",
  "rows": [],      // 物料明细数组
  "total": 0       // 总记录数
}
```

### 2.2 完整示例

```json
{
  "code": 200,
  "msg": "查询成功",
  "total": 156,
  "rows": [
    {
      "id": "1234567890123456789",
      "projectId": "1967857798821703681",
      "sequenceNumber": "001",
      "materialName": "变频器",
      "materialType": "ELECTRICAL",
      "specification": "380V 15KW",
      "quantity": 2,
      "unit": "台",
      "materialCategory": "304不锈钢",
      "manufacturer": "西门子",
      "model": "SINAMICS G120",
      "remarks1": "带制动单元",
      "remarks2": "IP65防护等级",
      "unitWeight": 45.5,
      "fileSource": "前端Excel解析-电控设备汇总",
      "sheetName": "电控设备汇总",
      "rowNumber": 5,
      "batchNumber": "1761529119887-电控设备汇总-Batch1",
      "createTime": "2025-10-27 09:38:40",
      "updateTime": "2025-10-27 09:38:42"
    },
    {
      "id": "1234567890123456790",
      "projectId": "1967857798821703681",
      "sequenceNumber": "002",
      "materialName": "搅拌电机",
      "materialType": "MECHANICAL",
      "specification": "22KW 380V",
      "quantity": 1,
      "unit": "台",
      "materialCategory": "铸钢",
      "manufacturer": "ABB",
      "model": "M2BAX180",
      "remarks1": "防爆型",
      "remarks2": null,
      "unitWeight": 120.0,
      "fileSource": "前端Excel解析-机械设备汇总",
      "sheetName": "机械设备汇总",
      "rowNumber": 8,
      "batchNumber": "1761529119887-机械设备汇总-Batch1",
      "createTime": "2025-10-27 09:38:44",
      "updateTime": "2025-10-27 09:38:45"
    },
    {
      "id": "1234567890123456791",
      "projectId": "1967857798821703681",
      "sequenceNumber": "003",
      "materialName": "法兰",
      "materialType": "GENERAL",
      "specification": "DN100 PN16",
      "quantity": 50,
      "unit": "件",
      "materialCategory": "碳钢",
      "manufacturer": "通用五金",
      "model": "HG20592",
      "remarks1": "对焊法兰",
      "remarks2": "国标",
      "unitWeight": 2.5,
      "fileSource": "前端Excel解析-通用物料汇总",
      "sheetName": "通用物料汇总",
      "rowNumber": 12,
      "batchNumber": "1761529119887-通用物料汇总-Batch1",
      "createTime": "2025-10-27 09:45:19",
      "updateTime": "2025-10-27 09:45:20"
    }
  ]
}
```

## 3. 字段说明

### 3.1 必填字段 (Required)

| 字段名         | 类型   | 说明             | 示例                  |
| -------------- | ------ | ---------------- | --------------------- |
| `id`           | string | 物料记录唯一 ID  | "1234567890123456789" |
| `projectId`    | string | 所属项目 ID      | "1967857798821703681" |
| `materialName` | string | 物料名称         | "变频器"              |
| `materialType` | string | 物料类型（枚举） | "ELECTRICAL"          |
| `quantity`     | number | 数量             | 2                     |
| `createTime`   | string | 创建时间         | "2025-10-27 09:38:40" |

### 3.2 可选字段 (Optional)

| 字段名             | 类型   | 说明             | 示例                                |
| ------------------ | ------ | ---------------- | ----------------------------------- |
| `sequenceNumber`   | string | 序号             | "001"                               |
| `specification`    | string | 规格型号         | "380V 15KW"                         |
| `unit`             | string | 单位             | "台", "套", "件", "个", "kg", "米"  |
| `materialCategory` | string | 材质/材料类别    | "304 不锈钢", "碳钢", "铸铁"        |
| `manufacturer`     | string | 制造商/供应商    | "西门子", "ABB"                     |
| `model`            | string | 型号             | "SINAMICS G120"                     |
| `remarks1`         | string | 备注 1           | "带制动单元"                        |
| `remarks2`         | string | 备注 2           | "IP65 防护等级"                     |
| `unitWeight`       | number | 单重(kg)         | 45.5                                |
| `fileSource`       | string | 数据来源         | "前端 Excel 解析-电控设备汇总"      |
| `sheetName`        | string | Excel Sheet 名称 | "电控设备汇总"                      |
| `rowNumber`        | number | Excel 行号       | 5                                   |
| `batchNumber`      | string | 批次号           | "1761529119887-电控设备汇总-Batch1" |
| `updateTime`       | string | 更新时间         | "2025-10-27 09:38:42"               |

## 4. 枚举值定义

### 4.1 物料类型 (materialType)

| 枚举值           | 中文名称 | 说明                       |
| ---------------- | -------- | -------------------------- |
| `GENERAL`        | 通用物料 | 标准件、辅料等             |
| `MECHANICAL`     | 机械设备 | 机械类设备、装置           |
| `ELECTRICAL`     | 电控设备 | 电气、控制类设备           |
| `PIPELINE`       | 管路设备 | 管道、管件、阀门等         |
| `BURNER`         | 燃烧器   | 燃烧器及配件               |
| `AUXILIARY`      | 辅助设备 | 辅助类设备                 |
| `STANDARD_PARTS` | 标准件   | 螺栓、螺母等标准件         |
| `SHIPPING_INFO`  | 发货信息 | 发货清单信息（通常不显示） |

### 4.2 常用单位 (unit)

推荐值：`"台"`, `"套"`, `"件"`, `"个"`, `"支"`, `"根"`, `"米"`, `"kg"`, `"吨"`, `"升"`, `"立方米"`

## 5. TypeScript 类型定义

```typescript
/**
 * 物料视图对象
 */
export interface MaterialVO {
  // === 必填字段 ===
  id: string;                    // 物料记录ID
  projectId: string;             // 项目ID
  materialName: string;          // 物料名称
  materialType: string;          // 物料类型（枚举）
  quantity: number;              // 数量
  createTime: string;            // 创建时间 (格式: "YYYY-MM-DD HH:mm:ss")

  // === 可选字段 ===
  sequenceNumber?: string;       // 序号
  specification?: string;        // 规格型号
  unit?: string;                 // 单位
  materialCategory?: string;     // 材质/材料类别
  manufacturer?: string;         // 制造商
  model?: string;                // 型号
  remarks1?: string;             // 备注1
  remarks2?: string;             // 备注2
  unitWeight?: number;           // 单重(kg)
  fileSource?: string;           // 数据来源
  sheetName?: string;            // Excel Sheet名称
  rowNumber?: number;            // Excel行号
  batchNumber?: string;          // 批次号
  updateTime?: string;           // 更新时间 (格式: "YYYY-MM-DD HH:mm:ss")

  // === 前端临时字段（不需要后端返回）===
  hasErrors?: boolean;           // 是否有错误
  hasWarnings?: boolean;         // 是否有警告
  errors?: Record<string, string>; // 错误信息
  warnings?: Record<string, string>; // 警告信息
}

/**
 * 查询参数
 */
export interface MaterialQuery {
  pageNum?: number;              // 页码
  pageSize?: number;             // 每页数量
  projectId?: string;            // 项目ID
  materialName?: string;         // 物料名称（模糊查询）
  materialType?: string;         // 物料类型
  batchNumber?: string;          // 批次号
}

/**
 * 分页响应
 */
export interface MaterialListResponse {
  code: number;                  // 响应码 (200: 成功)
  msg: string;                   // 响应消息
  total: number;                 // 总记录数
  rows: MaterialVO[];            // 物料列表
}
```

## 6. 前端页面展示字段

### 6.1 物料列表表格显示的字段

```
1. 序号 (sequenceNumber) - 显示
2. 物料名称 (materialName) - 显示 ✓ 必填
3. 规格型号 (specification) - 显示
4. 数量 (quantity) - 显示 ✓ 必填
5. 单位 (unit) - 显示
6. 物料类型 (materialType) - 显示为标签 ✓ 必填
7. 材质 (materialCategory) - 显示
8. 制造商 (manufacturer) - 显示
9. 备注1 (remarks1) - 显示
10. 创建时间 (createTime) - 显示 ✓ 必填
11. 操作 (删除按钮)
```

### 6.2 按 Sheet 分组显示

前端会按照 `sheetName` 字段对物料进行分组展示，例如：

- "电控设备汇总" 标签页
- "机械设备汇总" 标签页
- "通用物料汇总" 标签页

所以请确保同一批导入的物料有相同的 `sheetName` 值。

## 7. 关键注意事项

### 7.1 数据结构要点

1. ✅ **顶层必须包含 `rows` 数组和 `total` 字段**

   ```json
   {
     "code": 200,
     "msg": "查询成功",
     "rows": [...],
     "total": 156
   }
   ```

2. ✅ **ID 字段必须叫 `id`**，不要用 `materialId` 或其他名称

3. ✅ **时间格式**: `"YYYY-MM-DD HH:mm:ss"`

   - 正确: `"2025-10-27 09:38:40"`
   - 错误: `"2025-10-27T09:38:40.123456"`

4. ✅ **数值类型**: `quantity` 和 `unitWeight` 必须是 **number** 类型，不要用字符串

5. ✅ **枚举值**: `materialType` 使用大写英文，如 `"ELECTRICAL"`、`"MECHANICAL"`

### 7.2 字段要求总结

| 重要程度     | 字段列表                                                                                                                                     |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------- |
| **必须有**   | `id`, `projectId`, `materialName`, `materialType`, `quantity`, `createTime`                                                                  |
| **强烈建议** | `specification`, `unit`, `sheetName`, `batchNumber`                                                                                          |
| **可选**     | `sequenceNumber`, `materialCategory`, `manufacturer`, `model`, `remarks1`, `remarks2`, `unitWeight`, `fileSource`, `rowNumber`, `updateTime` |

## 8. 测试数据示例

### 8.1 最小完整数据

```json
{
  "code": 200,
  "msg": "查询成功",
  "total": 1,
  "rows": [
    {
      "id": "1234567890",
      "projectId": "1967857798821703681",
      "materialName": "测试物料",
      "materialType": "GENERAL",
      "quantity": 10,
      "createTime": "2025-10-27 10:00:00"
    }
  ]
}
```

### 8.2 推荐完整数据

```json
{
  "code": 200,
  "msg": "查询成功",
  "total": 1,
  "rows": [
    {
      "id": "1234567890",
      "projectId": "1967857798821703681",
      "sequenceNumber": "001",
      "materialName": "测试物料",
      "materialType": "GENERAL",
      "specification": "DN100",
      "quantity": 10,
      "unit": "件",
      "materialCategory": "不锈钢",
      "manufacturer": "某某厂",
      "sheetName": "通用物料汇总",
      "batchNumber": "1761529119887-通用物料汇总-Batch1",
      "createTime": "2025-10-27 10:00:00",
      "updateTime": "2025-10-27 10:00:00"
    }
  ]
}
```

## 9. 常见错误

### ❌ 错误示例 1: 使用 records 而不是 rows

```json
{
  "code": 200,
  "msg": "查询成功",
  "total": 10,
  "records": [...]  // ❌ 错误！应该是 rows
}
```

### ❌ 错误示例 2: ID 字段名不对

```json
{
  "materialId": "123",  // ❌ 错误！应该是 id
  "materialName": "..."
}
```

### ❌ 错误示例 3: 数量用字符串

```json
{
  "quantity": "10"  // ❌ 错误！应该是数字 10
}
```

### ❌ 错误示例 4: 时间格式不对

```json
{
  "createTime": "2025-10-27T09:38:40.123456"  // ❌ 前端显示可能有问题
}
```

✅ **正确格式**:

```json
{
  "createTime": "2025-10-27 09:38:40"  // ✅ 正确
}
```

## 10. 接口联调检查清单

- [ ] 响应包含 `rows` 数组
- [ ] 响应包含 `total` 总数
- [ ] 每条记录有 `id` 字段
- [ ] `materialName` 不为空
- [ ] `materialType` 使用正确的枚举值
- [ ] `quantity` 是数字类型
- [ ] `createTime` 格式正确
- [ ] 能按 `projectId` 筛选
- [ ] 能按 `sheetName` 分组显示
- [ ] 分页参数 `pageNum` 和 `pageSize` 生效

## 11. 联系方式

如有疑问，请联系前端开发团队进行确认。

---

**文档版本**: v1.0  
**更新日期**: 2025-10-27  
**维护人**: AI 助手
