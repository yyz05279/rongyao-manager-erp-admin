# 物料包装规格管理使用指南

## 1. 功能概述

物料包装规格管理功能支持以下业务场景：

### 业务场景
- **进货**：物料以包装单位进货（如：500颗/袋、100个/箱）
- **出库**：物料以基础单位出库（如：100颗、50个）
- **库存管理**：系统自动计算总数量、总重量、总体积

### 核心功能
1. ✅ 支持包装规格定义（包装数量、包装单位、基础单位）
2. ✅ 自动计算总数量、总重量、总体积
3. ✅ 支持批次管理（序列号、生产日期、过期日期）
4. ✅ 兼容无包装规格的物料（如设备、机械等）

---

## 2. 字段说明

### 2.1 包装规格字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| **packageQuantity** | Integer | 否 | 包装数量（每包/每箱的数量） | 500 |
| **packageUnit** | String | 条件必填* | 包装单位 | 袋、箱、卷 |
| **baseUnit** | String | 条件必填* | 基础单位（最小计量单位） | 颗、个、米 |
| **packageWeight** | BigDecimal | 否 | 包装重量（单包重量，kg） | 2.5 |
| **packageVolume** | BigDecimal | 否 | 包装体积（单包体积，m³） | 0.05 |

> *条件必填：如果填写了 `packageQuantity`，则 `packageUnit` 和 `baseUnit` 必填

### 2.2 进货信息字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| **totalPackages** | Integer | 否 | 总包装数（进货时的包数） | 10 |
| **totalQuantity** | BigDecimal | 否 | 总数量（基础单位，自动计算） | 5000 |
| **totalWeight** | BigDecimal | 否 | 总重量（kg，自动计算） | 25 |
| **totalVolume** | BigDecimal | 否 | 总体积（m³，自动计算） | 0.5 |

### 2.3 批次信息字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| **serialNumber** | String | 否 | 序列号/批次号 | SN20251112001 |
| **productionDate** | String | 否 | 生产日期（格式：yyyy-MM-dd） | 2025-11-01 |
| **expiryDate** | String | 否 | 过期日期（格式：yyyy-MM-dd） | 2026-11-01 |

---

## 3. 使用示例

### 3.1 场景1：有包装规格的物料（螺丝）

#### 前端请求数据
```json
{
  "materialName": "M6螺丝",
  "materialType": "STANDARD_PARTS",
  "specification": "304不锈钢",
  
  "packageQuantity": 500,
  "packageUnit": "袋",
  "baseUnit": "颗",
  "packageWeight": 2.5,
  "packageVolume": 0.05,
  
  "totalPackages": 10,
  "serialNumber": "SN20251112001",
  "productionDate": "2025-11-01",
  
  "manufacturer": "标准件厂",
  "isFragile": false,
  "isHazardous": false
}
```

#### 后端自动计算
```
总数量 = 500 × 10 = 5000 颗
总重量 = 2.5 × 10 = 25 kg
总体积 = 0.05 × 10 = 0.5 m³
```

#### 返回数据
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "materialCode": "WL20251112000001",
    "materialName": "M6螺丝",
    "packageQuantity": 500,
    "packageUnit": "袋",
    "baseUnit": "颗",
    "totalPackages": 10,
    "totalQuantity": 5000,
    "totalWeight": 25,
    "totalVolume": 0.5
  }
}
```

---

### 3.2 场景2：无包装规格的物料（设备）

#### 前端请求数据
```json
{
  "materialName": "变频器",
  "materialType": "ELECTRICAL",
  "specification": "380V 15KW",
  
  "unit": "台",
  "unitWeight": 45.5,
  "unitVolume": 0.2,
  
  "totalQuantity": 2,
  
  "manufacturer": "西门子",
  "serialNumber": "SN20251112002",
  "isFragile": false,
  "isHazardous": false
}
```

#### 后端自动计算
```
总重量 = 45.5 × 2 = 91 kg
总体积 = 0.2 × 2 = 0.4 m³
```

---

### 3.3 场景3：电缆（按长度计量）

#### 前端请求数据
```json
{
  "materialName": "电缆线",
  "materialType": "ELECTRICAL",
  "specification": "3×2.5mm²",
  
  "packageQuantity": 100,
  "packageUnit": "卷",
  "baseUnit": "米",
  "packageWeight": 50,
  "packageVolume": 0.1,
  
  "totalPackages": 5,
  "serialNumber": "SN20251112003",
  "productionDate": "2025-11-01",
  
  "manufacturer": "电缆厂",
  "isFragile": false,
  "isHazardous": false
}
```

#### 后端自动计算
```
总数量 = 100 × 5 = 500 米
总重量 = 50 × 5 = 250 kg
总体积 = 0.1 × 5 = 0.5 m³
```

---

## 4. API 接口

### 4.1 新增物料

**接口地址**：`POST /erp/saltprocess/material/item`

**请求头**：
```
Content-Type: application/json
Authorization: Bearer {token}
```

**请求体**：
```json
{
  "materialName": "M6螺丝",
  "materialType": "STANDARD_PARTS",
  "specification": "304不锈钢",
  "packageQuantity": 500,
  "packageUnit": "袋",
  "baseUnit": "颗",
  "packageWeight": 2.5,
  "packageVolume": 0.05,
  "totalPackages": 10,
  "serialNumber": "SN20251112001",
  "productionDate": "2025-11-01",
  "manufacturer": "标准件厂",
  "isFragile": false,
  "isHazardous": false
}
```

**响应示例**：
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

---

### 4.2 更新物料

**接口地址**：`PUT /erp/saltprocess/material/item`

**请求体**：
```json
{
  "id": 1,
  "materialName": "M6螺丝",
  "materialType": "STANDARD_PARTS",
  "packageQuantity": 500,
  "packageUnit": "袋",
  "baseUnit": "颗",
  "totalPackages": 15
}
```

> 注意：更新时会重新计算 `totalQuantity`、`totalWeight`、`totalVolume`

---

### 4.3 查询物料详情

**接口地址**：`GET /erp/saltprocess/material/item/{id}`

**响应示例**：
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "id": 1,
    "materialCode": "WL20251112000001",
    "materialName": "M6螺丝",
    "specification": "304不锈钢",
    "materialType": "STANDARD_PARTS",
    "packageQuantity": 500,
    "packageUnit": "袋",
    "baseUnit": "颗",
    "packageWeight": 2.5,
    "packageVolume": 0.05,
    "totalPackages": 10,
    "totalQuantity": 5000,
    "totalWeight": 25,
    "totalVolume": 0.5,
    "serialNumber": "SN20251112001",
    "productionDate": "2025-11-01",
    "manufacturer": "标准件厂",
    "isFragile": false,
    "isHazardous": false
  }
}
```

---

## 5. 计算规则

### 5.1 有包装规格的计算

```
条件：packageQuantity > 0 && totalPackages > 0

计算公式：
- totalQuantity = packageQuantity × totalPackages
- totalWeight = packageWeight × totalPackages
- totalVolume = packageVolume × totalPackages
```

### 5.2 无包装规格的计算

```
条件：unitWeight > 0 && totalQuantity > 0

计算公式：
- totalWeight = unitWeight × totalQuantity
- totalVolume = unitVolume × totalQuantity
```

---

## 6. 验证规则

### 6.1 包装规格验证

1. **如果填写了 `packageQuantity`**：
   - 必须填写 `packageUnit`（包装单位）
   - 必须填写 `baseUnit`（基础单位）

2. **如果填写了 `totalPackages`**：
   - 必须填写 `packageQuantity`（包装数量）

### 6.2 错误示例

#### 错误1：只填写包装数量，未填写单位
```json
{
  "packageQuantity": 500
  // ❌ 缺少 packageUnit 和 baseUnit
}
```
**错误信息**：`填写了包装数量，必须填写包装单位`

#### 错误2：只填写总包装数，未填写包装数量
```json
{
  "totalPackages": 10
  // ❌ 缺少 packageQuantity
}
```
**错误信息**：`填写了总包装数，必须填写包装数量`

---

## 7. 前端表单设计建议

### 7.1 表单字段分组

```
基础信息
├── 物料名称 *
├── 物料类型 *
├── 规格型号
└── 制造商

包装规格（可选）
├── 包装数量（每包数量）
├── 包装单位（袋、箱、卷）
├── 基础单位（颗、个、米）
├── 包装重量（单包重量）
└── 包装体积（单包体积）

进货信息（可选）
├── 总包装数（进货包数）
├── 总数量（自动计算，只读）
├── 总重量（自动计算，只读）
└── 总体积（自动计算，只读）

批次信息（可选）
├── 序列号/批次号
├── 生产日期
└── 过期日期

其他信息
├── 是否易碎
└── 是否危险品
```

### 7.2 表单联动逻辑

1. **当填写 `packageQuantity` 时**：
   - `packageUnit` 和 `baseUnit` 变为必填
   - 显示提示：请填写包装单位和基础单位

2. **当填写 `totalPackages` 时**：
   - 自动计算并显示 `totalQuantity`、`totalWeight`、`totalVolume`
   - 这些字段设为只读

3. **当修改包装规格时**：
   - 实时重新计算总数量、总重量、总体积

---

## 8. 常见问题

### Q1：什么时候需要填写包装规格？
**A**：当物料以包装单位进货，但以基础单位出库时，需要填写包装规格。例如：
- 螺丝：进货500颗/袋，出库按颗
- 电缆：进货100米/卷，出库按米
- 油漆：进货5升/桶，出库按升

### Q2：什么时候不需要填写包装规格？
**A**：当物料进货和出库使用相同单位时，不需要填写包装规格。例如：
- 设备：进货按台，出库按台
- 机械：进货按套，出库按套

### Q3：总数量、总重量、总体积可以手动填写吗？
**A**：
- 如果填写了包装规格（`packageQuantity` 和 `totalPackages`），系统会自动计算，无需手动填写
- 如果没有填写包装规格，可以手动填写 `totalQuantity`，系统会根据 `unitWeight` 计算 `totalWeight`

### Q4：如何处理出库？
**A**：出库时：
- 从 `totalQuantity` 中减去出库数量（基础单位）
- 系统会自动重新计算 `totalPackages`（向上取整）

示例：
```
初始：totalQuantity = 5000颗，totalPackages = 10袋
出库：100颗
结果：totalQuantity = 4900颗，totalPackages = 10袋（4900 ÷ 500 = 9.8 ≈ 10）
```

---

## 9. 测试用例

### 测试用例1：新增有包装规格的物料
```bash
curl -X POST http://localhost:8080/erp/saltprocess/material/item \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "materialName": "M6螺丝",
    "materialType": "STANDARD_PARTS",
    "specification": "304不锈钢",
    "packageQuantity": 500,
    "packageUnit": "袋",
    "baseUnit": "颗",
    "packageWeight": 2.5,
    "packageVolume": 0.05,
    "totalPackages": 10,
    "serialNumber": "SN20251112001",
    "productionDate": "2025-11-01",
    "manufacturer": "标准件厂",
    "isFragile": false,
    "isHazardous": false
  }'
```

**预期结果**：
- 返回 200 状态码
- 物料编码自动生成（如：WL20251112000001）
- totalQuantity = 5000
- totalWeight = 25
- totalVolume = 0.5

---

## 10. 总结

### 核心优势
1. ✅ 支持包装规格与实际使用数量的转换
2. ✅ 自动计算总数量、总重量、总体积
3. ✅ 支持批次管理
4. ✅ 灵活的字段设计，兼容多种业务场景

### 注意事项
1. ⚠️ 包装规格字段是可选的，但一旦填写必须完整
2. ⚠️ 总数量、总重量、总体积由系统自动计算
3. ⚠️ 日期格式必须为 `yyyy-MM-dd`

---

**文档版本**：v1.0  
**创建时间**：2025-11-12  
**维护团队**：海棠开发团队

