# 分批上传功能快速指南

## 🎯 核心特性

✅ **每批 10 条数据**：避免单次请求过大  
✅ **自动过滤发货清单**：只上传物料清单数据  
✅ **智能批次管理**：自动计算批次数量  
✅ **实时进度日志**：清晰显示上传进度  
✅ **错误隔离处理**：单批失败不影响整体

## 📊 工作流程

```
Excel文件
  ↓
解析+分Sheet
  ↓
过滤发货清单 (SHIPPING_INFO)
  ↓
每10条为一批
  ↓
逐批上传 (间隔200ms)
  ↓
汇总结果展示
```

## 💻 使用方法

### 前端操作

1. **导入 Excel 文件** → 自动解析
2. **点击"导入数据"** → 自动分批上传
3. **查看实时日志** → 控制台显示进度
4. **查看导入结果** → 详细统计信息

### 开发模式特性

**开发环境下**：每批上传成功后会弹出确认框

- ✅ 显示当前批次上传统计
- ✅ 手动确认后继续下一批
- ✅ 可随时停止上传
- ✅ 方便观察测试每批数据

**生产环境下**：自动连续上传，无需确认

### 批次参数调整

```typescript
// 修改批次大小 (默认20条)
const BATCH_SIZE = 20; // 建议范围: 10-50

// 修改请求间隔 (默认200ms，开发模式下无需延迟)
await new Promise(resolve => setTimeout(resolve, 200)); // 建议范围: 100-500ms
```

## 📈 日志示例

### 生产环境

```
Sheet 机械设备: 共50条数据，分3批上传，每批20条
正在上传第 1/3 批，共20条数据...
✓ 第1批上传成功: 20条 (累计成功: 20/50)
正在上传第 2/3 批，共20条数据...
✓ 第2批上传成功: 20条 (累计成功: 40/50)
正在上传第 3/3 批，共10条数据...
✓ 第3批上传成功: 10条 (累计成功: 50/50)
```

### 开发环境（带确认框）

```
Sheet 机械设备: 共50条数据，分3批上传，每批20条
正在上传第 1/3 批，共20条数据...
✓ 第1批上传成功: 20条 (累计成功: 20/50)

[弹出确认框：第 1 批已上传完成！是否继续？]

✓ 用户确认，继续上传第 2 批
...
```

## 📋 导入结果

| Sheet 名称 | 总记录数 | 批次数 | 成功 | 失败 | 状态   |
| ---------- | -------- | ------ | ---- | ---- | ------ |
| 机械设备   | 50       | 3      | 48   | 2    | 成功   |
| 电控设备   | 30       | 2      | 30   | 0    | 成功   |
| 发货清单   | 5        | -      | -    | -    | 已跳过 |

## 🔧 技术参数

| 参数         | 值     | 说明                       |
| ------------ | ------ | -------------------------- |
| **批次大小** | 20 条  | 每批上传的记录数           |
| **请求间隔** | 200ms  | 批次之间的延迟（生产模式） |
| **超时时间** | 30s    | 单次请求超时               |
| **最大批次** | 无限制 | 自动计算                   |
| **开发确认** | 启用   | 开发环境下批次间需手动确认 |

## ⚡ 性能对比

| 数据量 | 批次数 | 预计耗时（生产） | 预计耗时（开发） | 成功率 |
| ------ | ------ | ---------------- | ---------------- | ------ |
| 50 条  | 3 批   | 3-6 秒           | 手动确认         | 98%+   |
| 100 条 | 5 批   | 5-10 秒          | 手动确认         | 98%+   |
| 500 条 | 25 批  | 30-60 秒         | 手动确认         | 95%+   |

## ❓ 常见问题

### Q1: 为什么要分批上传？

**A**: 提高稳定性，避免大数据量超时，失败影响最小化

### Q2: 可以调整批次大小吗？

**A**: 可以，修改 `BATCH_SIZE` 常量（建议 5-20 条）

### Q3: 发货清单为什么会被跳过？

**A**: 发货清单数据不完整，系统自动过滤，只上传详细的物料清单

### Q4: 某一批失败怎么办？

**A**: 不影响其他批次，失败的数据会在结果中显示，可以单独处理

### Q5: 如何查看上传进度？

**A**: 打开浏览器控制台(F12)，查看实时日志

### Q6: 开发模式和生产模式有什么区别？

**A**:

- **开发模式**：每批上传后弹出确认框，需手动确认继续，方便测试
- **生产模式**：自动连续上传，无需确认，提高效率

## 📱 联系支持

如有问题，请查看完整文档：

- [物料清单分批上传功能实现](./物料清单分批上传功能实现.md)
- [物料导入 API 调用示例](./物料导入API调用示例.ts)

---

**版本**: v1.2.0 | **更新日期**: 2025-01-16
