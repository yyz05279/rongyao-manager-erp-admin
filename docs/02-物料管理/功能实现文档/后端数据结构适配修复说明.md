# åç«¯æ•°æ®ç»“æ„é€‚é…ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

### æŠ¥é”™ä¿¡æ¯

```
é”™è¯¯ä¿¡æ¯ï¼ˆå…± 4 æ¡ï¼‰ï¼š
existedItemVo.duplicateItems is not iterable
existedItemVo.duplicateItems is not iterable
existedItemVo.duplicateItems is not iterable
existedItemVo.duplicateItems is not iterable
```

### ç°è±¡

ç‰©æ–™æ¸…å•ä¸Šä¼ æ¥å£è¿”å›äº†é‡å¤æ•°æ®ï¼Œä½†æ˜¯å¼¹çª—é¡µé¢åªå±•ç¤ºäº†é”™è¯¯ä¿¡æ¯ï¼Œæ²¡æœ‰å±•ç¤ºå¯¹åº”çš„é‡å¤ç‰©æ–™æ˜ç»†æ•°æ®ã€‚

## æ ¹æœ¬åŸå› 

### åç«¯å®é™…è¿”å›çš„æ•°æ®ç»“æ„

```json
{
  "existedItems": [
    {
      "existedItem": {
        "id": "1982990457071673345",
        "materialName": "plcæ§åˆ¶æŸœ",
        "specification": "è§å›¾çº¸åŠæ¸…å•",
        "quantity": 1,
        "unit": "å¥—",
        "sheetName": "ç”µæ§è®¾å¤‡æ±‡æ€»",
        "itemCode": "1982990457033924610",
        "equipmentType": "AUXILIARY",
        "duplicateItems": [  // â† é—®é¢˜ï¼šduplicateItems åœ¨ existedItem é‡Œé¢ï¼
          {
            "materialName": "plcæ§åˆ¶æŸœ",
            "specification": "è§å›¾çº¸åŠæ¸…å•",
            "quantity": 1,
            "unit": "å¥—",
            "sheetName": "ç”µæ§è®¾å¤‡æ±‡æ€»",
            "rowNumber": 50
          }
        ]
      }
    }
  ]
}
```

### å‰ç«¯æœŸæœ›çš„æ•°æ®ç»“æ„

æ ¹æ®è®¾è®¡æ–‡æ¡£ï¼ˆ`ç‰©æ–™æ¸…å•é‡å¤å¤„ç†ä¼˜åŒ–å¼€å‘å®ŒæˆæŠ¥å‘Š.md`ï¼‰ï¼Œæ­£ç¡®çš„æ•°æ®ç»“æ„åº”è¯¥æ˜¯ï¼š

```json
{
  "existedItems": [
    {
      "existedItem": {  // å·²å­˜åœ¨ç‰©æ–™çš„åŸºæœ¬ä¿¡æ¯
        "id": "1982990457071673345",
        "materialName": "plcæ§åˆ¶æŸœ",
        "specification": "è§å›¾çº¸åŠæ¸…å•",
        "quantity": 1,
        "unit": "å¥—",
        "sheetName": "ç”µæ§è®¾å¤‡æ±‡æ€»",
        "itemCode": "1982990457033924610",
        "equipmentType": "AUXILIARY"
      },
      "duplicateItems": [  // â† æ­£ç¡®ï¼šduplicateItems å’Œ existedItem å¹³çº§
        {
          "materialName": "plcæ§åˆ¶æŸœ",
          "specification": "è§å›¾çº¸åŠæ¸…å•",
          "quantity": 1,
          "unit": "å¥—",
          "sheetName": "ç”µæ§è®¾å¤‡æ±‡æ€»",
          "rowNumber": 50
        }
      ]
    }
  ]
}
```

### ç»“æ„å·®å¼‚å¯¹æ¯”

| å­—æ®µ             | åç«¯å®é™…ä½ç½®                                 | å‰ç«¯æœŸæœ›ä½ç½®                     | ç»“æœ      |
| ---------------- | -------------------------------------------- | -------------------------------- | --------- |
| `existedItem`    | `existedItems[0].existedItem`                | `existedItems[0].existedItem`    | âœ… ä¸€è‡´   |
| `duplicateItems` | `existedItems[0].existedItem.duplicateItems` | `existedItems[0].duplicateItems` | âŒ ä¸ä¸€è‡´ |

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆé€‰æ‹©

è€ƒè™‘åˆ°ï¼š

1. åç«¯å¯èƒ½æš‚æ—¶æ— æ³•å¿«é€Ÿè°ƒæ•´
2. å‰ç«¯éœ€è¦å…¼å®¹ä¸¤ç§æ•°æ®ç»“æ„
3. ä¸å½±å“å·²æœ‰çš„ UI å±•ç¤ºé€»è¾‘

**é€‰æ‹©æ–¹æ¡ˆ**ï¼šåœ¨å‰ç«¯æ•°æ®æ”¶é›†é˜¶æ®µè¿›è¡Œ**æ•°æ®ç»“æ„è½¬æ¢å’Œé€‚é…**ã€‚

### å®ç°ç»†èŠ‚

#### ä¿®æ”¹å‰çš„ä»£ç 

```typescript
result.existedItems.forEach((existedItemVo: any) => {
  const existedItem = existedItemVo.existedItem;
  const materialKey = `${existedItem.materialName}_${existedItem.specification || ''}`;

  if (existedItemsMap.has(materialKey)) {
    const existing = existedItemsMap.get(materialKey);
    existing.duplicateItems.push(...existedItemVo.duplicateItems); // âŒ è®¿é—®ä¸å­˜åœ¨çš„å±æ€§
  } else {
    existedItemsMap.set(materialKey, {
      existedItem: existedItem,
      duplicateItems: [...existedItemVo.duplicateItems] // âŒ è®¿é—®ä¸å­˜åœ¨çš„å±æ€§
    });
  }
});
```

**é—®é¢˜**ï¼š`existedItemVo.duplicateItems` ä¸å­˜åœ¨ï¼Œå®é™…åœ¨ `existedItemVo.existedItem.duplicateItems`ã€‚

#### ä¿®æ”¹åçš„ä»£ç 

```typescript
result.existedItems.forEach((existedItemVo: any) => {
  // 1. è·å–åŸå§‹çš„ existedItemï¼ˆå¯èƒ½åŒ…å« duplicateItemsï¼‰
  const existedItemRaw = existedItemVo.existedItem;

  // 2. æå– duplicateItemsï¼ˆå…¼å®¹ä¸¤ç§ä½ç½®ï¼‰
  const duplicateItems = existedItemRaw.duplicateItems || existedItemVo.duplicateItems || [];

  // 3. æ„å»ºæ ‡å‡†çš„ existedItemï¼ˆä¸åŒ…å« duplicateItemsï¼‰
  const existedItem = {
    id: existedItemRaw.id,
    materialName: existedItemRaw.materialName,
    specification: existedItemRaw.specification,
    quantity: existedItemRaw.quantity,
    unit: existedItemRaw.unit,
    sheetName: existedItemRaw.sheetName,
    itemCode: existedItemRaw.itemCode,
    equipmentType: existedItemRaw.equipmentType
  };

  // 4. æ„å»ºæ ‡å‡†åŒ–çš„æ•°æ®ç»“æ„
  const materialKey = `${existedItem.materialName}_${existedItem.specification || ''}`;

  if (existedItemsMap.has(materialKey)) {
    const existing = existedItemsMap.get(materialKey);
    existing.duplicateItems.push(...duplicateItems); // âœ… ä½¿ç”¨æå–åçš„æ•°ç»„
  } else {
    existedItemsMap.set(materialKey, {
      existedItem: existedItem,
      duplicateItems: [...duplicateItems] // âœ… ä½¿ç”¨æå–åçš„æ•°ç»„
    });
  }
});
```

**ä¼˜åŠ¿**ï¼š

1. âœ… å…¼å®¹åç«¯å½“å‰è¿”å›çš„ç»“æ„ï¼ˆ`existedItem.duplicateItems`ï¼‰
2. âœ… å…¼å®¹å‰ç«¯æœŸæœ›çš„ç»“æ„ï¼ˆ`existedItemVo.duplicateItems`ï¼‰
3. âœ… è½¬æ¢ä¸ºæ ‡å‡†åŒ–çš„æ•°æ®ç»“æ„ä¾› UI ä½¿ç”¨
4. âœ… åç«¯ä¿®å¤åå‰ç«¯æ— éœ€ä¿®æ”¹

## æ•°æ®è½¬æ¢æµç¨‹

```
åç«¯è¿”å›
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ existedItems: [                     â”‚
â”‚   {                                 â”‚
â”‚     existedItem: {                  â”‚
â”‚       id: "...",                    â”‚
â”‚       materialName: "...",          â”‚
â”‚       duplicateItems: [...]  â† é”™è¯¯ä½ç½®â”‚
â”‚     }                               â”‚
â”‚   }                                 â”‚
â”‚ ]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ å‰ç«¯è½¬æ¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ existedItemsMap.set(key, {          â”‚
â”‚   existedItem: {                    â”‚
â”‚     id: "...",                      â”‚
â”‚     materialName: "...",            â”‚
â”‚     // ä¸åŒ…å« duplicateItems         â”‚
â”‚   },                                â”‚
â”‚   duplicateItems: [...]  â† æ­£ç¡®ä½ç½®   â”‚
â”‚ })                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ UIä½¿ç”¨
âœ… æ­£å¸¸å±•ç¤ºé‡å¤ç‰©æ–™æ˜ç»†
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ•°æ®

ä½¿ç”¨å®é™…æ¥å£è¿”å›çš„æ•°æ®ï¼š

```json
{
  "existedItems": [
    {
      "existedItem": {
        "id": "1982990457071673345",
        "materialName": "plcæ§åˆ¶æŸœ",
        "specification": "è§å›¾çº¸åŠæ¸…å•",
        "quantity": 1,
        "unit": "å¥—",
        "sheetName": "ç”µæ§è®¾å¤‡æ±‡æ€»",
        "itemCode": "1982990457033924610",
        "equipmentType": "AUXILIARY",
        "duplicateItems": [
          {
            "materialName": "plcæ§åˆ¶æŸœ",
            "specification": "è§å›¾çº¸åŠæ¸…å•",
            "quantity": 1,
            "unit": "å¥—",
            "sheetName": "ç”µæ§è®¾å¤‡æ±‡æ€»",
            "rowNumber": 50
          }
        ]
      }
    }
  ]
}
```

### é¢„æœŸç»“æœ

#### æ§åˆ¶å°è¾“å‡º

```
âœ… æ•°æ®è½¬æ¢æˆåŠŸ
âœ… existedItemsMap åŒ…å« 3 ä¸ªç‰©æ–™
âœ… æ¯ä¸ªç‰©æ–™çš„ duplicateItems æ˜¯å¯è¿­ä»£æ•°ç»„
```

#### UI å±•ç¤º

```
é‡å¤ç‰©æ–™æ˜ç»†ï¼ˆå…± 3 æ¡é‡å¤ï¼Œæ¶‰åŠ 3 ä¸ªç‰©æ–™ï¼‰ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ âœ…å·²å­˜åœ¨ plcæ§åˆ¶æŸœï¼ˆè§å›¾çº¸åŠæ¸…å•ï¼‰                    â”‚
â”‚ - æ•°æ®åº“æ•°é‡ï¼š1 å¥— - ç‰©å“ç¼–ç ï¼š1982990457033924610      â”‚
â”‚ ï¼ˆæœ¬æ¬¡é‡å¤ä¸Šä¼  1 æ¬¡ï¼‰                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ é‡å¤åºå· â”‚ ä¸Šä¼ æ•°é‡ â”‚ æ¥æºSheet    â”‚ Excelè¡Œå· â”‚      â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚   â”‚ ç¬¬1æ¬¡    â”‚ 1 å¥—     â”‚ ç”µæ§è®¾å¤‡æ±‡æ€»  â”‚ ç¬¬50è¡Œ    â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚   ğŸ’¡ å»ºè®®æ“ä½œï¼šå°†è¿™ 1 æ¬¡ä¸Šä¼ çš„æ•°é‡ï¼ˆå…± 1 å¥—ï¼‰           â”‚
â”‚      ç´¯åŠ åˆ°æ•°æ®åº“ç°æœ‰æ•°é‡ï¼Œæ›´æ–°ä¸º 2 å¥—                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…¼å®¹æ€§è¯´æ˜

### å½“å‰æ”¯æŒçš„æ•°æ®ç»“æ„

#### ç»“æ„ 1ï¼šduplicateItems åœ¨ existedItem é‡Œé¢ï¼ˆåç«¯å½“å‰å®ç°ï¼‰

```typescript
{
  existedItem: {
    id: "...",
    materialName: "...",
    duplicateItems: [...]  // â† è¿™é‡Œ
  }
}
```

#### ç»“æ„ 2ï¼šduplicateItems å’Œ existedItem å¹³çº§ï¼ˆè®¾è®¡æ–‡æ¡£ï¼‰

```typescript
{
  existedItem: {
    id: "...",
    materialName: "..."
  },
  duplicateItems: [...]  // â† è¿™é‡Œ
}
```

### ä¼˜å…ˆçº§

```typescript
const duplicateItems =
  existedItemRaw.duplicateItems ||  // ä¼˜å…ˆï¼šåç«¯å½“å‰ä½ç½®
  existedItemVo.duplicateItems ||   // æ¬¡é€‰ï¼šæ­£ç¡®ä½ç½®
  [];                                // é™çº§ï¼šç©ºæ•°ç»„
```

## åç»­å»ºè®®

### 1. åç«¯è°ƒæ•´å»ºè®®

å»ºè®®åç«¯ä¿®æ”¹æ•°æ®ç»“æ„ï¼Œå°† `duplicateItems` ç§»åˆ°æ­£ç¡®çš„ä½ç½®ï¼š

**ä¿®æ”¹å‰**ï¼š

```java
ExistedItemVo existedItemVo = ExistedItemVo.builder()
    .existedItem(existedItemDetail)  // existedItemDetail åŒ…å« duplicateItems
    .build();
```

**ä¿®æ”¹å**ï¼š

```java
ExistedItemVo existedItemVo = ExistedItemVo.builder()
    .existedItem(existedItemDetail)      // ä»…åŒ…å«ç‰©æ–™åŸºæœ¬ä¿¡æ¯
    .duplicateItems(duplicateItemsList)  // é‡å¤é¡¹åˆ—è¡¨ç‹¬ç«‹å­—æ®µ
    .build();
```

### 2. ç±»å‹å®šä¹‰

ç¡®ä¿åç«¯çš„ `ExistedItemDetailVo` ä¸åŒ…å« `duplicateItems` å­—æ®µï¼š

```java
@Data
@Builder
public static class ExistedItemDetailVo implements Serializable {
    private Long id;
    private String materialName;
    private String specification;
    private Integer quantity;
    private String unit;
    private String sheetName;
    private String itemCode;
    private String equipmentType;
    // âŒ ä¸åº”è¯¥æœ‰ duplicateItems å­—æ®µ
}
```

### 3. å‰ç«¯åç»­ä¼˜åŒ–

å½“åç«¯ä¿®å¤åï¼Œå‰ç«¯å¯ä»¥ç®€åŒ–ä»£ç ï¼š

```typescript
// ç®€åŒ–ç‰ˆæœ¬ï¼ˆåç«¯ä¿®å¤åï¼‰
result.existedItems.forEach((existedItemVo: any) => {
  const materialKey = `${existedItemVo.existedItem.materialName}_${existedItemVo.existedItem.specification || ''}`;

  if (existedItemsMap.has(materialKey)) {
    existedItemsMap.get(materialKey).duplicateItems.push(...existedItemVo.duplicateItems);
  } else {
    existedItemsMap.set(materialKey, existedItemVo);
  }
});
```

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ–‡ä»¶è·¯å¾„                                                          | ä¿®æ”¹å†…å®¹                 | ä¿®æ”¹ç±»å‹ |
| ----------------------------------------------------------------- | ------------------------ | -------- |
| `src/views/erp/saltprocess/project/components/MaterialDetail.vue` | æ•°æ®æ”¶é›†é€»è¾‘å¢åŠ ç»“æ„è½¬æ¢ | ä¿®å¤     |

## æ€»ç»“

### é—®é¢˜æ ¹æº

åç«¯è¿”å›çš„æ•°æ®ç»“æ„ä¸è®¾è®¡æ–‡æ¡£ä¸ä¸€è‡´ï¼Œ`duplicateItems` è¢«é”™è¯¯åœ°åµŒå¥—åœ¨ `existedItem` å¯¹è±¡å†…éƒ¨ã€‚

### è§£å†³æ–¹æ¡ˆ

å‰ç«¯å¢åŠ æ•°æ®ç»“æ„é€‚é…å±‚ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼Œå…¼å®¹ä¸¤ç§æ•°æ®ç»“æ„ã€‚

### æ•ˆæœ

- âœ… ä¿®å¤ "is not iterable" é”™è¯¯
- âœ… æ­£å¸¸å±•ç¤ºé‡å¤ç‰©æ–™æ˜ç»†
- âœ… å‘åå…¼å®¹ï¼Œåç«¯ä¿®å¤åå‰ç«¯æ— éœ€æ”¹åŠ¨
- âœ… ä»£ç å¥å£®æ€§å¢å¼º

---

**ä¿®å¤æ—¥æœŸ**ï¼š2025-10-28  
**ä¿®å¤äººå‘˜**ï¼šæµ·æ£ å¼€å‘å›¢é˜Ÿ  
**ç‰ˆæœ¬**ï¼šv2.0.1
