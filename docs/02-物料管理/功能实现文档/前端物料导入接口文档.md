# 前端物料导入接口文档

## 接口概述

前端物料导入接口用于处理前端解析后的物料清单数据，支持数据验证、产品匹配、批量导入等功能。该接口专门为前端 Excel 解析方案设计，提供了完整的数据导入流程。

## 核心接口

### 1. 导入前端解析的物料清单数据

**接口路径**: `POST /erp/saltprocess/material/frontend-import/data`

**权限要求**: `erp:material:import`

**接口说明**: 导入前端解析后的物料清单数据，创建发货清单和物料明细记录。

#### 请求参数

```json
{
    "projectId": "PROJECT_001",
    "projectName": "淮安化盐系统项目",
    "batchNumber": "第一批",
    "responsiblePerson": "张三",
    "responsiblePersonId": 12345,
    "shippingDate": "2025-01-16",
    "expectedDeliveryDate": "2025-01-20",
    "shippingMethod": "TRUCK",
    "vehicleInfo": "苏A12345",
    "driverInfo": "李师傅 13800138000",
    "remarks": "第一批设备发货",
    "fileSource": "淮安发货清单.xlsx",
    "materialItems": [
        {
            "sequenceNumber": "1",
            "materialType": "MECHANICAL",
            "materialName": "助燃风机",
            "specification": "流量13750m3/h，全压11319Pa",
            "quantity": 1.0,
            "unit": "台",
            "materialCategory": "不锈钢",
            "manufacturer": "海棠机械",
            "model": "ABC-123",
            "remarks1": "带调节风门",
            "remarks2": "新采购",
            "unitWeight": 150.5,
            "totalWeight": 150.5,
            "unitVolume": 2.5,
            "totalVolume": 2.5,
            "packageType": "木箱包装",
            "packageQuantity": 1,
            "isFragile": false,
            "isHazardous": false,
            "storageRequirement": "室内存放",
            "fileSource": "淮安发货清单.xlsx",
            "sheetName": "Sheet1",
            "rowNumber": 4,
            "hasErrors": false,
            "hasWarnings": false
        }
    ]
}
```

#### 响应结果

```json
{
    "code": 200,
    "msg": "物料清单导入成功",
    "data": {
        "success": true,
        "shippingListId": 123456,
        "listCode": "FL-1705123456789",
        "summary": "导入成功：共50条记录，成功48条，失败2条，新建产品15个，匹配产品33个",
        "totalRecords": 50,
        "successRecords": 48,
        "failedRecords": 2,
        "skippedRecords": 0,
        "newProductRecords": 15,
        "matchedProductRecords": 33,
        "startTime": "2025-01-16T10:30:00",
        "endTime": "2025-01-16T10:32:15",
        "duration": 135000,
        "errors": [
            {
                "rowNumber": 25,
                "materialName": "无效物料",
                "errorType": "VALIDATION_ERROR",
                "errorMessage": "物料名称不能为空",
                "errorField": "materialName",
                "originalData": "..."
            }
        ],
        "warnings": [
            {
                "rowNumber": 10,
                "materialName": "风机设备",
                "warningType": "DATA_QUALITY",
                "warningMessage": "建议填写计量单位",
                "suggestion": "添加单位信息有助于库存管理"
            }
        ],
        "statistics": {
            "materialTypeStats": [
                {
                    "materialType": "MECHANICAL",
                    "typeName": "机械设备",
                    "count": 25,
                    "percentage": 50.0
                }
            ],
            "fileSourceStats": [
                {
                    "fileName": "淮安发货清单.xlsx",
                    "recordCount": 50,
                    "successCount": 48,
                    "failedCount": 2
                }
            ],
            "dataQuality": {
                "completenessScore": 95,
                "accuracyScore": 98,
                "consistencyScore": 90,
                "overallScore": 94,
                "qualityLevel": "EXCELLENT",
                "suggestions": ["建议补充规格型号和计量单位信息"]
            }
        }
    }
}
```

### 2. 验证前端解析的物料数据

**接口路径**: `POST /erp/saltprocess/material/frontend-import/validate`

**权限要求**: `erp:material:validate`

**接口说明**: 验证前端解析的物料数据，不进行实际导入，仅返回验证结果。

#### 请求参数

与导入接口相同的数据结构。

#### 响应结果

```json
{
    "code": 200,
    "msg": "数据验证完成",
    "data": {
        "success": true,
        "summary": "验证通过：50条记录，3个警告",
        "totalRecords": 50,
        "successRecords": 48,
        "failedRecords": 2,
        "errors": [...],
        "warnings": [...],
        "statistics": {...}
    }
}
```

### 3. 批量匹配产品信息

**接口路径**: `POST /erp/saltprocess/material/frontend-import/batch-match-products`

**权限要求**: `erp:material:match`

**接口说明**: 批量匹配物料项与现有产品，返回匹配结果统计。

#### 请求参数

```json
[
    {
        "materialName": "助燃风机",
        "specification": "流量13750m3/h，全压11319Pa",
        "materialType": "MECHANICAL"
    }
]
```

#### 响应结果

```json
{
    "code": 200,
    "msg": "产品匹配完成",
    "data": {
        "success": true,
        "totalRecords": 50,
        "matchedProductRecords": 35,
        "newProductRecords": 15,
        "summary": "匹配完成：匹配到35个现有产品，需新建15个产品"
    }
}
```

### 4. 获取产品分类列表

**接口路径**: `GET /erp/saltprocess/material/frontend-import/product-categories`

**权限要求**: `erp:material:query`

**响应结果**:

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "id": 1,
            "name": "机械设备",
            "code": "MECHANICAL",
            "sort": 1
        }
    ]
}
```

### 5. 获取常用单位列表

**接口路径**: `GET /erp/saltprocess/material/frontend-import/common-units`

**权限要求**: `erp:material:query`

**响应结果**:

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        "台",
        "套",
        "件",
        "个",
        "支",
        "根",
        "米",
        "kg",
        "吨",
        "升",
        "立方米"
    ]
}
```

### 6. 获取物料类型枚举

**接口路径**: `GET /erp/saltprocess/material/frontend-import/material-types`

**权限要求**: `erp:material:query`

**响应结果**:

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "code": "GENERAL",
            "name": "通用物料"
        },
        {
            "code": "MECHANICAL",
            "name": "机械设备"
        }
    ]
}
```

### 7. 获取发货方式枚举

**接口路径**: `GET /erp/saltprocess/material/frontend-import/shipping-methods`

**权限要求**: `erp:material:query`

**响应结果**:

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "code": "TRUCK",
            "name": "卡车"
        },
        {
            "code": "RAIL",
            "name": "铁路"
        }
    ]
}
```

### 8. 获取发货状态枚举

**接口路径**: `GET /erp/saltprocess/material/frontend-import/shipping-status`

**权限要求**: `erp:material:query`

**响应结果**:

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "code": "DRAFT",
            "name": "草稿"
        },
        {
            "code": "PENDING",
            "name": "待发货"
        }
    ]
}
```

### 9. 预检查导入数据

**接口路径**: `POST /erp/saltprocess/material/frontend-import/pre-check`

**权限要求**: `erp:material:validate`

**接口说明**: 对导入数据进行预检查，返回基本统计信息和可导入性判断。

#### 请求参数

与导入接口相同的数据结构。

#### 响应结果

```json
{
    "code": 200,
    "msg": "预检查完成",
    "data": {
        "projectExists": true,
        "totalMaterials": 50,
        "validMaterials": 48,
        "invalidMaterials": 2,
        "mechanicalCount": 25,
        "electricalCount": 15,
        "generalCount": 10,
        "canImport": true,
        "errorMessage": null
    }
}
```

## 数据结构说明

### 物料项字段说明

| 字段名               | 类型       | 必填 | 说明       |
| -------------------- | ---------- | ---- | ---------- |
| `sequenceNumber`     | String     | 否   | 序号       |
| `materialType`       | String     | 否   | 物料类型   |
| `materialName`       | String     | 是   | 物料名称   |
| `specification`      | String     | 否   | 规格型号   |
| `quantity`           | BigDecimal | 是   | 数量       |
| `unit`               | String     | 否   | 单位       |
| `materialCategory`   | String     | 否   | 材质/类别  |
| `manufacturer`       | String     | 否   | 制造商     |
| `model`              | String     | 否   | 型号       |
| `remarks1`           | String     | 否   | 备注 1     |
| `remarks2`           | String     | 否   | 备注 2     |
| `unitWeight`         | BigDecimal | 否   | 单重(kg)   |
| `totalWeight`        | BigDecimal | 否   | 总重(kg)   |
| `unitVolume`         | BigDecimal | 否   | 单体积(m³) |
| `totalVolume`        | BigDecimal | 否   | 总体积(m³) |
| `packageType`        | String     | 否   | 包装方式   |
| `packageQuantity`    | Integer    | 否   | 包装件数   |
| `isFragile`          | Boolean    | 否   | 是否易碎   |
| `isHazardous`        | Boolean    | 否   | 是否危险品 |
| `storageRequirement` | String     | 否   | 存储要求   |
| `fileSource`         | String     | 否   | 文件来源   |
| `sheetName`          | String     | 否   | 工作表名称 |
| `rowNumber`          | Integer    | 否   | 原始行号   |

### 枚举值说明

#### 物料类型 (materialType)

-   `GENERAL`: 通用物料
-   `MECHANICAL`: 机械设备
-   `ELECTRICAL`: 电控设备
-   `PIPELINE`: 管路设备
-   `BURNER`: 燃烧器
-   `AUXILIARY`: 辅助设备
-   `STANDARD_PARTS`: 标准件
-   `SHIPPING_INFO`: 发货信息

#### 发货方式 (shippingMethod)

-   `TRUCK`: 卡车
-   `RAIL`: 铁路
-   `SEA`: 海运
-   `AIR`: 空运

#### 发货状态 (status)

-   `DRAFT`: 草稿
-   `PENDING`: 待发货
-   `PARTIAL_SHIPPED`: 部分发货
-   `SHIPPED`: 已发货
-   `DELIVERED`: 已送达
-   `COMPLETED`: 已完成
-   `CANCELLED`: 已取消

## 错误处理

### 常见错误类型

#### 验证错误 (VALIDATION_ERROR)

-   必填字段为空
-   数据格式不正确
-   数值范围超限

#### 业务错误 (BUSINESS_ERROR)

-   项目不存在
-   重复导入
-   状态不允许操作

#### 系统错误 (SYSTEM_ERROR)

-   数据库连接异常
-   服务内部错误
-   网络超时

### 错误响应格式

```json
{
    "code": 400,
    "msg": "数据验证失败",
    "data": {
        "success": false,
        "summary": "验证失败：5个错误，2个警告",
        "errors": [
            {
                "rowNumber": 10,
                "materialName": "风机设备",
                "errorType": "VALIDATION_ERROR",
                "errorMessage": "数量必须大于0",
                "errorField": "quantity"
            }
        ]
    }
}
```

## 使用流程

### 标准导入流程

1. **数据预检查**: 调用 `pre-check` 接口验证基本信息
2. **数据验证**: 调用 `validate` 接口进行完整验证
3. **产品匹配**: 调用 `batch-match-products` 接口预览匹配结果
4. **执行导入**: 调用 `data` 接口执行实际导入
5. **结果处理**: 根据返回结果处理成功和失败的记录

### 前端集成示例

```javascript
// 1. 预检查
const preCheckResult = await preCheckImportData(importData);
if (!preCheckResult.canImport) {
    showError(preCheckResult.errorMessage);
    return;
}

// 2. 数据验证
const validationResult = await validateFrontendData(importData);
if (!validationResult.success) {
    showValidationErrors(validationResult.errors);
    return;
}

// 3. 显示警告（如果有）
if (validationResult.warnings.length > 0) {
    showWarnings(validationResult.warnings);
}

// 4. 执行导入
const importResult = await importFrontendData(importData);
if (importResult.success) {
    showSuccess(`导入成功！清单编号：${importResult.listCode}`);
    // 跳转到清单详情页
    router.push(`/shipping/list/${importResult.shippingListId}`);
} else {
    showImportErrors(importResult.errors);
}
```

## 性能说明

-   **批量处理**: 支持单次导入最多 1000 条物料记录
-   **响应时间**: 100 条记录约需 2-5 秒处理时间
-   **并发限制**: 同一用户同时只能进行一个导入操作
-   **内存优化**: 采用流式处理，避免大文件内存溢出

## 注意事项

1. **数据完整性**: 确保必填字段完整，避免导入失败
2. **产品匹配**: 建议先调用匹配接口了解产品创建情况
3. **错误处理**: 导入失败的记录需要修正后重新导入
4. **权限控制**: 确保用户具有相应的操作权限
5. **数据备份**: 重要数据导入前建议备份现有数据

## 版本历史

-   **v1.0** (2025-01-16): 初始版本，支持基本的前端数据导入功能
-   支持物料清单批量导入
-   支持数据验证和产品匹配
-   支持详细的错误和警告信息
-   支持数据质量评估和统计
