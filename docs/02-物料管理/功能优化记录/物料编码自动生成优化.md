# 物料编码自动生成优化

## 优化说明

将物料管理页面的"物料编码"字段改为不可输入状态，因为物料编码由后台在创建物料时自动生成。

## 优化内容

### 1. 修改前的问题

- 新增物料时，物料编码字段可以手动输入
- 用户可能会输入不规范的编码
- 与后台自动生成编码的逻辑不一致

### 2. 修改后的效果

- ✅ 新增物料时，物料编码字段不可输入，显示提示"保存后系统自动生成"
- ✅ 编辑物料时，物料编码字段不可修改，显示提示"系统自动生成"
- ✅ 物料编码完全由后台自动生成，保证编码的规范性和唯一性

## 技术实现

### 修改的文件

**文件路径**：`src/views/erp/material/material/index.vue`

### 修改的代码

```vue
<!-- 修改前 -->
<el-form-item label="物料编码" prop="itemCode">
  <el-input v-model="form.itemCode" placeholder="请输入物料编码" />
</el-form-item>

<!-- 修改后 -->
<el-form-item label="物料编码" prop="itemCode">
  <el-input 
    v-model="form.itemCode" 
    :placeholder="form.id ? '系统自动生成' : '保存后系统自动生成'" 
    :disabled="true"
    readonly
  />
</el-form-item>
```

### 关键属性说明

1. **`:placeholder`**：动态提示文本
   - 新增时（`!form.id`）：显示"保存后系统自动生成"
   - 编辑时（`form.id`）：显示"系统自动生成"

2. **`:disabled="true"`**：禁用输入框
   - 输入框变为灰色，表示不可编辑状态
   - 用户无法点击或输入

3. **`readonly`**：只读属性
   - 双重保护，确保字段不可修改
   - 即使通过代码也无法修改

## 用户体验优化

### 新增物料场景

1. 用户点击"新增"按钮
2. 弹出物料信息对话框
3. 物料编码字段显示为灰色，提示"保存后系统自动生成"
4. 用户填写其他必填信息（物料名称等）
5. 点击"确定"保存
6. 后台自动生成物料编码并返回

### 编辑物料场景

1. 用户点击"编辑"按钮
2. 弹出物料信息对话框，自动填充物料数据
3. 物料编码字段显示为灰色，显示已生成的编码，提示"系统自动生成"
4. 用户只能修改其他字段，无法修改物料编码
5. 点击"确定"保存修改

## 业务逻辑说明

### 物料编码生成规则

物料编码由后台系统自动生成，遵循以下规则：

1. **唯一性**：每个物料编码在系统中唯一
2. **规范性**：编码格式统一，便于管理和查询
3. **自动化**：无需人工干预，避免编码冲突
4. **可追溯**：编码包含创建时间等信息，便于追溯

### 前端处理逻辑

```typescript
// 新增物料时
const handleAdd = () => {
  reset();
  // form.itemCode 为 undefined，不传给后台
  dialog.visible = true;
  dialog.title = "添加物料信息";
}

// 提交表单时
const submitForm = () => {
  materialFormRef.value?.validate(async (valid: boolean) => {
    if (valid) {
      buttonLoading.value = true;
      if (form.value.id) {
        // 编辑：保留原有的 itemCode
        await updateMaterial(form.value).finally(() => buttonLoading.value = false);
      } else {
        // 新增：itemCode 为 undefined，后台会自动生成
        await addMaterial(form.value).finally(() => buttonLoading.value = false);
      }
      proxy?.$modal.msgSuccess("操作成功");
      dialog.visible = false;
      await getList();
    }
  });
}
```

## 表单验证规则

物料编码字段**不是必填项**，因为它由后台自动生成：

```typescript
rules: {
  itemName: [
    { required: true, message: "物料名称不能为空", trigger: "blur" }
  ],
  // itemCode 没有验证规则，因为由后台自动生成
}
```

## 测试建议

### 1. 新增物料测试

**测试步骤**：
1. 点击"新增"按钮
2. 检查物料编码字段是否为灰色不可输入状态
3. 检查提示文本是否为"保存后系统自动生成"
4. 尝试点击物料编码输入框，确认无法输入
5. 填写物料名称等必填信息
6. 点击"确定"保存
7. 刷新列表，检查新增的物料是否有自动生成的编码

**预期结果**：
- ✅ 物料编码字段不可输入
- ✅ 提示文本正确显示
- ✅ 保存成功后，物料有自动生成的编码

### 2. 编辑物料测试

**测试步骤**：
1. 点击某个物料的"编辑"按钮
2. 检查物料编码字段是否显示已有的编码
3. 检查物料编码字段是否为灰色不可修改状态
4. 检查提示文本是否为"系统自动生成"
5. 尝试点击物料编码输入框，确认无法修改
6. 修改其他字段（如物料名称）
7. 点击"确定"保存
8. 刷新列表，检查物料编码是否保持不变

**预期结果**：
- ✅ 物料编码字段显示原有编码
- ✅ 物料编码字段不可修改
- ✅ 提示文本正确显示
- ✅ 保存后物料编码保持不变

### 3. 样式测试

**测试内容**：
- 检查禁用状态的输入框样式是否正常（灰色背景）
- 检查提示文本是否清晰可见
- 检查在不同浏览器下的显示效果

## 相关文件

- **修改文件**：`src/views/erp/material/material/index.vue`
- **修改位置**：第 112-119 行（物料编码表单项）
- **类型定义**：`src/api/erp/material/material/types.ts`
- **API接口**：`src/api/erp/material/material/index.ts`

## 注意事项

1. **后台接口要求**：
   - 新增物料时，不需要传递 `itemCode` 字段
   - 后台会自动生成 `itemCode` 并返回
   - 编辑物料时，保留原有的 `itemCode`

2. **前端处理**：
   - 新增时，`form.itemCode` 为 `undefined`
   - 编辑时，`form.itemCode` 保留后台返回的值
   - 提交时，新增不传 `itemCode`，编辑保留原值

3. **用户体验**：
   - 禁用状态清晰可见（灰色背景）
   - 提示文本明确说明编码由系统生成
   - 避免用户困惑或尝试输入

## 后续优化建议

1. **编码规则说明**：
   - 可以在物料编码字段旁边添加一个提示图标
   - 鼠标悬停时显示编码规则说明
   - 帮助用户理解编码的含义

2. **编码预览**：
   - 在新增物料时，可以显示编码格式示例
   - 例如："MAT-20250112-0001"

3. **编码查询**：
   - 提供按物料编码查询的功能
   - 支持编码模糊搜索

## 版本历史

- **v1.0.0** (2025-01-12)
  - 初始版本
  - 将物料编码字段改为不可输入状态
  - 添加动态提示文本
  - 确保编码由后台自动生成

## 相关需求

- **需求来源**：用户反馈
- **需求描述**：物料编码应由系统自动生成，不允许手动输入
- **实现方式**：前端禁用输入，后台自动生成
- **完成时间**：2025-01-12

