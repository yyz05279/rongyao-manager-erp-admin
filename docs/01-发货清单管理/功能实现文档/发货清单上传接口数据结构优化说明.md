# å‘è´§æ¸…å•ä¸Šä¼ æ¥å£æ•°æ®ç»“æ„ä¼˜åŒ–è¯´æ˜

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**: 2025-10-31
- **æœ€åæ›´æ–°**: 2025-10-31
- **è´Ÿè´£äºº**: AI Assistant
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

## ğŸ“ ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–è°ƒæ•´äº†å‘è´§æ¸…å• Excel å¯¼å…¥æ—¶çš„ä¸Šä¼ æ¥å£æ•°æ®ç»“æ„ï¼Œåœ¨ä¿æŒå‘åå…¼å®¹çš„å‰æä¸‹ï¼Œå¢åŠ äº†æ›´åŠ æ¸…æ™°çš„åˆ†ç»„æ•°æ®æ ¼å¼ã€‚

### ä¼˜åŒ–ç›®æ ‡

1. **æå‡æ•°æ®å¯è¯»æ€§**ï¼šå°†æ˜ç»†é¡¹æŒ‰å­ç³»ç»Ÿç»„ç»‡ï¼Œç»“æ„æ›´åŠ æ¸…æ™°
2. **ä¿æŒå‘åå…¼å®¹**ï¼šä¿ç•™åŸæœ‰çš„ `subsystemWeights` å’Œ `shippingItems` å­—æ®µ
3. **ä¾¿äºåç«¯å¤„ç†**ï¼šæä¾›æ›´ç›´è§‚çš„åˆ†ç»„æ•°æ®ç»“æ„

## ğŸ”§ æ•°æ®ç»“æ„è°ƒæ•´

### 1. æ–°å¢ç±»å‹å®šä¹‰

#### SubsystemGroup æ¥å£

```typescript
// å­ç³»ç»Ÿåˆ†ç»„æ•°æ®ï¼ˆç”¨äºæ›´æ¸…æ™°çš„æ•°æ®ç»“æ„ï¼‰
export interface SubsystemGroup {
  systemName: string;          // å­ç³»ç»Ÿåç§°ï¼ˆå¦‚ï¼šå¹³é¢è¾“é€ç³»ç»Ÿï¼‰
  weight: number | string;      // å­ç³»ç»Ÿæ€»é‡é‡ï¼ˆå¨ï¼‰
  remark?: string;              // å¤‡æ³¨ä¿¡æ¯
  items: EnhancedShippingItemForm[];  // è¯¥å­ç³»ç»Ÿä¸‹çš„æ˜ç»†é¡¹
}
```

#### æ›´æ–°åçš„ EnhancedShippingImportRequest

```typescript
export interface EnhancedShippingImportRequest {
  // ... åŸºæœ¬ä¿¡æ¯å­—æ®µ ...

  // ã€ä¿ç•™ã€‘å­ç³»ç»Ÿé‡é‡æ˜ å°„æ•°ç»„ï¼ˆç”¨äºå‘åå…¼å®¹ï¼‰
  subsystemWeights?: SubsystemWeight[];

  // ã€æ¨èã€‘æŒ‰å­ç³»ç»Ÿåˆ†ç»„çš„æ•°æ®ç»“æ„ï¼ˆæ›´æ¸…æ™°ï¼‰
  subsystems?: SubsystemGroup[];

  // ã€ä¿ç•™ã€‘è®¾å¤‡æ˜ç»†ï¼ˆå¹³é“ºç»“æ„ï¼Œç”¨äºå‘åå…¼å®¹ï¼‰
  shippingItems?: EnhancedShippingItemForm[];
}
```

### 2. æ•°æ®ç»“æ„å¯¹æ¯”

#### åŸæœ‰ç»“æ„ï¼ˆä¿ç•™ï¼‰

```json
{
  "subsystemWeights": [
    {
      "subsystem": "åºå·1-å¹³é¢è¾“é€æœº+åºå·2-å­è¾“é€",
      "weight": "7",
      "remarks": "å¹³é¢è¾“é€æœº+å­è¾“é€æ€»é‡"
    },
    {
      "subsystem": "åºå·3-ç²‰ç¢æœº",
      "weight": "7.5",
      "remarks": "ç²‰ç¢æœºæ€»é‡"
    }
  ],
  "shippingItems": [
    {
      "sequenceNo": 1,
      "equipmentName": "è¾“é€ä¸»ä½“",
      "subsystem": "åºå·1-å¹³é¢è¾“é€æœº+åºå·2-å­è¾“é€",
      "quantity": 2,
      "unit": "å¥—",
      // ... å…¶ä»–å­—æ®µ
    },
    {
      "sequenceNo": 2,
      "equipmentName": "å­è¾“é€ä½“",
      "subsystem": "åºå·1-å¹³é¢è¾“é€æœº+åºå·2-å­è¾“é€",
      "quantity": 1,
      "unit": "å¥—",
      // ... å…¶ä»–å­—æ®µ
    },
    {
      "sequenceNo": 3,
      "equipmentName": "ç²‰ç¢æœºä¸»ä½“",
      "subsystem": "åºå·3-ç²‰ç¢æœº",
      "quantity": 1,
      "unit": "å°",
      // ... å…¶ä»–å­—æ®µ
    }
  ]
}
```

#### æ–°å¢ç»“æ„ï¼ˆæ¨èï¼‰

```json
{
  "subsystems": [
    {
      "systemName": "å¹³é¢è¾“é€æœº+å­è¾“é€",
      "weight": "7",
      "remark": "å¹³é¢è¾“é€æœº+å­è¾“é€æ€»é‡",
      "items": [
        {
          "sequenceNo": 1,
          "equipmentName": "è¾“é€ä¸»ä½“",
          "quantity": 2,
          "unit": "å¥—",
          // ... å…¶ä»–å­—æ®µ
        },
        {
          "sequenceNo": 2,
          "equipmentName": "å­è¾“é€ä½“",
          "quantity": 1,
          "unit": "å¥—",
          // ... å…¶ä»–å­—æ®µ
        }
      ]
    },
    {
      "systemName": "ç²‰ç¢æœº",
      "weight": "7.5",
      "remark": "ç²‰ç¢æœºæ€»é‡",
      "items": [
        {
          "sequenceNo": 3,
          "equipmentName": "ç²‰ç¢æœºä¸»ä½“",
          "quantity": 1,
          "unit": "å°",
          // ... å…¶ä»–å­—æ®µ
        }
      ]
    }
  ]
}
```

#### å®Œæ•´ä¸Šä¼ æ•°æ®ç¤ºä¾‹

```json
{
  // åŸºæœ¬ä¿¡æ¯
  "projectId": "1234567890",
  "batchNumber": "ç¬¬ä¸€è½¦",
  "responsiblePersonId": "1",
  "shippingDate": "2025-10-31",
  "shippingMethod": "TRUCK",

  // è½¦è¾†å’Œå¸æœºä¿¡æ¯
  "vehiclePlate": "è‹A12345",
  "vehicleDescription": "17.5ç±³è½¦",
  "driverName": "å¼ ä¸‰",
  "driverPhone": "13800138000",

  // ç…§ç‰‡ä¿¡æ¯
  "shippingPhotoUrls": [
    "/uploads/shipping-photos/2025/10/31/photo1.jpg",
    "/uploads/shipping-photos/2025/10/31/photo2.jpg"
  ],
  "driverLicensePhotoUrls": [
    "/uploads/driver-license/2025/10/31/license1.jpg"
  ],

  // ã€ä¿ç•™ã€‘åŸæœ‰æ ¼å¼ï¼ˆå‘åå…¼å®¹ï¼‰
  "subsystemWeights": [
    {
      "subsystem": "åºå·1-å¹³é¢è¾“é€æœº+åºå·2-å­è¾“é€",
      "weight": "7",
      "remarks": "å¹³é¢è¾“é€æœº+å­è¾“é€æ€»é‡"
    }
  ],
  "shippingItems": [
    {
      "sequenceNo": 1,
      "equipmentName": "è¾“é€ä¸»ä½“",
      "subsystem": "åºå·1-å¹³é¢è¾“é€æœº+åºå·2-å­è¾“é€",
      "quantity": 2,
      "unit": "å¥—"
    }
  ],

  // ã€æ¨èã€‘æ–°æ ¼å¼ï¼ˆæ›´æ¸…æ™°ï¼‰
  "subsystems": [
    {
      "systemName": "å¹³é¢è¾“é€æœº+å­è¾“é€",
      "weight": "7",
      "remark": "å¹³é¢è¾“é€æœº+å­è¾“é€æ€»é‡",
      "items": [
        {
          "sequenceNo": 1,
          "equipmentName": "è¾“é€ä¸»ä½“",
          "quantity": 2,
          "unit": "å¥—"
        }
      ]
    }
  ]
}
```

## ğŸ”¨ å®ç°ç»†èŠ‚

### 1. æ–°å¢ buildSubsystemGroups å‡½æ•°

åœ¨ `EnhancedShippingImportDialog.vue` ä¸­æ–°å¢æ•°æ®è½¬æ¢å‡½æ•°ï¼š

```typescript
/**
 * æ„å»ºæŒ‰å­ç³»ç»Ÿåˆ†ç»„çš„æ•°æ®ç»“æ„
 * å°† subsystemWeights å’Œ shippingItems è½¬æ¢ä¸ºæ›´æ¸…æ™°çš„åˆ†ç»„æ ¼å¼
 */
const buildSubsystemGroups = (
  subsystemWeights: Array<{ subsystem: string; weight: number; remarks?: string }>,
  shippingItems: EnhancedShippingItemForm[]
): SubsystemGroup[] => {
  const subsystemGroups: SubsystemGroup[] = [];

  // ä¸ºæ¯ä¸ªå­ç³»ç»Ÿåˆ›å»ºåˆ†ç»„
  subsystemWeights.forEach(sw => {
    // æå–å­ç³»ç»Ÿåç§°ï¼ˆå»é™¤"åºå·X-"å‰ç¼€ï¼‰
    const systemName = sw.subsystem
      .split('+')
      .map(name => name.replace(/^åºå·\d+-/, ''))
      .join('+');

    // ç­›é€‰å±äºè¯¥å­ç³»ç»Ÿçš„æ‰€æœ‰æ˜ç»†é¡¹
    const items = shippingItems.filter(item => item.subsystem === sw.subsystem);

    subsystemGroups.push({
      systemName,
      weight: sw.weight,
      remark: sw.remarks,
      items
    });
  });

  return subsystemGroups;
};
```

### 2. å¯¼å…¥æ—¶åŒæ—¶ç”Ÿæˆä¸¤ç§æ ¼å¼

åœ¨ `handleImport` å‡½æ•°ä¸­ï¼š

```typescript
// æå–å­ç³»ç»Ÿé‡é‡æ•°æ®
const subsystemWeights = extractSubsystemWeights();

// è½¬æ¢è®¾å¤‡æ˜ç»†æ•°æ®
const shippingItems = convertEquipmentDetails();

// ã€æ–°å¢ã€‘æ„å»ºæŒ‰å­ç³»ç»Ÿåˆ†ç»„çš„æ•°æ®ç»“æ„
const subsystems = buildSubsystemGroups(subsystemWeights, shippingItems);

// æ„å»ºå¯¼å…¥è¯·æ±‚æ•°æ®ï¼ˆåŒæ—¶åŒ…å«ä¸¤ç§æ ¼å¼ï¼‰
const importData: EnhancedShippingImportRequest = {
  // ... å…¶ä»–å­—æ®µ ...

  // ä¿ç•™åŸæœ‰æ ¼å¼ï¼ˆå‘åå…¼å®¹ï¼‰
  subsystemWeights,
  shippingItems,

  // æ–°å¢åˆ†ç»„æ ¼å¼ï¼ˆæ¨èï¼‰
  subsystems
};
```

## ğŸ“Š ä¼˜åŠ¿å¯¹æ¯”

| å¯¹æ¯”é¡¹         | åŸæœ‰ç»“æ„                         | æ–°å¢ç»“æ„                       |
| -------------- | -------------------------------- | ------------------------------ |
| **æ•°æ®å…³è”**   | éœ€è¦é€šè¿‡ `subsystem` å­—æ®µå…³è”    | ç›´æ¥åµŒå¥—ï¼Œå…³è”æ˜ç¡®             |
| **å¯è¯»æ€§**     | éœ€è¦éå†ä¸¤ä¸ªæ•°ç»„æ‰èƒ½ç†è§£å®Œæ•´ç»“æ„ | ä¸€çœ¼å°±èƒ½çœ‹å‡ºå­ç³»ç»Ÿå’Œæ˜ç»†çš„å…³ç³» |
| **å¤„ç†å¤æ‚åº¦** | éœ€è¦é¢å¤–çš„æŸ¥æ‰¾å’ŒåŒ¹é…é€»è¾‘         | å¯ä»¥ç›´æ¥éå†å­ç³»ç»ŸåŠå…¶æ˜ç»†     |
| **å‰ç«¯å±•ç¤º**   | éœ€è¦å…ˆåˆ†ç»„å†å±•ç¤º                 | å¯ä»¥ç›´æ¥æŒ‰åˆ†ç»„å±•ç¤º             |
| **å‘åå…¼å®¹**   | âœ… ä¿æŒä¸å˜                      | âœ… æ–°å¢å­—æ®µï¼Œä¸å½±å“æ—§ç‰ˆ        |

## ğŸ¯ ä½¿ç”¨å»ºè®®

### åç«¯å¼€å‘å»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨ `subsystems` å­—æ®µ**ï¼šå¦‚æœè¯¥å­—æ®µå­˜åœ¨ä¸”ä¸ä¸ºç©ºï¼Œä¼˜å…ˆä½¿ç”¨è¿™ä¸ªç»“æ„
2. **å‘åå…¼å®¹å¤„ç†**ï¼šå¦‚æœ `subsystems` ä¸ºç©ºï¼Œå›é€€åˆ°ä½¿ç”¨ `subsystemWeights` å’Œ `shippingItems`
3. **æ•°æ®éªŒè¯**ï¼šç¡®ä¿ä¸¤ç§æ ¼å¼çš„æ•°æ®ä¸€è‡´æ€§

```typescript
// åç«¯å¤„ç†ç¤ºä¾‹ï¼ˆä¼ªä»£ç ï¼‰
if (importData.subsystems && importData.subsystems.length > 0) {
  // ä½¿ç”¨æ–°æ ¼å¼å¤„ç†
  importData.subsystems.forEach(subsystem => {
    // ä¿å­˜å­ç³»ç»Ÿä¿¡æ¯
    saveSubsystemInfo(subsystem.systemName, subsystem.weight, subsystem.remark);

    // ä¿å­˜è¯¥å­ç³»ç»Ÿçš„æ‰€æœ‰æ˜ç»†
    subsystem.items.forEach(item => {
      saveShippingItem(item, subsystem.systemName);
    });
  });
} else {
  // å›é€€åˆ°æ—§æ ¼å¼å¤„ç†
  importData.subsystemWeights.forEach(sw => {
    saveSubsystemInfo(sw.subsystem, sw.weight, sw.remarks);
  });

  importData.shippingItems.forEach(item => {
    saveShippingItem(item, item.subsystem);
  });
}
```

### å‰ç«¯å±•ç¤ºå»ºè®®

ä½¿ç”¨æ–°æ ¼å¼å¯ä»¥æ›´æ–¹ä¾¿åœ°å±•ç¤ºåˆ†ç»„æ•°æ®ï¼š

```vue
<template>
  <div v-for="subsystem in subsystems" :key="subsystem.systemName">
    <div class="subsystem-header">
      <h3>{{ subsystem.systemName }}</h3>
      <span>é‡é‡: {{ subsystem.weight }}å¨</span>
      <span v-if="subsystem.remark">{{ subsystem.remark }}</span>
    </div>

    <el-table :data="subsystem.items">
      <el-table-column prop="equipmentName" label="è®¾å¤‡åç§°" />
      <el-table-column prop="quantity" label="æ•°é‡" />
      <el-table-column prop="unit" label="å•ä½" />
      <!-- å…¶ä»–åˆ— -->
    </el-table>
  </div>
</template>
```

## ğŸ“ ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

1. **ç±»å‹å®šä¹‰æ–‡ä»¶**

   - `/src/api/erp/saltprocess/shipping/types.ts`
     - æ–°å¢ `SubsystemGroup` æ¥å£

2. **API æ¥å£æ–‡ä»¶**

   - `/src/api/erp/saltprocess/shipping/index.ts`
     - æ›´æ–° `EnhancedShippingImportRequest` æ¥å£
     - å¯¼å‡º `SubsystemGroup` ç±»å‹

3. **å¯¼å…¥å¯¹è¯æ¡†ç»„ä»¶**
   - `/src/views/erp/saltprocess/shipping/components/EnhancedShippingImportDialog.vue`
     - æ–°å¢ `buildSubsystemGroups` å‡½æ•°
     - ä¿®æ”¹ `handleImport` å‡½æ•°ï¼ŒåŒæ—¶ç”Ÿæˆä¸¤ç§æ ¼å¼çš„æ•°æ®

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯

1. **åŸºæœ¬å¯¼å…¥æµ‹è¯•**

   - å¯¼å…¥åŒ…å«å¤šä¸ªå­ç³»ç»Ÿçš„ Excel æ–‡ä»¶
   - éªŒè¯ `subsystems` å­—æ®µç”Ÿæˆæ­£ç¡®
   - éªŒè¯ `subsystemWeights` å’Œ `shippingItems` ä¿æŒä¸å˜

2. **æ•°æ®ä¸€è‡´æ€§æµ‹è¯•**

   - éªŒè¯ `subsystems` ä¸­çš„æ˜ç»†é¡¹æ€»æ•°ä¸ `shippingItems` ä¸€è‡´
   - éªŒè¯æ¯ä¸ªå­ç³»ç»Ÿçš„é‡é‡ä¸ `subsystemWeights` å¯¹åº”é¡¹ä¸€è‡´

3. **ç‰¹æ®Šæƒ…å†µæµ‹è¯•**
   - ç©ºå­ç³»ç»Ÿï¼ˆæ— æ˜ç»†é¡¹ï¼‰
   - å•ä¸ªæ˜ç»†é¡¹çš„å­ç³»ç»Ÿ
   - å¤šä¸ªæ˜ç»†é¡¹çš„å­ç³»ç»Ÿ

### éªŒè¯æ–¹æ³•

åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æŸ¥çœ‹å¯¼å…¥æ•°æ®ï¼š

```javascript
// æŸ¥çœ‹ç”Ÿæˆçš„å­ç³»ç»Ÿåˆ†ç»„æ•°æ®
console.log('ğŸ“¦ ç”Ÿæˆçš„å­ç³»ç»Ÿåˆ†ç»„æ•°æ®:');
console.log(JSON.stringify(subsystems, null, 2));

// éªŒè¯æ•°æ®ä¸€è‡´æ€§
const totalItemsInSubsystems = subsystems.reduce((sum, s) => sum + s.items.length, 0);
console.log('subsystems ä¸­çš„æ€»æ˜ç»†æ•°:', totalItemsInSubsystems);
console.log('shippingItems æ€»æ•°:', shippingItems.length);
console.log('æ•°æ®ä¸€è‡´:', totalItemsInSubsystems === shippingItems.length);
```

## ğŸ’¡ åç»­å»ºè®®

1. **åç«¯æ¥å£æ›´æ–°**

   - å»ºè®®åç«¯æ¥å£ä¼˜å…ˆå¤„ç† `subsystems` å­—æ®µ
   - æ·»åŠ æ•°æ®æ ¼å¼ç‰ˆæœ¬æ ‡è¯†ï¼Œæ–¹ä¾¿åç»­æ‰©å±•

2. **è¯¦æƒ…é¡µé¢å±•ç¤º**

   - è¯¦æƒ…é¡µé¢å¯ä»¥ä½¿ç”¨æ–°æ ¼å¼æ›´å¥½åœ°å±•ç¤ºå­ç³»ç»Ÿåˆ†ç»„
   - å»ºè®®åœ¨è¯¦æƒ…æ¥å£è¿”å›æ—¶ä¹Ÿä½¿ç”¨ç±»ä¼¼çš„åˆ†ç»„ç»“æ„

3. **æ•°æ®å¯¼å‡º**

   - Excel å¯¼å‡ºåŠŸèƒ½ä¹Ÿå¯ä»¥å‚è€ƒè¿™ç§åˆ†ç»„ç»“æ„
   - æŒ‰å­ç³»ç»Ÿåˆ† sheet æˆ–åˆ†åŒºåŸŸå¯¼å‡º

4. **æ€§èƒ½ä¼˜åŒ–**
   - å¯¹äºå¤§é‡æ˜ç»†é¡¹ï¼Œåˆ†ç»„ç»“æ„å¯ä»¥å‡å°‘æŸ¥è¯¢æ¬¡æ•°
   - å»ºè®®åœ¨æ•°æ®åº“å±‚é¢ä¹Ÿé‡‡ç”¨ç±»ä¼¼çš„åˆ†ç»„å­˜å‚¨

## ğŸ” å‚è€ƒèµ„æ–™

- [å‘è´§æ¸…å• Excel å¯¼å…¥åŠŸèƒ½è¯´æ˜](./å‘è´§æ¸…å•å¢å¼ºç‰ˆå¯¼å…¥åŠŸèƒ½è¯´æ˜.md)
- [å‘è´§æ¸…å•æ•°æ®è§£ææ–¹æ¡ˆ](./å‘è´§æ¸…å•æ•°æ®è§£ææ–¹æ¡ˆ-å®Œæˆæ€»ç»“.md)
- [å‘è´§æ¸…å•å­ç³»ç»Ÿé‡é‡åŠŸèƒ½ä½¿ç”¨æ–‡æ¡£](./å‘è´§æ¸…å•å­ç³»ç»Ÿé‡é‡åŠŸèƒ½ä½¿ç”¨æ–‡æ¡£.md)

## ğŸ“¦ è¯¦æƒ…æ¥å£åŒæ­¥æ›´æ–°

### 1. ShippingListVO ç±»å‹æ›´æ–°

åœ¨ `ShippingListVO` æ¥å£ä¸­ä¹Ÿæ·»åŠ äº† `subsystems` å­—æ®µï¼š

```typescript
export interface ShippingListVO {
  // ... å…¶ä»–å­—æ®µ ...

  // å­ç³»ç»Ÿé‡é‡æ˜ å°„æ•°ç»„ï¼ˆä¿ç•™ç”¨äºå‘åå…¼å®¹ï¼‰
  subsystemWeights?: SubsystemWeight[];

  // ã€æ¨èã€‘æŒ‰å­ç³»ç»Ÿåˆ†ç»„çš„æ•°æ®ç»“æ„ï¼ˆæ›´æ¸…æ™°ï¼‰
  subsystems?: SubsystemGroup[];

  // å…³è”æ•°æ®
  items?: ShippingItemVO[];
}
```

### 2. æ•°æ®è§£æå™¨è‡ªåŠ¨æ„å»º

åœ¨ `data-parser.ts` ä¸­çš„ `parseShippingListVO` å‡½æ•°ä¼šè‡ªåŠ¨æ„å»º `subsystems` å­—æ®µï¼š

```typescript
export function parseShippingListVO(data: any): ShippingListVO {
  return {
    // ... å…¶ä»–å­—æ®µ ...

    // å­ç³»ç»Ÿé‡é‡æ˜ å°„æ•°ç»„ï¼ˆä¿ç•™ï¼‰
    subsystemWeights: parseSubsystemWeights(data.subsystemWeights),

    // ã€æ¨èã€‘æŒ‰å­ç³»ç»Ÿåˆ†ç»„çš„æ•°æ®ç»“æ„
    // ä¼˜å…ˆä½¿ç”¨åç«¯è¿”å›çš„ subsystemsï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è‡ªåŠ¨æ„å»º
    subsystems:
      data.subsystems ||
      buildSubsystems(
        parseSubsystemWeights(data.subsystemWeights),
        Array.isArray(data.items) ? data.items.map((item: any) => parseShippingItemVO(item)) : []
      ),

    // å…³è”æ•°æ®
    items: Array.isArray(data.items) ? data.items.map((item: any) => parseShippingItemVO(item)) : undefined
  };
}
```

### 3. buildSubsystems å·¥å…·å‡½æ•°

æ–°å¢çš„ `buildSubsystems` å‡½æ•°å¯ä»¥ä» `subsystemWeights` å’Œ `items` æ„å»ºåˆ†ç»„æ•°æ®ï¼š

```typescript
/**
 * æ„å»ºæŒ‰å­ç³»ç»Ÿåˆ†ç»„çš„æ•°æ®ç»“æ„
 * @param subsystemWeights å­ç³»ç»Ÿé‡é‡æ˜ å°„æ•°ç»„
 * @param items å‘è´§æ˜ç»†æ•°ç»„
 * @returns æŒ‰å­ç³»ç»Ÿåˆ†ç»„çš„æ•°æ®
 */
export function buildSubsystems(
  subsystemWeights: SubsystemWeight[],
  items: ShippingItemVO[]
): SubsystemGroup[] {
  // ä¸ºæ¯ä¸ªå­ç³»ç»Ÿåˆ›å»ºåˆ†ç»„
  return subsystemWeights.map(sw => ({
    systemName: extractSystemName(sw.subsystem),
    weight: sw.weight,
    remark: sw.remarks,
    items: items.filter(item =>
      // ç­›é€‰å±äºè¯¥å­ç³»ç»Ÿçš„æ˜ç»†é¡¹
      matchesSubsystem(item.itemName, sw.subsystem)
    )
  }));
}
```

### 4. è¯¦æƒ…é¡µé¢ä½¿ç”¨ç¤ºä¾‹

ç°åœ¨åœ¨è¯¦æƒ…é¡µé¢å¯ä»¥ç›´æ¥ä½¿ç”¨ `subsystems` å­—æ®µï¼š

```vue
<template>
  <div v-for="subsystem in shippingDetail.subsystems" :key="subsystem.systemName" class="subsystem-section">
    <!-- å­ç³»ç»Ÿå¤´éƒ¨ -->
    <div class="subsystem-header">
      <h3>{{ subsystem.systemName }}</h3>
      <el-tag type="warning">{{ subsystem.weight }}å¨</el-tag>
      <span v-if="subsystem.remark" class="remark">{{ subsystem.remark }}</span>
    </div>

    <!-- è¯¥å­ç³»ç»Ÿçš„æ˜ç»†åˆ—è¡¨ -->
    <el-table :data="subsystem.items" border>
      <el-table-column prop="itemName" label="è®¾å¤‡åç§°" />
      <el-table-column prop="quantity" label="æ•°é‡" />
      <el-table-column prop="unit" label="å•ä½" />
      <el-table-column prop="totalWeight" label="é‡é‡(kg)" />
    </el-table>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { getShippingList } from '@/api/erp/saltprocess/shipping';

const shippingDetail = ref<ShippingListVO>({});

onMounted(async () => {
  const response = await getShippingList(id);
  // parseShippingListVO ä¼šè‡ªåŠ¨æ„å»º subsystems å­—æ®µ
  shippingDetail.value = response.data;

  // ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ†ç»„æ•°æ®
  console.log('å­ç³»ç»Ÿæ•°é‡:', shippingDetail.value.subsystems?.length);
});
</script>
```

### 5. å‘åå…¼å®¹è¯´æ˜

- **åç«¯ä¼˜å…ˆè¿”å›**ï¼šå¦‚æœåç«¯ç›´æ¥è¿”å› `subsystems` å­—æ®µï¼Œåˆ™ä½¿ç”¨åç«¯æ•°æ®
- **å‰ç«¯è‡ªåŠ¨æ„å»º**ï¼šå¦‚æœåç«¯ä¸è¿”å› `subsystems`ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨ä» `subsystemWeights` å’Œ `items` æ„å»º
- **æ—§ç‰ˆå…¼å®¹**ï¼šä¿ç•™ `subsystemWeights` å’Œ `items` å­—æ®µï¼Œç¡®ä¿æ—§ä»£ç ç»§ç»­å·¥ä½œ

## ğŸ“ ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

### æ ¸å¿ƒæ–‡ä»¶

1. **ç±»å‹å®šä¹‰æ–‡ä»¶**

   - `/src/api/erp/saltprocess/shipping/types.ts`
     - æ–°å¢ `SubsystemGroup` æ¥å£
     - æ›´æ–° `ShippingListVO` æ¥å£ï¼Œæ·»åŠ  `subsystems` å­—æ®µ
     - æ›´æ–° `EnhancedShippingImportRequest` æ¥å£

2. **API æ¥å£æ–‡ä»¶**

   - `/src/api/erp/saltprocess/shipping/index.ts`
     - å¯¼å‡º `SubsystemGroup` ç±»å‹
     - å¯¼å‡º `buildSubsystems` å·¥å…·å‡½æ•°

3. **æ•°æ®è§£æå™¨**

   - `/src/api/erp/saltprocess/shipping/data-parser.ts`
     - æ–°å¢ `buildSubsystems` å‡½æ•°ï¼ˆç”¨äºæ„å»ºå­ç³»ç»Ÿåˆ†ç»„ï¼‰
     - æ–°å¢ `extractSystemName` è¾…åŠ©å‡½æ•°ï¼ˆæå–å­ç³»ç»Ÿåç§°ï¼‰
     - æ›´æ–° `parseShippingListVO` å‡½æ•°ï¼Œè‡ªåŠ¨æ„å»º `subsystems` å­—æ®µ

4. **å¯¼å…¥å¯¹è¯æ¡†ç»„ä»¶**
   - `/src/views/erp/saltprocess/shipping/components/EnhancedShippingImportDialog.vue`
     - æ–°å¢ `buildSubsystemGroups` å‡½æ•°
     - ä¿®æ”¹ `handleImport` å‡½æ•°ï¼ŒåŒæ—¶ç”Ÿæˆä¸¤ç§æ ¼å¼çš„æ•°æ®

### æ–‡æ¡£æ–‡ä»¶

- `/docs/01-å‘è´§æ¸…å•ç®¡ç†/åŠŸèƒ½å®ç°æ–‡æ¡£/å‘è´§æ¸…å•ä¸Šä¼ æ¥å£æ•°æ®ç»“æ„ä¼˜åŒ–è¯´æ˜.md`
  - æœ¬æ–‡æ¡£ï¼Œè¯¦ç»†è¯´æ˜æ•°æ®ç»“æ„ä¼˜åŒ–

## âœ… æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–åœ¨ä¿æŒå‘åå…¼å®¹çš„å‰æä¸‹ï¼Œä¸ºå‘è´§æ¸…å•çš„ä¸Šä¼ æ¥å£å’Œè¯¦æƒ…æ¥å£ç»Ÿä¸€å¢åŠ äº†æ›´åŠ æ¸…æ™°çš„åˆ†ç»„æ•°æ®ç»“æ„ã€‚

### ä¸»è¦æ”¹è¿›

1. **ç»Ÿä¸€æ•°æ®ç»“æ„**

   - ä¸Šä¼ æ¥å£å’Œè¯¦æƒ…æ¥å£ä½¿ç”¨ç›¸åŒçš„ `subsystems` æ•°æ®ç»“æ„
   - ä¿æŒäº†æ•°æ®æ ¼å¼çš„ä¸€è‡´æ€§

2. **è‡ªåŠ¨åŒ–æ„å»º**

   - è¯¦æƒ…æ¥å£è¿”å›æ•°æ®æ—¶ï¼Œå‰ç«¯è‡ªåŠ¨æ„å»º `subsystems` å­—æ®µ
   - æ— éœ€åç«¯ç«‹å³è°ƒæ•´ï¼Œå‰ç«¯å¯å…ˆè¡Œä½¿ç”¨æ–°ç»“æ„

3. **å‘åå…¼å®¹**

   - ä¿ç•™ `subsystemWeights` å’Œ `items` å­—æ®µ
   - åç«¯å¯ä»¥é€‰æ‹©ç›´æ¥è¿”å› `subsystems`ï¼Œä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨æ—§æ ¼å¼

4. **ä¾¿äºå±•ç¤º**
   - è¯¦æƒ…é¡µé¢å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ†ç»„æ•°æ®
   - ä»£ç æ›´ç®€æ´ï¼Œé€»è¾‘æ›´æ¸…æ™°

**æ ¸å¿ƒåŸåˆ™**ï¼š

- âœ… **å‘åå…¼å®¹**ï¼šä¿ç•™åŸæœ‰å­—æ®µ
- âœ… **æ•°æ®ä¸€è‡´**ï¼šä¸¤ç§æ ¼å¼æ•°æ®ä¿æŒä¸€è‡´
- âœ… **ç»“æ„æ¸…æ™°**ï¼šæ–°æ ¼å¼æ›´åŠ ç›´è§‚
- âœ… **çµæ´»ä½¿ç”¨**ï¼šåç«¯å¯æ ¹æ®éœ€è¦é€‰æ‹©ä½¿ç”¨å“ªç§æ ¼å¼
- âœ… **ç»Ÿä¸€æ ‡å‡†**ï¼šä¸Šä¼ å’Œè¯¦æƒ…æ¥å£ä½¿ç”¨ç›¸åŒçš„æ•°æ®ç»“æ„
