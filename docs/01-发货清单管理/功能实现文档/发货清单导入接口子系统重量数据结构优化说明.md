# å‘è´§æ¸…å•å¯¼å…¥æ¥å£å­ç³»ç»Ÿé‡é‡æ•°æ®ç»“æ„ä¼˜åŒ–è¯´æ˜

## ä¿®æ”¹æ¦‚è¿°

æ ¹æ®ã€Šå‘è´§æ¸…å•å­ç³»ç»Ÿé‡é‡åŠŸèƒ½ä½¿ç”¨æ–‡æ¡£ã€‹çš„æ¨èæ–¹æ¡ˆ,ä¼˜åŒ–äº†å‘è´§æ¸…å• Excel å¯¼å…¥åŠŸèƒ½çš„æ•°æ®ç»“æ„,å°†é‡é‡æ•°æ®ä»å­é¡¹ä¸­æå–åˆ°`subsystemWeights`æ•°ç»„ä¸­,é¿å…é‡å¤è®¡ç®—å¯¼è‡´æ€»é‡é‡é”™è¯¯ã€‚

## ä¿®æ”¹æ—¶é—´

2025-10-30

## é—®é¢˜æè¿°

### åŸæœ‰é—®é¢˜

åœ¨ä¹‹å‰çš„å®ç°ä¸­,å‘è´§æ¸…å•å¯¼å…¥æ—¶:

```json
{
  "projectId": "1001",
  "batchNumber": "ç¬¬ä¸€è½¦",
  "shippingItems": [
    {
      "sequenceNo": 1,
      "equipmentName": "å¹³é¢è¾“é€æœº",
      "subItemName": "è¾“é€ä¸»ä½“",
      "weight": 7.0  // âŒ æ¯ä¸ªå­é¡¹éƒ½æœ‰é‡é‡
    },
    {
      "sequenceNo": 1,
      "equipmentName": "å¹³é¢è¾“é€æœº",
      "subItemName": "ç´§å›ºä»¶",
      "weight": 7.0  // âŒ é‡å¤çš„é‡é‡å€¼
    }
  ]
}
```

**å­˜åœ¨çš„é—®é¢˜**:

- åŒä¸€ä¸ªè®¾å¤‡çš„å¤šä¸ªå­é¡¹éƒ½å¡«å†™äº†å®Œæ•´çš„è®¾å¤‡é‡é‡
- ç»Ÿè®¡æ€»é‡é‡æ—¶ä¼šé‡å¤è®¡ç®—
- ä¾‹å¦‚:å¹³é¢è¾“é€æœºæ€»é‡ 7 å¨,æœ‰ 2 ä¸ªå­é¡¹,ä¼šè¢«ç»Ÿè®¡ä¸º 14 å¨

### ä¼˜åŒ–åçš„æ–¹æ¡ˆ

ä½¿ç”¨`subsystemWeights`æ•°ç»„æ¥ç®¡ç†å­ç³»ç»Ÿé‡é‡:

```json
{
  "projectId": "1001",
  "batchNumber": "ç¬¬ä¸€è½¦",
  "subsystemWeights": [
    {
      "subsystem": "ç¬¬ä¸€è½¦",
      "weight": 14.5,
      "remarks": "åºå·1-å¹³é¢è¾“é€æœº, åºå·3-ç²‰ç¢æœºæ€»é‡"
    }
  ],
  "shippingItems": [
    {
      "sequenceNo": 1,
      "equipmentName": "å¹³é¢è¾“é€æœº",
      "subItemName": "è¾“é€ä¸»ä½“",
      "subsystem": "ç¬¬ä¸€è½¦",
      "weight": undefined  // âœ… é‡é‡ç•™ç©º,ç”±subsystemWeightsæä¾›
    },
    {
      "sequenceNo": 1,
      "equipmentName": "å¹³é¢è¾“é€æœº",
      "subItemName": "ç´§å›ºä»¶",
      "subsystem": "ç¬¬ä¸€è½¦",
      "weight": undefined  // âœ… é‡é‡ç•™ç©º
    }
  ]
}
```

**ä¼˜ç‚¹**:

- âœ… é¿å…é‡é‡é‡å¤è®¡ç®—
- âœ… æ•°æ®ç»“æ„æ¸…æ™°,æ˜“äºç®¡ç†
- âœ… ç»Ÿè®¡å‡†ç¡®
- âœ… ç¬¦åˆåç«¯æ¨èçš„æœ€ä½³å®è·µ

## ä»£ç ä¿®æ”¹è¯´æ˜

### æ–‡ä»¶: `src/views/erp/saltprocess/shipping/components/EnhancedShippingImportDialog.vue`

#### 1. ä¿®æ”¹ `convertEquipmentDetails` å‡½æ•°

**ä¿®æ”¹å‰**:

```typescript
const convertEquipmentDetails = (): EnhancedShippingItemForm[] => {
  const allItems: EnhancedShippingItemForm[] = [];

  parsedData.value.equipmentDetails.forEach(sheet => {
    sheet.data.forEach(detail => {
      const weight = detail.é‡é‡ || detail['é‡é‡ï¼ˆå¨ï¼‰'] || detail['é‡é‡(å¨)'] || detail.é‡é‡å¨ || undefined;

      allItems.push({
        sequenceNo: detail.åºå·,
        equipmentName: detail.åç§° || '',
        subItemName: detail.åˆ†é¡¹,
        quantity: detail.æ•°é‡ || 0,
        unit: detail.å•ä½ || 'å¥—',
        weight: weight,  // âŒ ç›´æ¥å¡«å†™é‡é‡
        specification: detail.åˆ†é¡¹ || '',
        equipmentType: inferEquipmentType(detail.åç§° || ''),
        remarks1: detail.å¤‡æ³¨,
        remarks: detail.å¤‡æ³¨
      });
    });
  });

  return allItems;
};
```

**ä¿®æ”¹å**:

```typescript
const convertEquipmentDetails = (): EnhancedShippingItemForm[] => {
  const allItems: EnhancedShippingItemForm[] = [];

  parsedData.value.equipmentDetails.forEach(sheet => {
    sheet.data.forEach(detail => {
      allItems.push({
        sequenceNo: detail.åºå·,
        equipmentName: detail.åç§° || '',
        subItemName: detail.åˆ†é¡¹,
        quantity: detail.æ•°é‡ || 0,
        unit: detail.å•ä½ || 'å¥—',
        weight: undefined,  // âœ… ä¸å¡«å†™é‡é‡,ç”±subsystemWeightsæä¾›
        specification: detail.åˆ†é¡¹ || '',
        equipmentType: inferEquipmentType(detail.åç§° || ''),
        remarks1: detail.å¤‡æ³¨,
        remarks: detail.å¤‡æ³¨,
        subsystem: sheet.sheetName  // âœ… æ ‡è®°å­ç³»ç»Ÿåç§°
      });
    });
  });

  return allItems;
};
```

**å˜æ›´è¯´æ˜**:

- ç§»é™¤äº†é‡é‡å­—æ®µçš„æå–é€»è¾‘
- å°†`weight`è®¾ç½®ä¸º`undefined`
- æ–°å¢`subsystem`å­—æ®µ,æ ‡è®°å­é¡¹æ‰€å±çš„å­ç³»ç»Ÿ(ä½¿ç”¨ sheet åç§°)

#### 2. æ–°å¢ `extractSubsystemWeights` å‡½æ•°

```typescript
/**
 * æå–å­ç³»ç»Ÿé‡é‡æ•°æ®
 * ä»è§£æçš„Excelæ•°æ®ä¸­æå–æ¯ä¸ªsheetçš„é‡é‡ä¿¡æ¯
 */
const extractSubsystemWeights = (): Array<{ subsystem: string; weight: number; remarks?: string }> => {
  const subsystemWeights: Array<{ subsystem: string; weight: number; remarks?: string }> = [];

  parsedData.value.equipmentDetails.forEach(sheet => {
    // ä»æ¯ä¸ªsheetçš„æ•°æ®ä¸­æå–é‡é‡
    // æŒ‰åºå·åˆ†ç»„,æ¯ä¸ªåºå·å¯¹åº”ä¸€ä¸ªè®¾å¤‡,é‡é‡åªè®¡ç®—ä¸€æ¬¡
    const weightBySequence = new Map<number, { weight: number; name: string }>();

    sheet.data.forEach(detail => {
      const sequenceNo = typeof detail.åºå· === 'string' ? parseInt(detail.åºå·, 10) : detail.åºå·;
      const weight = detail.é‡é‡ || detail['é‡é‡ï¼ˆå¨ï¼‰'] || detail['é‡é‡(å¨)'] || detail.é‡é‡å¨ || 0;
      const equipmentName = detail.åç§° || '';

      // å¦‚æœè¯¥åºå·è¿˜æ²¡æœ‰è®°å½•,æˆ–è€…å½“å‰è¡Œæœ‰æ›´æ–°çš„é‡é‡å€¼,åˆ™è®°å½•
      const numWeight = typeof weight === 'string' ? parseFloat(weight) : weight;
      if (numWeight > 0 && (!weightBySequence.has(sequenceNo) || weightBySequence.get(sequenceNo)!.weight === 0)) {
        weightBySequence.set(sequenceNo, {
          weight: numWeight,
          name: equipmentName
        });
      }
    });

    // è®¡ç®—è¯¥sheetçš„æ€»é‡é‡
    let totalWeight = 0;
    const equipmentNames: string[] = [];

    weightBySequence.forEach((value, sequenceNo) => {
      totalWeight += value.weight;
      if (value.name) {
        equipmentNames.push(`åºå·${sequenceNo}-${value.name}`);
      }
    });

    // åªæœ‰å½“æ€»é‡é‡å¤§äº0æ—¶æ‰æ·»åŠ 
    if (totalWeight > 0) {
      subsystemWeights.push({
        subsystem: sheet.sheetName,
        weight: totalWeight,
        remarks: equipmentNames.length > 0 ? equipmentNames.join(', ') + 'æ€»é‡' : undefined
      });
    }
  });

  return subsystemWeights;
};
```

**åŠŸèƒ½è¯´æ˜**:

1. **æŒ‰åºå·åˆ†ç»„**: æ¯ä¸ªåºå·å¯¹åº”ä¸€ä¸ªè®¾å¤‡,é¿å…é‡å¤è®¡ç®—
2. **æ”¯æŒå¤šç§é‡é‡å­—æ®µå**: `é‡é‡`ã€`é‡é‡ï¼ˆå¨ï¼‰`ã€`é‡é‡(å¨)`ã€`é‡é‡å¨`
3. **ç±»å‹è½¬æ¢**: ç¡®ä¿é‡é‡å€¼ä¸ºæ•°å­—ç±»å‹
4. **è‡ªåŠ¨ç”Ÿæˆå¤‡æ³¨**: åˆ—å‡ºè¯¥å­ç³»ç»ŸåŒ…å«çš„æ‰€æœ‰è®¾å¤‡

#### 3. ä¿®æ”¹ `handleImport` å‡½æ•°

**ä¿®æ”¹å‰**:

```typescript
// 4. è½¬æ¢è®¾å¤‡æ˜ç»†æ•°æ®
const shippingItems = convertEquipmentDetails();

// 5. æå–å‘è´§æ—¶é—´ä¿¡æ¯
const firstTimeRecord = parsedData.value.shippingTimes[0];

// 6. æ„å»ºå¯¼å…¥è¯·æ±‚æ•°æ®
const importData: EnhancedShippingImportRequest = {
  projectId: importConfig.projectId,
  batchNumber: importConfig.batchNumber,
  // ...å…¶ä»–å­—æ®µ

  // âŒ æ²¡æœ‰subsystemWeightså­—æ®µ
  shippingItems
};
```

**ä¿®æ”¹å**:

```typescript
// 4. è½¬æ¢è®¾å¤‡æ˜ç»†æ•°æ®
const shippingItems = convertEquipmentDetails();

// 5. æå–å­ç³»ç»Ÿé‡é‡æ•°æ®
const subsystemWeights = extractSubsystemWeights();

// ğŸ” è°ƒè¯•æ—¥å¿—ï¼šæ£€æŸ¥æ•°æ®æå–æƒ…å†µ
console.log('=== æ•°æ®æå–æ£€æŸ¥ ===');
console.log('è®¾å¤‡æ˜ç»†æ€»æ•°é‡:', shippingItems.length);
console.log('å­ç³»ç»Ÿé‡é‡æ•°æ®:', subsystemWeights);
console.log('å­ç³»ç»Ÿæ•°é‡:', subsystemWeights.length);
if (subsystemWeights.length > 0) {
  const totalWeight = subsystemWeights.reduce((sum, sw) => sum + sw.weight, 0);
  console.log('æ€»é‡é‡:', totalWeight, 'å¨');
  console.log('å­ç³»ç»Ÿé‡é‡æ˜ç»†:', subsystemWeights.map(sw => ({
    å­ç³»ç»Ÿ: sw.subsystem,
    é‡é‡: sw.weight + 'å¨',
    å¤‡æ³¨: sw.remarks || '-'
  })));
}

// 6. æå–å‘è´§æ—¶é—´ä¿¡æ¯
const firstTimeRecord = parsedData.value.shippingTimes[0];

// 7. æ„å»ºå¯¼å…¥è¯·æ±‚æ•°æ®
const importData: EnhancedShippingImportRequest = {
  projectId: importConfig.projectId,
  batchNumber: importConfig.batchNumber,
  // ...å…¶ä»–å­—æ®µ

  // âœ… æ·»åŠ å­ç³»ç»Ÿé‡é‡æ˜ å°„æ•°ç»„
  subsystemWeights,

  shippingItems
};
```

**å˜æ›´è¯´æ˜**:

- æ–°å¢è°ƒç”¨`extractSubsystemWeights()`æå–å­ç³»ç»Ÿé‡é‡
- åœ¨è¯·æ±‚ä½“ä¸­æ·»åŠ `subsystemWeights`å­—æ®µ
- æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—,ä¾¿äºæ’æŸ¥é—®é¢˜

## æ ¸å¿ƒæ¦‚å¿µè¯´æ˜

### ä»€ä¹ˆæ˜¯"å­ç³»ç»Ÿ"ï¼Ÿ

åœ¨æœ¬ç³»ç»Ÿä¸­ï¼Œ**å­ç³»ç»Ÿ = æ‰“åŒ…å‘è´§çš„è®¾å¤‡ç»„**ï¼ˆæŒ‰ Excel ä¸­åˆå¹¶å•å…ƒæ ¼çš„é‡é‡å€¼åˆ†ç»„ï¼‰

- å¤šä¸ªè®¾å¤‡å¯èƒ½æ‰“åŒ…åœ¨ä¸€èµ·å‘è´§ï¼Œåªèƒ½ä¸€èµ·ç§°é‡
- Excel ä¸­è¡¨ç°ä¸º**é‡é‡åˆ—çš„åˆå¹¶å•å…ƒæ ¼**
- ç³»ç»ŸæŒ‰**è¿ç»­ç›¸åŒé‡é‡å€¼**è‡ªåŠ¨åˆ†ç»„

### ç¤ºä¾‹è¯´æ˜

ä» Excel æ•°æ®æ¥çœ‹ï¼š

| åºå· | åç§°       | åˆ†é¡¹       | æ•°é‡ | å•ä½ | é‡é‡ï¼ˆå¨ï¼‰           |
| ---- | ---------- | ---------- | ---- | ---- | -------------------- |
| 1    | å¹³é¢è¾“é€æœº | è¾“é€ä¸»ä½“   | 2    | å¥—   | **7** â†              |
| 1    | å¹³é¢è¾“é€æœº | ç´§å›ºä»¶     | 1    | å¥—   | **7** â† åˆå¹¶å•å…ƒæ ¼   |
| 2    | å­è¾“é€     | å¸æ–™æºœå£³   | 2    | å¥—   | **7** â†              |
| 2    | å­è¾“é€     | ç´§å›ºä»¶     | 1    | å¥—   | **7** â†              |
| 3    | ç²‰ç¢æœº     | ç²‰ç¢æœºæœ¬ä½“ | 2    | å¥—   | **7.5** â†            |
| 3    | ç²‰ç¢æœº     | æ²¹ç¼¸åŠæ²¹ç®¡ | 8    | å¥—   | **7.5** â† åˆå¹¶å•å…ƒæ ¼ |

**å­ç³»ç»Ÿåˆ’åˆ†**:

- **å­ç³»ç»Ÿ 1**: `åºå·1-å¹³é¢è¾“é€æœº+åºå·2-å­è¾“é€`
  - **æ€»é‡**: 7 å¨ï¼ˆæ‰“åŒ…å‘è´§ï¼Œä¸€èµ·ç§°é‡ï¼‰
  - **åŒ…å«**: åºå· 1 çš„æ‰€æœ‰å­é¡¹ + åºå· 2 çš„æ‰€æœ‰å­é¡¹
- **å­ç³»ç»Ÿ 2**: `åºå·3-ç²‰ç¢æœº`
  - **æ€»é‡**: 7.5 å¨ï¼ˆç‹¬ç«‹å‘è´§ï¼‰
  - **åŒ…å«**: åºå· 3 çš„æ‰€æœ‰å­é¡¹

**é‡è¦ç†è§£**:

- âœ… åºå· 1+åºå· 2 **å…±è®¡** 7 å¨ï¼ˆä¸æ˜¯å„ 7 å¨ï¼ï¼‰
- âœ… æ€»é‡é‡ = 7 + 7.5 = 14.5 å¨
- âŒ **é”™è¯¯**: 7 + 7 + 7.5 = 21.5 å¨ï¼ˆé‡å¤ç´¯åŠ äº†ï¼ï¼‰

## æ•°æ®æµç¨‹è¯´æ˜

### 1. Excel è§£æé˜¶æ®µ

Excel æ–‡ä»¶ç»“æ„:

```
æ·®å®‰é¡¹ç›®å‘è´§æ¸…å•.xlsx
â”œâ”€â”€ è®¾å¤‡å‘è´§æ—¶é—´ (å‘è´§æ—¥æœŸã€è½¦è¾†ä¿¡æ¯ç­‰)
â””â”€â”€ ç¬¬ä¸€è½¦ (è®¾å¤‡æ˜ç»†)
    â”œâ”€â”€ åºå· | åç§° | åˆ†é¡¹ | æ•°é‡ | å•ä½ | é‡é‡ï¼ˆå¨ï¼‰| å¤‡æ³¨
    â”œâ”€â”€ 1 | å¹³é¢è¾“é€æœº | è¾“é€ä¸»ä½“ | 2 | å¥— | 7.0 | ...
    â”œâ”€â”€ 1 | å¹³é¢è¾“é€æœº | ç´§å›ºä»¶ | 1 | å¥— | 7.0 | ...  (æ³¨æ„ï¼šé‡é‡ç›¸åŒï¼Œæ˜¯è®¾å¤‡æ€»é‡)
    â”œâ”€â”€ 3 | ç²‰ç¢æœº | ç²‰ç¢æœºæœ¬ä½“ | 2 | å¥— | 7.5 | ...
    â””â”€â”€ 3 | ç²‰ç¢æœº | æ²¹ç¼¸åŠæ²¹ç®¡ | 8 | å¥— | 7.5 | ... (æ³¨æ„ï¼šé‡é‡ç›¸åŒï¼Œæ˜¯è®¾å¤‡æ€»é‡)
```

### 2. æ•°æ®æå–é˜¶æ®µ

#### æå–å­ç³»ç»Ÿé‡é‡ï¼ˆæŒ‰è®¾å¤‡åˆ†ç»„ï¼‰

```typescript
// æŒ‰"åºå·+è®¾å¤‡åç§°"åˆ†ç»„ï¼Œæ¯ä¸ªè®¾å¤‡åªæå–ä¸€æ¬¡é‡é‡
è®¾å¤‡1: { subsystem: "åºå·1-å¹³é¢è¾“é€æœº", weight: 7.0 }
è®¾å¤‡2: { subsystem: "åºå·3-ç²‰ç¢æœº", weight: 7.5 }

// ç”Ÿæˆ subsystemWeights æ•°ç»„
[
  {
    subsystem: "åºå·1-å¹³é¢è¾“é€æœº",
    weight: 7.0,
    remarks: "å¹³é¢è¾“é€æœºæ€»é‡"
  },
  {
    subsystem: "åºå·3-ç²‰ç¢æœº",
    weight: 7.5,
    remarks: "ç²‰ç¢æœºæ€»é‡"
  }
]

// æ‰€æœ‰å­ç³»ç»Ÿæ€»é‡é‡
totalWeight = 7.0 + 7.5 = 14.5å¨
```

#### æå–å­é¡¹æ˜ç»†

```typescript
// æ¯ä¸ªå­é¡¹ä¸å¡«å†™é‡é‡ï¼Œåªæ ‡è®°æ‰€å±çš„å­ç³»ç»Ÿï¼ˆè®¾å¤‡ï¼‰
[
  {
    sequenceNo: 1,
    equipmentName: "å¹³é¢è¾“é€æœº",
    subItemName: "è¾“é€ä¸»ä½“",
    subsystem: "åºå·1-å¹³é¢è¾“é€æœº",  // âœ… æŒ‡å‘è®¾å¤‡
    weight: undefined  // âœ… é‡é‡ç•™ç©º
  },
  {
    sequenceNo: 1,
    equipmentName: "å¹³é¢è¾“é€æœº",
    subItemName: "ç´§å›ºä»¶",
    subsystem: "åºå·1-å¹³é¢è¾“é€æœº",  // âœ… æŒ‡å‘è®¾å¤‡
    weight: undefined
  },
  {
    sequenceNo: 3,
    equipmentName: "ç²‰ç¢æœº",
    subItemName: "ç²‰ç¢æœºæœ¬ä½“",
    subsystem: "åºå·3-ç²‰ç¢æœº",  // âœ… æŒ‡å‘è®¾å¤‡
    weight: undefined
  },
  {
    sequenceNo: 3,
    equipmentName: "ç²‰ç¢æœº",
    subItemName: "æ²¹ç¼¸åŠæ²¹ç®¡",
    subsystem: "åºå·3-ç²‰ç¢æœº",  // âœ… æŒ‡å‘è®¾å¤‡
    weight: undefined
  }
]
```

### 3. æ„å»ºè¯·æ±‚ä½“

```json
{
  "projectId": "1001",
  "batchNumber": "ç¬¬ä¸€è½¦",
  "subsystemWeights": [
    {
      "subsystem": "åºå·1-å¹³é¢è¾“é€æœº",
      "weight": 7.0,
      "remarks": "å¹³é¢è¾“é€æœºæ€»é‡"
    },
    {
      "subsystem": "åºå·3-ç²‰ç¢æœº",
      "weight": 7.5,
      "remarks": "ç²‰ç¢æœºæ€»é‡"
    }
  ],
  "shippingItems": [
    {
      "sequenceNo": 1,
      "equipmentName": "å¹³é¢è¾“é€æœº",
      "subItemName": "è¾“é€ä¸»ä½“",
      "subsystem": "åºå·1-å¹³é¢è¾“é€æœº",
      "weight": undefined
    },
    {
      "sequenceNo": 1,
      "equipmentName": "å¹³é¢è¾“é€æœº",
      "subItemName": "ç´§å›ºä»¶",
      "subsystem": "åºå·1-å¹³é¢è¾“é€æœº",
      "weight": undefined
    },
    {
      "sequenceNo": 3,
      "equipmentName": "ç²‰ç¢æœº",
      "subItemName": "ç²‰ç¢æœºæœ¬ä½“",
      "subsystem": "åºå·3-ç²‰ç¢æœº",
      "weight": undefined
    },
    {
      "sequenceNo": 3,
      "equipmentName": "ç²‰ç¢æœº",
      "subItemName": "æ²¹ç¼¸åŠæ²¹ç®¡",
      "subsystem": "åºå·3-ç²‰ç¢æœº",
      "weight": undefined
    }
    // ... å…¶ä»–å­é¡¹
  ]
}
```

### 4. åç«¯å¤„ç†

åç«¯æ ¹æ®æ¥å£è§„èŒƒ:

1. ä¼˜å…ˆä»`subsystemWeights`æ•°ç»„ä¸­è·å–é‡é‡
2. æ˜ç»†é¡¹çš„`subsystem`å­—æ®µåŒ¹é…åˆ°å­ç³»ç»Ÿå,ä½¿ç”¨å­ç³»ç»Ÿå®šä¹‰çš„é‡é‡
3. ç»Ÿè®¡æ€»é‡é‡æ—¶,ç›´æ¥ç´¯åŠ `subsystemWeights`æ•°ç»„ä¸­çš„é‡é‡å€¼

## è°ƒè¯•ä¿¡æ¯

### æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹

å¯¼å…¥æ—¶ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š

```
=== ğŸ“Š æ•°æ®æå–æ£€æŸ¥ ===
è®¾å¤‡æ˜ç»†æ€»æ•°é‡: 35

ğŸ“¦ å­ç³»ç»Ÿé‡é‡æ•°ç»„ï¼ˆæ ¼å¼åŒ–ï¼‰:
[
  {
    "subsystem": "åºå·1-å¹³é¢è¾“é€æœº",
    "weight": 7,
    "remarks": "å¹³é¢è¾“é€æœºæ€»é‡"
  },
  {
    "subsystem": "åºå·3-ç²‰ç¢æœº",
    "weight": 7.5,
    "remarks": "ç²‰ç¢æœºæ€»é‡"
  }
]

å­ç³»ç»Ÿæ•°é‡: 2
æ‰€æœ‰å­ç³»ç»Ÿæ€»é‡é‡: 14.5 å¨

ğŸ“‹ å­ç³»ç»Ÿé‡é‡æ˜ç»†è¡¨:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index) â”‚       å­ç³»ç»Ÿ       â”‚   é‡é‡   â”‚      å¤‡æ³¨      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    0    â”‚ 'åºå·1-å¹³é¢è¾“é€æœº' â”‚  '7å¨'   â”‚ 'å¹³é¢è¾“é€æœºæ€»é‡' â”‚
â”‚    1    â”‚   'åºå·3-ç²‰ç¢æœº'   â”‚ '7.5å¨'  â”‚  'ç²‰ç¢æœºæ€»é‡'  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š æ¯ä¸ªå­ç³»ç»Ÿçš„å­é¡¹æ•°é‡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index) â”‚       å­ç³»ç»Ÿ       â”‚ å­é¡¹æ•°é‡   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    0    â”‚ 'åºå·1-å¹³é¢è¾“é€æœº' â”‚   '3é¡¹'    â”‚
â”‚    1    â”‚   'åºå·3-ç²‰ç¢æœº'   â”‚   '9é¡¹'    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ å­é¡¹ç¤ºä¾‹ï¼ˆå‰3æ¡ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index) â”‚ åºå· â”‚  è®¾å¤‡åç§°    â”‚  å­é¡¹åç§°    â”‚ æ•°é‡ â”‚ å•ä½ â”‚ é‡é‡ â”‚    æ‰€å±å­ç³»ç»Ÿ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    0    â”‚  1   â”‚ 'å¹³é¢è¾“é€æœº' â”‚  'è¾“é€ä¸»ä½“'  â”‚  2   â”‚ 'å¥—' â”‚ 'ç©º' â”‚ 'åºå·1-å¹³é¢è¾“é€æœº' â”‚
â”‚    1    â”‚  1   â”‚ 'å¹³é¢è¾“é€æœº' â”‚   'ç´§å›ºä»¶'   â”‚  1   â”‚ 'å¥—' â”‚ 'ç©º' â”‚ 'åºå·1-å¹³é¢è¾“é€æœº' â”‚
â”‚    2    â”‚  3   â”‚   'ç²‰ç¢æœº'   â”‚ 'ç²‰ç¢æœºæœ¬ä½“' â”‚  2   â”‚ 'å¥—' â”‚ 'ç©º' â”‚   'åºå·3-ç²‰ç¢æœº'   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
=== ğŸ“Š æ•°æ®æå–æ£€æŸ¥ç»“æŸ ===
```

### å…³é”®æ£€æŸ¥ç‚¹

é€šè¿‡æ§åˆ¶å°è¾“å‡ºï¼Œå¯ä»¥éªŒè¯ï¼š

1. âœ… **å­ç³»ç»Ÿæ•°é‡æ­£ç¡®**: æœ‰å‡ ä¸ªè®¾å¤‡å°±æœ‰å‡ ä¸ªå­ç³»ç»Ÿ
2. âœ… **å­ç³»ç»Ÿå‘½åè§„èŒƒ**: æ ¼å¼ä¸º `åºå·X-è®¾å¤‡åç§°`
3. âœ… **æ¯ä¸ªè®¾å¤‡åªæœ‰ä¸€ä¸ªé‡é‡**: ä¸ä¼šé‡å¤ç´¯åŠ 
4. âœ… **å­é¡¹å…³è”æ­£ç¡®**: æ¯ä¸ªå­é¡¹çš„ `subsystem` å­—æ®µæŒ‡å‘æ­£ç¡®çš„è®¾å¤‡
5. âœ… **å­é¡¹é‡é‡ä¸ºç©º**: æ‰€æœ‰å­é¡¹çš„ `weight` éƒ½æ˜¯ `ç©º`

## ä¼˜åŠ¿å¯¹æ¯”

| ç»´åº¦             | åŸæ–¹æ¡ˆ         | ä¼˜åŒ–æ–¹æ¡ˆ                     |
| ---------------- | -------------- | ---------------------------- |
| **é‡é‡å¡«å†™**     | æ¯ä¸ªå­é¡¹éƒ½å¡«å†™ | åªåœ¨ subsystemWeights ä¸­å¡«å†™ |
| **é‡å¤è®¡ç®—é£é™©** | âŒ é«˜          | âœ… æ—                         |
| **ç»Ÿè®¡å‡†ç¡®æ€§**   | âŒ å¯èƒ½é”™è¯¯    | âœ… å‡†ç¡®                      |
| **æ•°æ®ç»´æŠ¤**     | âŒ å¤æ‚        | âœ… ç®€å•                      |
| **ç¬¦åˆè§„èŒƒ**     | âŒ ä¸ç¬¦åˆ      | âœ… ç¬¦åˆæ¨èæ–¹æ¡ˆ              |

## æµ‹è¯•å»ºè®®

### 1. æ­£å¸¸åœºæ™¯æµ‹è¯•

- å¯¼å…¥åŒ…å«å¤šä¸ªè®¾å¤‡çš„ Excel æ–‡ä»¶
- éªŒè¯`subsystemWeights`æ•°ç»„æ­£ç¡®æå–
- éªŒè¯æ€»é‡é‡è®¡ç®—æ­£ç¡®
- éªŒè¯å­é¡¹çš„`subsystem`å­—æ®µæ­£ç¡®æ ‡è®°

### 2. è¾¹ç•Œåœºæ™¯æµ‹è¯•

- Excel ä¸­æŸäº›è¡Œç¼ºå°‘é‡é‡æ•°æ®
- Excel ä¸­é‡é‡å­—æ®µåç§°ä¸åŒ(é‡é‡ã€é‡é‡(å¨)ã€é‡é‡ï¼ˆå¨ï¼‰)
- å•ä¸ªè®¾å¤‡æœ‰å¤šä¸ªå­é¡¹
- å¤šä¸ª sheet çš„æƒ…å†µ

### 3. éªŒè¯è¦ç‚¹

```typescript
// æ£€æŸ¥è¯·æ±‚ä½“æ•°æ®ç»“æ„
console.log(importData);

// åº”è¯¥åŒ…å«:
// 1. subsystemWeightsæ•°ç»„
// 2. shippingItemsä¸­æ¯é¡¹çš„weightä¸ºundefined
// 3. shippingItemsä¸­æ¯é¡¹çš„subsystemæœ‰å€¼
```

## ç›¸å…³æ–‡æ¡£

- [å‘è´§æ¸…å•å­ç³»ç»Ÿé‡é‡åŠŸèƒ½ä½¿ç”¨æ–‡æ¡£](./å‘è´§æ¸…å•å­ç³»ç»Ÿé‡é‡åŠŸèƒ½ä½¿ç”¨æ–‡æ¡£.md)
- [å‘è´§æ¸…å•è¯¦æƒ…é¡µé¢å­ç³»ç»Ÿé‡é‡å±•ç¤ºåŠŸèƒ½å®ç°æ€»ç»“](./å‘è´§æ¸…å•è¯¦æƒ…é¡µé¢å­ç³»ç»Ÿé‡é‡å±•ç¤ºåŠŸèƒ½å®ç°æ€»ç»“.md)

## å…³é”®ä¿®æ”¹ç‚¹æ€»ç»“

### 1. å­ç³»ç»Ÿæ¦‚å¿µæ˜ç¡®

- **åŸç†è§£**: å­ç³»ç»Ÿ = sheetï¼ˆè½¦æ¬¡ï¼‰
- **æ–°ç†è§£**: å­ç³»ç»Ÿ = è®¾å¤‡ï¼ˆåºå· + è®¾å¤‡åç§°ï¼‰
- **é‡è¦æ€§**: è¿™æ˜¯æ•´ä¸ªæ•°æ®ç»“æ„ä¼˜åŒ–çš„æ ¸å¿ƒ

### 2. é‡é‡æå–é€»è¾‘

```typescript
// âŒ é”™è¯¯åšæ³•ï¼šæŒ‰ sheet ç´¯åŠ æ‰€æœ‰é‡é‡
sheet.data.forEach(detail => {
  totalWeight += detail.é‡é‡;  // ä¼šé‡å¤ç´¯åŠ 
});

// âœ… æ­£ç¡®åšæ³•ï¼šæŒ‰è®¾å¤‡å»é‡
const processedEquipment = new Map();
sheet.data.forEach(detail => {
  const key = `${sequenceNo}-${equipmentName}`;
  if (!processedEquipment.has(key)) {
    // åªè®°å½•ä¸€æ¬¡
    processedEquipment.set(key, weight);
  }
});
```

### 3. æ•°æ®å…³è”å…³ç³»

```
è®¾å¤‡ï¼ˆå­ç³»ç»Ÿï¼‰
  â””â”€ é‡é‡: 7å¨
  â””â”€ å­é¡¹1: è¾“é€ä¸»ä½“ (weight: undefined, subsystem: "åºå·1-å¹³é¢è¾“é€æœº")
  â””â”€ å­é¡¹2: ç´§å›ºä»¶   (weight: undefined, subsystem: "åºå·1-å¹³é¢è¾“é€æœº")
```

æ¯ä¸ªå­é¡¹é€šè¿‡ `subsystem` å­—æ®µæŒ‡å‘å®ƒæ‰€å±çš„è®¾å¤‡ï¼Œä»è€Œé—´æ¥å…³è”åˆ°é‡é‡ã€‚

### 4. Excel æ•°æ®çš„æ­£ç¡®ç†è§£

| åºå· | åç§°       | åˆ†é¡¹     | é‡é‡ | è¯´æ˜                    |
| ---- | ---------- | -------- | ---- | ----------------------- |
| 1    | å¹³é¢è¾“é€æœº | è¾“é€ä¸»ä½“ | 7    | â† è®¾å¤‡æ€»é‡              |
| 1    | å¹³é¢è¾“é€æœº | ç´§å›ºä»¶   | 7    | â† åŒä¸€ä¸ª 7 å¨ï¼Œä¸æ˜¯æ–°å¢ |

**é‡è¦**: åŒä¸€åºå·çš„å¤šè¡Œé‡é‡æ•°æ®ç›¸åŒï¼Œä»£è¡¨çš„æ˜¯**è®¾å¤‡æ€»é‡**ï¼Œè€Œä¸æ˜¯æ¯ä¸ªå­é¡¹çš„ç‹¬ç«‹é‡é‡ï¼

## æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¼˜åŒ–:

1. âœ… **æ¦‚å¿µæ¸…æ™°**: æ˜ç¡®äº†"å­ç³»ç»Ÿ = è®¾å¤‡"çš„æ ¸å¿ƒæ¦‚å¿µ
2. âœ… **æ•°æ®ç»“æ„æ›´åˆç†**: ä½¿ç”¨`subsystemWeights`æ•°ç»„ç®¡ç†é‡é‡,ç¬¦åˆåç«¯æ¨èçš„æœ€ä½³å®è·µ
3. âœ… **é¿å…é‡å¤è®¡ç®—**: æŒ‰è®¾å¤‡å»é‡æå–é‡é‡,ç¡®ä¿æ¯ä¸ªè®¾å¤‡çš„é‡é‡åªè®¡ç®—ä¸€æ¬¡
4. âœ… **æå‡ç»Ÿè®¡å‡†ç¡®æ€§**: åç«¯å¯ä»¥ç›´æ¥ç´¯åŠ `subsystemWeights`æ•°ç»„,ä¸ä¼šå‡ºç°é‡å¤ç»Ÿè®¡
5. âœ… **ä»£ç æ›´æ¸…æ™°**: èŒè´£åˆ†ç¦»,æ•°æ®æå–é€»è¾‘æ›´åŠ æ˜ç¡®
6. âœ… **æ˜“äºç»´æŠ¤**: æœªæ¥å¦‚æœéœ€è¦è°ƒæ•´é‡é‡è®¡ç®—é€»è¾‘,åªéœ€ä¿®æ”¹`extractSubsystemWeights`å‡½æ•°
7. âœ… **è°ƒè¯•å‹å¥½**: æä¾›äº†è¯¦ç»†çš„æ§åˆ¶å°è¾“å‡º,ä¾¿äºéªŒè¯æ•°æ®æ­£ç¡®æ€§

---

**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸  
**ç‰ˆæœ¬**: v2.0 (é‡å¤§ä¿®æ­£)
