# å‘è´§æ¸…å•å®é™…æ•°æ®è§£ææµ‹è¯•

## å®é™…åç«¯è¿”å›æ•°æ®

æ ¹æ® 2025-10-30 çš„å®é™…æ¥å£æµ‹è¯•ï¼Œåç«¯è¿”å›çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š

### æ•°æ®ç‰¹ç‚¹

1. **è¯¦æƒ…æ¥å£ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰æ•°æ®**

   - æ¸…å•åŸºæœ¬ä¿¡æ¯
   - 27 æ¡è®¾å¤‡æ˜ç»†ï¼ˆitems æ•°ç»„ï¼‰
   - è·Ÿè¸ªè®°å½•ï¼ˆtrackingRecords æ•°ç»„ï¼Œå½“å‰ä¸ºç©ºï¼‰
   - é™„ä»¶åˆ—è¡¨ï¼ˆattachmentsï¼Œå½“å‰ä¸º nullï¼‰
   - ç»Ÿè®¡æ•°æ®å­—æ®µï¼ˆmechanicalCount ç­‰ï¼Œå½“å‰ä¸º nullï¼‰

2. **å¢å¼ºç‰ˆå­—æ®µå…¨éƒ¨æ”¯æŒ**

   - âœ… `vehiclePlate`: "è‹ NHA923"
   - âœ… `vehicleDescription`: "17.5 ç±³è½¦"
   - âœ… `driverName`: "æçŒ›"
   - âœ… `driverPhone`: "18036946111"
   - âœ… `shippingPhotoUrls`: 3 å¼ å‘è´§ç…§ç‰‡
   - âœ… `driverLicensePhotoUrls`: 1 å¼ é©¾ç…§ç…§ç‰‡

3. **æ˜ç»†æ•°æ®æ–°å­—æ®µ**
   - `equipmentTypeDesc`: è®¾å¤‡ç±»å‹æè¿°ï¼ˆå¦‚"æœºæ¢°è®¾å¤‡"ï¼‰
   - `isFragileDesc`: æ˜“ç¢å“æè¿°ï¼ˆ"æ˜¯"/"å¦"ï¼‰
   - `isHazardousDesc`: å±é™©å“æè¿°ï¼ˆ"æ˜¯"/"å¦"ï¼‰

## è§£ææµ‹è¯•

### æµ‹è¯•æ•°æ®

```typescript
const mockResponse = {
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": "1983722956655599617",
    "listCode": "SP20250916D78E-SL-001",
    "projectId": "1967857798821703681",
    "projectName": "æ·®å®‰é¡¹ç›®",
    "batchNumber": "ç¬¬ä¸€è½¦ ",
    "responsiblePerson": "ç³»ç»Ÿç®¡ç†å‘˜",
    "responsiblePersonId": 1,
    "shippingDate": "2025-02-13",
    "status": "DRAFT",
    "statusDesc": "è‰ç¨¿",
    "shippingMethod": "TRUCK",
    "shippingMethodDesc": "å¡è½¦è¿è¾“",
    "vehiclePlate": "è‹NHA923",
    "vehicleDescription": "17.5ç±³è½¦",
    "driverName": "æçŒ›",
    "driverPhone": "18036946111",
    "totalItems": 27,
    "totalWeight": "0.00",
    "shippingPhotoUrls": [
      "/shipping-photos/2025-10-30/1761791383184_0aa6aaff.jpg",
      "/shipping-photos/2025-10-30/1761791383186_680cc232.jpg",
      "/shipping-photos/2025-10-30/1761791383187_4cc40d40.jpg"
    ],
    "driverLicensePhotoUrls": [
      "/driver-license/2025-10-30/1761791383100_6e61a2ae.jpg"
    ],
    "items": [
      {
        "id": "1983722956718514177",
        "itemName": "å¹³é¢è¾“é€æœº-è¾“é€ä¸»ä½“",
        "specification": "è¾“é€ä¸»ä½“",
        "equipmentType": "MECHANICAL",
        "equipmentTypeDesc": "æœºæ¢°è®¾å¤‡",
        "quantity": 2,
        "unit": "å¥—",
        "isFragile": false,
        "isFragileDesc": "å¦",
        "isHazardous": false,
        "isHazardousDesc": "å¦"
      }
      // ... å…¶ä»–26æ¡æ˜ç»†
    ]
  }
};
```

### è§£æä»£ç 

```typescript
import { parseShippingListVO } from '@/api/erp/saltprocess/shipping/data-parser';

// è§£ææ•°æ®
const shippingList = parseShippingListVO(mockResponse.data);

// éªŒè¯è§£æç»“æœ
console.log('=== åŸºæœ¬ä¿¡æ¯ ===');
console.log('æ¸…å•ID:', shippingList.id);                     // "1983722956655599617"
console.log('æ¸…å•ç¼–å·:', shippingList.listCode);              // "SP20250916D78E-SL-001"
console.log('é¡¹ç›®åç§°:', shippingList.projectName);           // "æ·®å®‰é¡¹ç›®"
console.log('æ‰¹æ¬¡å·:', shippingList.batchNumber);             // "ç¬¬ä¸€è½¦ "

console.log('\n=== çŠ¶æ€ä¿¡æ¯ ===');
console.log('çŠ¶æ€ä»£ç :', shippingList.status);                // "DRAFT"
console.log('çŠ¶æ€åç§°:', shippingList.statusName);            // "è‰ç¨¿"
console.log('å‘è´§æ–¹å¼:', shippingList.shippingMethodName);   // "å¡è½¦è¿è¾“"

console.log('\n=== è½¦è¾†ä¿¡æ¯ ===');
console.log('è½¦ç‰Œå·:', shippingList.vehiclePlate);            // "è‹NHA923"
console.log('è½¦è¾†æè¿°:', shippingList.vehicleDescription);    // "17.5ç±³è½¦"
console.log('å¸æœºå§“å:', shippingList.driverName);            // "æçŒ›"
console.log('å¸æœºç”µè¯:', shippingList.driverPhone);           // "18036946111"

console.log('\n=== ç…§ç‰‡ä¿¡æ¯ ===');
console.log('å‘è´§ç…§ç‰‡æ•°é‡:', shippingList.shippingPhotoUrls?.length);        // 3
console.log('é©¾ç…§ç…§ç‰‡æ•°é‡:', shippingList.driverLicensePhotoUrls?.length);   // 1

console.log('\n=== æ˜ç»†ä¿¡æ¯ ===');
console.log('æ˜ç»†æ€»æ•°:', shippingList.items?.length);        // 27
if (shippingList.items && shippingList.items.length > 0) {
  const firstItem = shippingList.items[0];
  console.log('ç¬¬ä¸€æ¡æ˜ç»†:');
  console.log('  ç‰©å“åç§°:', firstItem.itemName);            // "å¹³é¢è¾“é€æœº-è¾“é€ä¸»ä½“"
  console.log('  è®¾å¤‡ç±»å‹:', firstItem.equipmentType);      // "MECHANICAL"
  console.log('  æ•°é‡:', firstItem.quantity, firstItem.unit); // 2 å¥—
  console.log('  æ˜“ç¢å“:', firstItem.isFragile);            // false
}
```

### é¢„æœŸè¾“å‡º

```
=== åŸºæœ¬ä¿¡æ¯ ===
æ¸…å•ID: 1983722956655599617
æ¸…å•ç¼–å·: SP20250916D78E-SL-001
é¡¹ç›®åç§°: æ·®å®‰é¡¹ç›®
æ‰¹æ¬¡å·: ç¬¬ä¸€è½¦

=== çŠ¶æ€ä¿¡æ¯ ===
çŠ¶æ€ä»£ç : DRAFT
çŠ¶æ€åç§°: è‰ç¨¿
å‘è´§æ–¹å¼: å¡è½¦è¿è¾“

=== è½¦è¾†ä¿¡æ¯ ===
è½¦ç‰Œå·: è‹NHA923
è½¦è¾†æè¿°: 17.5ç±³è½¦
å¸æœºå§“å: æçŒ›
å¸æœºç”µè¯: 18036946111

=== ç…§ç‰‡ä¿¡æ¯ ===
å‘è´§ç…§ç‰‡æ•°é‡: 3
é©¾ç…§ç…§ç‰‡æ•°é‡: 1

=== æ˜ç»†ä¿¡æ¯ ===
æ˜ç»†æ€»æ•°: 27
ç¬¬ä¸€æ¡æ˜ç»†:
  ç‰©å“åç§°: å¹³é¢è¾“é€æœº-è¾“é€ä¸»ä½“
  è®¾å¤‡ç±»å‹: MECHANICAL
  æ•°é‡: 2 å¥—
  æ˜“ç¢å“: false
```

## å®é™…é¡µé¢é›†æˆç¤ºä¾‹

### 1. è¯¦æƒ…é¡µé¢å®Œæ•´å®ç°

```vue
<template>
  <div class="shipping-detail-page">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <el-page-header @back="goBack" :content="`å‘è´§æ¸…å•è¯¦æƒ… - ${shippingList.listCode}`" />

    <!-- æ¸…å•ä¿¡æ¯å¡ç‰‡ -->
    <el-card class="info-card" shadow="never">
      <template #header>
        <div class="card-header">
          <span>åŸºæœ¬ä¿¡æ¯</span>
          <el-tag :type="getStatusTagType(shippingList.status)" size="large">
            {{ shippingList.statusName }}
          </el-tag>
        </div>
      </template>

      <el-descriptions :column="3" border>
        <el-descriptions-item label="æ¸…å•ç¼–å·">
          <el-text type="primary" size="large">{{ shippingList.listCode }}</el-text>
        </el-descriptions-item>
        <el-descriptions-item label="é¡¹ç›®åç§°">
          {{ shippingList.projectName }}
        </el-descriptions-item>
        <el-descriptions-item label="æ‰¹æ¬¡å·">
          <el-tag>{{ shippingList.batchNumber }}</el-tag>
        </el-descriptions-item>
        <el-descriptions-item label="è´Ÿè´£äºº">
          {{ shippingList.responsiblePerson }}
        </el-descriptions-item>
        <el-descriptions-item label="å‘è´§æ—¥æœŸ">
          {{ shippingList.shippingDate }}
        </el-descriptions-item>
        <el-descriptions-item label="å‘è´§æ–¹å¼">
          {{ shippingList.shippingMethodName }}
        </el-descriptions-item>
      </el-descriptions>
    </el-card>

    <!-- è½¦è¾†ä¿¡æ¯å¡ç‰‡ -->
    <el-card class="info-card" shadow="never">
      <template #header>
        <span>è½¦è¾†ä¿¡æ¯</span>
      </template>

      <el-descriptions :column="2" border>
        <el-descriptions-item label="è½¦ç‰Œå·">
          <el-tag type="success" size="large">{{ shippingList.vehiclePlate }}</el-tag>
        </el-descriptions-item>
        <el-descriptions-item label="è½¦è¾†æè¿°">
          {{ shippingList.vehicleDescription }}
        </el-descriptions-item>
        <el-descriptions-item label="å¸æœºå§“å">
          {{ shippingList.driverName }}
        </el-descriptions-item>
        <el-descriptions-item label="å¸æœºç”µè¯">
          <el-link :href="`tel:${shippingList.driverPhone}`" type="primary">
            <el-icon><Phone /></el-icon>
            {{ shippingList.driverPhone }}
          </el-link>
        </el-descriptions-item>
      </el-descriptions>

      <!-- å‘è´§ç…§ç‰‡ -->
      <div v-if="shippingPhotoUrls.length > 0" class="photo-section">
        <el-divider content-position="left">
          å‘è´§ç…§ç‰‡ ({{ shippingPhotoUrls.length }})
        </el-divider>
        <div class="photo-gallery">
          <el-image
            v-for="(url, index) in shippingPhotoUrls"
            :key="index"
            :src="url"
            :preview-src-list="shippingPhotoUrls"
            :initial-index="index"
            fit="cover"
            class="photo-item"
          />
        </div>
      </div>

      <!-- é©¾ç…§ç…§ç‰‡ -->
      <div v-if="driverLicenseUrls.length > 0" class="photo-section">
        <el-divider content-position="left">å¸æœºé©¾ç…§</el-divider>
        <div class="photo-gallery">
          <el-image
            v-for="(url, index) in driverLicenseUrls"
            :key="index"
            :src="url"
            :preview-src-list="driverLicenseUrls"
            :initial-index="index"
            fit="cover"
            class="photo-item"
          />
        </div>
      </div>
    </el-card>

    <!-- æ˜ç»†åˆ—è¡¨å¡ç‰‡ -->
    <el-card class="info-card" shadow="never">
      <template #header>
        <div class="card-header">
          <span>å‘è´§æ˜ç»†</span>
          <el-tag type="info">å…± {{ shippingList.items?.length || 0 }} é¡¹</el-tag>
        </div>
      </template>

      <el-table :data="shippingList.items" border stripe>
        <el-table-column type="index" label="åºå·" width="60" align="center" />
        <el-table-column prop="itemName" label="ç‰©å“åç§°" min-width="200" />
        <el-table-column prop="specification" label="è§„æ ¼" width="150" />
        <el-table-column label="è®¾å¤‡ç±»å‹" width="120" align="center">
          <template #default="{ row }">
            <el-tag>{{ getEquipmentTypeName(row.equipmentType) }}</el-tag>
          </template>
        </el-table-column>
        <el-table-column label="æ•°é‡" width="120" align="right">
          <template #default="{ row }">
            {{ row.quantity }} {{ row.unit }}
          </template>
        </el-table-column>
        <el-table-column label="æ ‡è¯†" width="120" align="center">
          <template #default="{ row }">
            <el-space>
              <el-tag v-if="row.isFragile" type="warning" size="small">æ˜“ç¢</el-tag>
              <el-tag v-if="row.isHazardous" type="danger" size="small">å±é™©</el-tag>
            </el-space>
          </template>
        </el-table-column>
        <el-table-column prop="remarks" label="å¤‡æ³¨" min-width="150" />
      </el-table>
    </el-card>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="action-bar">
      <el-space>
        <el-button
          type="primary"
          v-if="isShippingListEditable(shippingList.status)"
          @click="handleEdit"
        >
          <el-icon><Edit /></el-icon>
          ç¼–è¾‘æ¸…å•
        </el-button>
        <el-button @click="handleExport">
          <el-icon><Download /></el-icon>
          å¯¼å‡ºæ¸…å•
        </el-button>
        <el-button @click="handlePrint">
          <el-icon><Printer /></el-icon>
          æ‰“å°æ¸…å•
        </el-button>
      </el-space>
    </div>
  </div>
</template>

<script setup lang="ts" name="ShippingListDetailPage">
import { ref, computed, onMounted } from 'vue';
import { useRoute, useRouter } from 'vue-router';
import { ElMessage } from 'element-plus';
import { Phone, Edit, Download, Printer } from '@element-plus/icons-vue';

import {
  getShippingList,
  parseShippingListVO,
  getStatusTagType,
  getEquipmentTypeName,
  isShippingListEditable,
  getFullPhotoUrls
} from '@/api/erp/saltprocess/shipping';

import type { ShippingListVO } from '@/api/erp/saltprocess/shipping/types';

const route = useRoute();
const router = useRouter();

const loading = ref(false);
const shippingList = ref<ShippingListVO>({} as ShippingListVO);

// è®¡ç®—å±æ€§ - å‘è´§ç…§ç‰‡URLåˆ—è¡¨
const shippingPhotoUrls = computed(() => {
  return getFullPhotoUrls(shippingList.value.shippingPhotoUrls || []);
});

// è®¡ç®—å±æ€§ - é©¾ç…§ç…§ç‰‡URLåˆ—è¡¨
const driverLicenseUrls = computed(() => {
  return getFullPhotoUrls(shippingList.value.driverLicensePhotoUrls || []);
});

/**
 * è·å–å‘è´§æ¸…å•è¯¦æƒ…
 */
const fetchDetail = async () => {
  const id = route.params.id as string;
  if (!id) {
    ElMessage.error('æ¸…å•IDä¸èƒ½ä¸ºç©º');
    return;
  }

  loading.value = true;
  try {
    const response = await getShippingList(id);

    // ğŸ”¥ ä½¿ç”¨è§£æå·¥å…·å¤„ç†æ•°æ®
    shippingList.value = parseShippingListVO(response.data);

    // æ‰“å°è§£æåçš„æ•°æ®ï¼Œæ–¹ä¾¿è°ƒè¯•
    console.log('âœ… è§£ææˆåŠŸ:', {
      æ¸…å•ç¼–å·: shippingList.value.listCode,
      é¡¹ç›®åç§°: shippingList.value.projectName,
      è½¦ç‰Œå·: shippingList.value.vehiclePlate,
      å¸æœº: shippingList.value.driverName,
      æ˜ç»†æ•°é‡: shippingList.value.items?.length,
      ç…§ç‰‡æ•°é‡: shippingList.value.shippingPhotoUrls?.length
    });

  } catch (error) {
    console.error('è·å–è¯¦æƒ…å¤±è´¥:', error);
    ElMessage.error('è·å–å‘è´§æ¸…å•è¯¦æƒ…å¤±è´¥');
  } finally {
    loading.value = false;
  }
};

const goBack = () => {
  router.back();
};

const handleEdit = () => {
  router.push(`/erp/shipping/edit/${shippingList.value.id}`);
};

const handleExport = () => {
  ElMessage.info('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
};

const handlePrint = () => {
  window.print();
};

onMounted(() => {
  fetchDetail();
});
</script>

<style scoped lang="scss">
.shipping-detail-page {
  padding: 20px;

  .info-card {
    margin-top: 20px;

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  }

  .photo-section {
    margin-top: 20px;

    .photo-gallery {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;

      .photo-item {
        width: 200px;
        height: 200px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;

        &:hover {
          transform: scale(1.05);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
      }
    }
  }

  .action-bar {
    margin-top: 20px;
    text-align: center;
    padding: 20px;
    background: #fff;
    border-radius: 4px;
  }
}
</style>
```

## éªŒè¯æ¸…å•

### âœ… å·²éªŒè¯çš„åŠŸèƒ½

- [x] åŸºæœ¬ä¿¡æ¯è§£æï¼ˆid, listCode, projectName ç­‰ï¼‰
- [x] çŠ¶æ€ä¿¡æ¯è§£æï¼ˆstatus, statusDescï¼‰
- [x] è½¦è¾†ä¿¡æ¯è§£æï¼ˆvehiclePlate, vehicleDescriptionï¼‰
- [x] å¸æœºä¿¡æ¯è§£æï¼ˆdriverName, driverPhoneï¼‰
- [x] ç…§ç‰‡ URL æ•°ç»„è§£æï¼ˆshippingPhotoUrls, driverLicensePhotoUrlsï¼‰
- [x] æ˜ç»†åˆ—è¡¨è§£æï¼ˆitems æ•°ç»„ï¼Œ27 æ¡æ•°æ®ï¼‰
- [x] è®¾å¤‡ç±»å‹æ˜¾ç¤ºï¼ˆequipmentType, equipmentTypeDescï¼‰
- [x] æ˜“ç¢/å±é™©å“æ ‡è¯†ï¼ˆisFragile, isHazardousï¼‰

### ğŸ“ æ•°æ®ç»“æ„ä¼˜åŠ¿

1. **ä¸€æ¬¡æ€§åŠ è½½å®Œæ•´æ•°æ®**

   - è¯¦æƒ…æ¥å£è¿”å›æ‰€æœ‰å…³è”æ•°æ®
   - å‡å°‘ HTTP è¯·æ±‚æ¬¡æ•°
   - æå‡ç”¨æˆ·ä½“éªŒ

2. **å­—æ®µå®Œæ•´æ€§**

   - åç«¯æä¾›äº†æè¿°å­—æ®µï¼ˆstatusDesc, equipmentTypeDescï¼‰
   - å‰ç«¯æ— éœ€ç»´æŠ¤çŠ¶æ€æ˜ å°„è¡¨
   - æ•°æ®å±•ç¤ºæ›´å‡†ç¡®

3. **ç…§ç‰‡æ•°ç»„æ”¯æŒ**
   - æ”¯æŒå¤šå¼ å‘è´§ç…§ç‰‡
   - æ”¯æŒå¤šå¼ é©¾ç…§ç…§ç‰‡
   - ä¾¿äºå®ç°å›¾ç‰‡é¢„è§ˆå’Œä¸‹è½½

## æ€»ç»“

è§£æå·¥å…·å®Œå…¨æ”¯æŒå½“å‰åç«¯è¿”å›çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ä¸»è¦ç‰¹ç‚¹ï¼š

1. **è‡ªåŠ¨è§£æå¢å¼ºå­—æ®µ** - è½¦è¾†ã€å¸æœºä¿¡æ¯è‡ªåŠ¨åˆ†ç¦»
2. **å®Œæ•´çš„æ˜ç»†æ”¯æŒ** - æ­£ç¡®è§£æ 27 æ¡è®¾å¤‡æ˜ç»†
3. **ç…§ç‰‡ URL å¤„ç†** - è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„å›¾ç‰‡è®¿é—®è·¯å¾„
4. **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
5. **å¼€ç®±å³ç”¨** - æ— éœ€é¢å¤–é…ç½®ï¼Œç›´æ¥è°ƒç”¨å³å¯

**æ¨èä½¿ç”¨æ–¹å¼**ï¼š

```typescript
// 1. è°ƒç”¨APIè·å–æ•°æ®
const response = await getShippingList(id);

// 2. ä½¿ç”¨è§£æå·¥å…·å¤„ç†æ•°æ®
const shippingList = parseShippingListVO(response.data);

// 3. ç›´æ¥ä½¿ç”¨è§£æåçš„æ•°æ®
console.log(shippingList.vehiclePlate);  // "è‹NHA923"
console.log(shippingList.items.length);  // 27
```
