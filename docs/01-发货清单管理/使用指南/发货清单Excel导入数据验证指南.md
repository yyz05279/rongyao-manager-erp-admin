# 发货清单 Excel 导入数据验证指南

## 快速验证步骤

### 1. 打开浏览器控制台

在导入发货清单之前，先打开浏览器的开发者工具：

- **Chrome/Edge**: 按 `F12` 或 `Ctrl + Shift + I`（Mac: `Cmd + Option + I`）
- **Firefox**: 按 `F12`
- 切换到 **Console** (控制台) 标签页

### 2. 执行 Excel 导入操作

1. 点击"Excel 导入"按钮
2. 选择发货清单 Excel 文件
3. 等待文件解析完成
4. 填写项目、负责人、批次号等信息
5. **点击"确认导入"按钮**

### 3. 查看控制台输出

导入时会在控制台输出详细的调试信息，重点关注以下内容：

#### 3.1 子系统重量数组（格式化）

```
📦 子系统重量数组（格式化）:
[
  {
    "subsystem": "序号1-平面输送机",
    "weight": 7,
    "remarks": "平面输送机总重"
  },
  {
    "subsystem": "序号3-粉碎机",
    "weight": 7.5,
    "remarks": "粉碎机总重"
  }
]
```

**验证要点**:

- ✅ `subsystem` 格式: `序号X-设备名称`
- ✅ `weight` 是数字，不是字符串
- ✅ 每个设备只出现一次（不重复）

#### 3.2 子系统重量明细表

```
📋 子系统重量明细表:
┌─────────┬────────────────────┬──────────┬────────────────┐
│ (index) │       子系统       │   重量   │      备注      │
├─────────┼────────────────────┼──────────┼────────────────┤
│    0    │ '序号1-平面输送机' │  '7吨'   │ '平面输送机总重' │
│    1    │   '序号3-粉碎机'   │ '7.5吨'  │  '粉碎机总重'  │
└─────────┴────────────────────┴──────────┴────────────────┘
```

**验证要点**:

- ✅ 子系统数量 = Excel 中有重量的设备数量
- ✅ 总重量 = 各设备重量之和（不是 Excel 所有行的累加）

#### 3.3 每个子系统的子项数量

```
📊 每个子系统的子项数量:
┌─────────┬────────────────────┬────────────┐
│ (index) │       子系统       │ 子项数量   │
├─────────┼────────────────────┼────────────┤
│    0    │ '序号1-平面输送机' │   '3项'    │
│    1    │   '序号3-粉碎机'   │   '9项'    │
└─────────┴────────────────────┴────────────┘
```

**验证要点**:

- ✅ 子项数量 = Excel 中该设备的行数

#### 3.4 子项示例

```
📝 子项示例（前3条）:
┌─────────┬──────┬──────────────┬──────────────┬──────┬──────┬──────┬────────────────────┐
│ (index) │ 序号 │  设备名称    │  子项名称    │ 数量 │ 单位 │ 重量 │    所属子系统      │
├─────────┼──────┼──────────────┼──────────────┼──────┼──────┼──────┼────────────────────┤
│    0    │  1   │ '平面输送机' │  '输送主体'  │  2   │ '套' │ '空' │ '序号1-平面输送机' │
│    1    │  1   │ '平面输送机' │   '紧固件'   │  1   │ '套' │ '空' │ '序号1-平面输送机' │
│    2    │  3   │   '粉碎机'   │ '粉碎机本体' │  2   │ '套' │ '空' │   '序号3-粉碎机'   │
└─────────┴──────┴──────────────┴──────────────┴──────┴──────┴──────┴────────────────────┘
```

**验证要点**:

- ✅ 所有子项的"重量"列都是"空"
- ✅ 所有子项的"所属子系统"都正确指向对应的设备

## 常见问题排查

### 问题 1: 子系统重量数组为空

**症状**:

```
子系统数量: 0
⚠️ 没有提取到子系统重量数据！
```

**可能原因**:

1. Excel 中"重量"列名称不匹配
2. 所有重量值都为 0 或空
3. 数据格式错误

**解决方法**:

- 检查 Excel 中重量列的名称（应该是：`重量`、`重量（吨）`、`重量(吨)` 或 `重量吨`）
- 确保至少有一个设备填写了重量数据

### 问题 2: 总重量计算错误

**症状**:

```
所有子系统总重量: 28 吨  // 应该是 14.5 吨
```

**可能原因**:

- 重复累加了相同设备的重量

**检查方法**:

1. 查看"子系统重量明细表"
2. 确认每个设备只出现一次
3. 手动计算：7 + 7.5 = 14.5 吨

### 问题 3: 子项的所属子系统不正确

**症状**:

```
所属子系统: "第一车"  // 错误：应该是 "序号1-平面输送机"
```

**可能原因**:

- 代码回退到旧版本

**解决方法**:

- 检查 `convertEquipmentDetails` 函数中的 `subsystem` 赋值
- 应该是：`subsystem: \`序号${sequenceNo}-${equipmentName}\``

## 数据正确性检查清单

在导入完成后，使用此检查清单验证数据正确性：

- [ ] **子系统数量**: 等于 Excel 中有重量的设备数量
- [ ] **子系统命名**: 格式为 `序号X-设备名称`
- [ ] **每个设备唯一**: 同一设备不会出现多次
- [ ] **总重量准确**: 等于各设备重量之和（不是所有 Excel 行的重量累加）
- [ ] **子项重量为空**: 所有子项的 `weight` 都是 `空`
- [ ] **子项关联正确**: 每个子项的 `所属子系统` 指向正确的设备
- [ ] **子项数量匹配**: 每个子系统的子项数量 = Excel 中该设备的行数

## Excel 数据示例

### 正确的 Excel 格式

| 序号 | 名称       | 分项       | 数量 | 单位 | 重量（吨） | 备注     |
| ---- | ---------- | ---------- | ---- | ---- | ---------- | -------- |
| 1    | 平面输送机 | 输送主体   | 2    | 套   | **7**      | 整机发货 |
| 1    | 平面输送机 | 紧固件     | 1    | 套   | **7**      | 见清单   |
| 2    | 子输送     | 卸料溜壳   | 2    | 套   |            | -        |
| 3    | 粉碎机     | 粉碎机本体 | 2    | 套   | **7.5**    | -        |
| 3    | 粉碎机     | 油缸及油管 | 8    | 套   | **7.5**    | -        |

**说明**:

- 序号 1（平面输送机）的两行重量都是 7 吨 → 这是**设备总重**，不是每行的重量
- 序号 3（粉碎机）的多行重量都是 7.5 吨 → 这是**设备总重**
- 序号 2（子输送）没有重量 → 不会生成子系统重量记录

### 预期的提取结果

```json
{
  "subsystemWeights": [
    {
      "subsystem": "序号1-平面输送机",
      "weight": 7,
      "remarks": "平面输送机总重"
    },
    {
      "subsystem": "序号3-粉碎机",
      "weight": 7.5,
      "remarks": "粉碎机总重"
    }
  ],
  "总重量": 14.5
}
```

**不会出现**:

- ❌ `"weight": 14` (7 + 7)
- ❌ `"weight": 15` (7.5 + 7.5)
- ❌ 序号 2 的子系统（因为没有重量）

## 技术支持

如果验证过程中发现数据不符合预期，请：

1. 截图控制台输出
2. 提供 Excel 文件示例
3. 说明具体的错误现象
4. 联系开发团队

---

**文档版本**: v1.0  
**最后更新**: 2025-10-30  
**适用范围**: 发货清单 Excel 导入功能
