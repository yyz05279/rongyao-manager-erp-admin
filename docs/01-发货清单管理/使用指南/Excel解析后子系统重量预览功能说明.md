# Excel 解析后子系统重量预览功能说明

## 功能概述

在上传 Excel 文件并解析成功后，系统会**立即在控制台输出子系统重量数组**，无需等到点击"确认导入"，便于提前验证数据正确性。

## 触发时机

1. 用户选择 Excel 文件
2. 文件解析成功
3. **自动触发** - 立即输出子系统重量预览

## 控制台输出示例

```
================================================================================
📊 Excel 解析完成 - 子系统重量预览
================================================================================

✅ 检测到 2 个子系统
📦 总重量: 14.50 吨

📋 子系统重量数组（完整JSON）:
[
  {
    "subsystem": "序号1-平面输送机+序号2-子输送",
    "weight": 7,
    "remarks": "平面输送机+子输送总重"
  },
  {
    "subsystem": "序号3-粉碎机",
    "weight": 7.5,
    "remarks": "粉碎机总重"
  }
]

📊 子系统重量明细表:
┌─────────┬─────────────────────────────────────┬──────────┬──────────────────────┐
│ (index) │              子系统                 │   重量   │         备注         │
├─────────┼─────────────────────────────────────┼──────────┼──────────────────────┤
│    1    │ '序号1-平面输送机+序号2-子输送'     │  '7吨'   │ '平面输送机+子输送总重' │
│    2    │ '序号3-粉碎机'                      │ '7.5吨'  │   '粉碎机总重'       │
└─────────┴─────────────────────────────────────┴──────────┴──────────────────────┘

💡 数据验证要点:
  ✓ 子系统数量是否符合预期？
  ✓ 总重量是否正确？
  ✓ 子系统命名是否准确（多个设备用"+"连接）？
  ✓ 备注信息是否清晰？

================================================================================
```

## 验证步骤

### 1. 打开浏览器控制台

- 按 `F12` 打开开发者工具
- 切换到 **Console** 标签页

### 2. 上传 Excel 文件

- 点击"Excel 导入"按钮
- 选择发货清单 Excel 文件
- 等待文件解析完成（会显示"文件解析成功"提示）

### 3. 查看控制台输出

立即查看控制台，会看到详细的子系统重量预览信息。

### 4. 验证数据

根据控制台输出的验证要点进行检查：

#### ✅ 子系统数量是否正确？

- 统计 Excel 中有几组连续相同的重量值
- 与输出的子系统数量对比

#### ✅ 总重量是否准确？

- 计算各组重量之和
- 与输出的总重量对比

**例如**：

- 序号 1+序号 2：7 吨（一组）
- 序号 3：7.5 吨（一组）
- 总重量 = 7 + 7.5 = 14.5 吨 ✅

#### ✅ 子系统命名是否合理？

- 单个设备：`序号X-设备名称`
- 多个设备打包：`序号X-设备1+序号Y-设备2`

#### ✅ 备注信息是否清晰？

- 只显示设备名称（去掉"序号 X-"前缀）
- 多个设备用"+"连接
- 结尾加上"总重"

## 常见情况

### 情况 1：未检测到子系统重量

```
⚠️  未检测到任何子系统重量数据
可能原因：
  1. Excel中没有填写重量数据
  2. 重量列名称不匹配（应为：重量、重量（吨）、重量(吨)、重量吨）
```

**解决方法**：

- 检查 Excel 中是否有"重量"相关列
- 确认列名是否正确
- 检查是否至少有一行填写了重量数据

### 情况 2：子系统数量不对

**可能原因**：

- Excel 中重量值不连续（中间有空行或不同重量）
- 对合并单元格理解有误

**检查方法**：

- 仔细查看 Excel，确认哪些行的重量值是相同的
- 连续相同的重量值会被分为一组

### 情况 3：总重量计算错误

**可能原因**：

- 重复累加了相同设备的重量

**验证方法**：

- 查看 JSON 数组中的 weight 值
- 手动计算各 weight 之和
- 确认是否有重复的子系统

## 优势

### 1. **提前发现问题**

不用等到导入完成，解析阶段就能发现数据问题。

### 2. **清晰的数据展示**

- JSON 格式：便于复制和验证
- 表格格式：直观清晰
- 提示信息：指导验证

### 3. **节省时间**

如果数据有问题，可以立即修改 Excel，无需等待完整导入流程。

## 注意事项

1. **控制台必须打开**：预览信息只在控制台输出
2. **每次解析都会输出**：重新上传文件会重新输出
3. **不影响导入**：这只是预览，不影响后续的导入操作

## 技术实现

### 调用时机

```typescript
// 文件解析成功后立即调用
if (parsedData.value.success) {
  ElMessage.success('文件解析成功');

  // 📊 立即提取并输出子系统重量数组
  previewSubsystemWeights();
}
```

### 核心函数

```typescript
const previewSubsystemWeights = () => {
  // 提取子系统重量
  const subsystemWeights = extractSubsystemWeights();

  // 格式化输出
  console.log(JSON.stringify(subsystemWeights, null, 2));
  console.table(...);
};
```

## 相关文档

- [发货清单 Excel 合并单元格重量处理说明](../功能实现文档/发货清单Excel合并单元格重量处理说明.md)
- [发货清单 Excel 导入数据验证指南](./发货清单Excel导入数据验证指南.md)

---

**文档版本**: v1.0  
**创建时间**: 2025-10-30  
**适用功能**: Excel 导入发货清单
