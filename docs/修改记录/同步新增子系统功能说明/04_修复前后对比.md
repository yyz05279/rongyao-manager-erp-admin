# ä¿®å¤å‰åå¯¹æ¯”

## æ•°æ®æµå¯¹æ¯”

### âŒ ä¿®å¤å‰çš„é—®é¢˜æµç¨‹

```
ProjectSubsystemSelector.handleConfirm()
  â†“ emit('confirm', {
      mode: 'reference',
      referenceTemplateId: 123,
      referenceTemplateName: "æ¨¡æ¿åç§°",  â† æœ‰å€¼
      sequenceNumber: 1,
      remarks: ""
    })
  
  â†“ ProjectSubsystemManagement.handleSubsystemConfirm(
      selectedTemplates: SubsystemTemplateVO[]  â† æœŸæœ›é”™è¯¯ï¼
    )
  
  â†“ å°è¯•è®¿é—®å­—æ®µï¼ˆé”™è¯¯çš„å­—æ®µåï¼‰
    template.id                    âŒ undefined
    template.templateName          âŒ undefined
    template.templateCode          âŒ undefined
    template.category              âŒ undefined
    template.description           âŒ undefined
  
  â†“ æ„å»º BatchAddSubsystemForm
    templateId: undefined          âŒ
    subsystemName: ''              âŒ ç©ºå­—ç¬¦ä¸²
    subsystemCode: undefined       âŒ
    category: undefined            âŒ
    ...
  
  â†“ API batchAddSubsystemTemplates
  
  âŒ é”™è¯¯: å­ç³»ç»Ÿåç§°ä¸èƒ½ä¸ºç©º
```

### âœ… ä¿®å¤åçš„æ­£ç¡®æµç¨‹

```
ProjectSubsystemSelector.handleConfirm()
  â†“ emit('confirm', {
      mode: 'reference',
      referenceTemplateId: 123,
      referenceTemplateName: "æ¨¡æ¿åç§°",  â† æœ‰å€¼
      sequenceNumber: 1,
      remarks: ""
    })
  
  â†“ ProjectSubsystemManagement.handleSubsystemConfirm(
      selectedTemplates: Array<{
        mode: string;
        referenceTemplateId: number;
        referenceTemplateName: string;
        sequenceNumber: number;
        remarks: string;
      }>  â† æ­£ç¡®ï¼
    )
  
  â†“ ä½¿ç”¨æ­£ç¡®çš„å­—æ®µåè®¿é—®
    template.referenceTemplateId       âœ… æœ‰å€¼: 123
    template.referenceTemplateName     âœ… æœ‰å€¼: "æ¨¡æ¿åç§°"
    template.sequenceNumber            âœ… æœ‰å€¼: 1
    template.remarks                   âœ… æœ‰å€¼: ""
  
  â†“ æ„å»º BatchAddSubsystemForm
    templateId: 123                    âœ… æœ‰å€¼
    subsystemName: "æ¨¡æ¿åç§°"          âœ… æœ‰å€¼
    subsystemCode: ''                  âœ…
    category: ''                       âœ…
    sequenceNumber: 1                  âœ… æœ‰å€¼
    remarks: "ä»æ¨¡æ¿åˆ›å»ºï¼šæ¨¡æ¿åç§°"    âœ… æœ‰å€¼
  
  â†“ API batchAddSubsystemTemplates
  
  âœ… æˆåŠŸ: æˆåŠŸæ·»åŠ  1 ä¸ªå­ç³»ç»Ÿ
```

---

## ä»£ç å¯¹æ¯”

### å‚æ•°ç±»å‹å¯¹æ¯”

**ä¿®æ”¹å‰ âŒ:**
```typescript
const handleSubsystemConfirm = async (selectedTemplates: SubsystemTemplateVO[])
```

**ä¿®æ”¹å âœ…:**
```typescript
const handleSubsystemConfirm = async (
  selectedTemplates: Array<{
    mode: string;
    referenceTemplateId: number;
    referenceTemplateName: string;
    sequenceNumber: number;
    remarks: string;
  }>
)
```

### å­—æ®µæ˜ å°„å¯¹æ¯”

**ä¿®æ”¹å‰ âŒ:**
```typescript
const subsystemsData = selectedTemplates.map((template, index) => ({
  templateId: template.id,                    // âŒ undefined
  subsystemName: template.templateName || '', // âŒ undefined
  subsystemCode: template.templateCode || '', // âŒ undefined
  category: template.category || '',          // âŒ undefined
  description: template.description || '',    // âŒ undefined
  status: 'ACTIVE',
  sequenceNumber: index + 1,                  // âŒ ä¸ç”¨å®é™…å€¼
  remarks: `ä»æ¨¡æ¿åˆ›å»ºï¼š${template.templateName}` // âŒ undefined
}));
```

**ä¿®æ”¹å âœ…:**
```typescript
const subsystemsData = selectedTemplates.map((template) => ({
  templateId: template.referenceTemplateId,          // âœ… æœ‰å€¼
  subsystemName: template.referenceTemplateName || '', // âœ… æœ‰å€¼
  subsystemCode: '',                                  // åç«¯ç”Ÿæˆ
  category: '',                                       // åç«¯è¡¥å……
  description: '',                                    // åç«¯è¡¥å……
  status: 'ACTIVE',
  sequenceNumber: template.sequenceNumber,            // âœ… æœ‰å€¼
  remarks: template.remarks || 
    `ä»æ¨¡æ¿åˆ›å»ºï¼š${template.referenceTemplateName}`   // âœ… æœ‰å€¼
}));
```

---

## å…³é”®æ”¹è¿›æ€»ç»“

| æ–¹é¢ | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|--------|--------|
| å‚æ•°ç±»å‹åŒ¹é… | âŒ ç±»å‹ä¸åŒ¹é… | âœ… ç±»å‹ä¸€è‡´ |
| å­—æ®µåå‡†ç¡® | âŒ ä½¿ç”¨ä¸å­˜åœ¨çš„å­—æ®µ | âœ… ä½¿ç”¨å®é™…å­—æ®µ |
| subsystemName | âŒ undefined æˆ– '' | âœ… æœ‰å€¼ |
| sequenceNumber | âŒ é‡æ–°è®¡ç®— | âœ… ä½¿ç”¨åŸå§‹å€¼ |
| ç¼–è¯‘çŠ¶æ€ | âŒ æœ‰é”™è¯¯ | âœ… æ— é”™è¯¯ |
| API è°ƒç”¨ | âŒ å¤±è´¥ | âœ… æˆåŠŸ |

---

## æ—¥å¿—è¾“å‡ºå¯¹æ¯”

**ä¿®æ”¹å‰ âŒ:**
```
ğŸ“ [1/1] æ„å»ºå­ç³»ç»Ÿæ•°æ®: {
  templateId: undefined,
  templateName: undefined,
  subsystemCode: undefined,
  category: undefined,
  sequenceNumber: 1
}
```

**ä¿®æ”¹å âœ…:**
```
ğŸ“ [1] æ„å»ºå­ç³»ç»Ÿæ•°æ®: {
  mode: 'reference',
  templateId: 123,
  subsystemName: 'æ¨¡æ¿åç§°',
  sequenceNumber: 1,
  remarks: 'ä»æ¨¡æ¿åˆ›å»ºï¼šæ¨¡æ¿åç§°'
}
```

---

**ä¿®å¤éªŒè¯**: âœ… å®Œæˆ  
**é¢„æœŸæ•ˆæœ**: âœ… å®ç°

