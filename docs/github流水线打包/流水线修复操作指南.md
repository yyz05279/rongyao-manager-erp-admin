# GitHub 流水线修复操作指南

## 快速开始

### 方式一：使用自动脚本（推荐）

#### macOS/Linux
```bash
chmod +x scripts/fix-problematic-docs.sh
./scripts/fix-problematic-docs.sh
```

#### Windows
```cmd
scripts\fix-problematic-docs.bat
```

### 方式二：手动操作

#### 第一步：禁用 macOS 构建

已自动完成，以下文件已修改：
- `.github/workflows/build-mac.yml`
- `.github/workflows/build-mac-intel.yml`
- `.github/workflows/build-mac-arm64.yml`

验证修改：
```bash
grep -A 3 "^on:" .github/workflows/build-mac.yml
```

#### 第二步：移除有问题的文档文件

```bash
# 从 Git 追踪中移除
git rm --cached 'src/views/erp/saltprocess/records/binary/# 二元化盐记录管理 - "修改"按钮功能修复验证.md'
git rm --cached 'src/views/erp/saltprocess/records/binary/二元化盐记录管理 - "修改"按钮问题详细分析.md'

# 提交更改
git commit -m "chore: 从版本控制中移除有问题的文档文件

- 移除包含特殊字符的文档文件
- 这些文件导致 Windows Git 检出失败
- 文档应该放在 /docs 目录中"

# 推送到远程
git push origin master
```

#### 第三步：验证修复

```bash
# 检查 Git 状态
git status

# 验证文件已移除
git ls-files | grep "# 二元化盐记录管理"

# 应该没有输出，表示文件已移除
```

## 验证 GitHub Actions 运行

### 1. 检查最近的 Workflow 运行

```bash
# 使用 GitHub CLI
gh run list --workflow=build-windows.yml --limit=5

# 或访问 GitHub 网页
# https://github.com/yyz05279/rongyao-manager-erp-admin/actions
```

### 2. 测试标签推送

```bash
# 创建测试标签
git tag v0.0.4-test

# 推送标签
git push origin v0.0.4-test

# 监控 Actions 运行
# 应该只看到 "Build Windows (x86_64)" 任务
# 不应该看到任何 macOS 构建任务
```

### 3. 验证构建输出

```bash
# 检查 dist 目录中没有 .md 文件
find dist -name "*.md" -type f

# 应该没有输出
```

## 常见问题

### Q1: 脚本执行失败，提示权限不足

**解决方案：**
```bash
# macOS/Linux
chmod +x scripts/fix-problematic-docs.sh
./scripts/fix-problematic-docs.sh
```

### Q2: 文件名中的特殊字符导致 Git 命令失败

**解决方案：**
```bash
# 使用引号和转义
git rm --cached 'src/views/erp/saltprocess/records/binary/# 二元化盐记录管理 - "修改"按钮功能修复验证.md'

# 或使用 git 的 -f 选项
git rm -f --cached src/views/erp/saltprocess/records/binary/'# 二元化盐记录管理 - "修改"按钮功能修复验证.md'
```

### Q3: 需要完全清除历史中的文件

**解决方案：** 使用 BFG Repo-Cleaner

```bash
# 安装 BFG
brew install bfg  # macOS
# 或从 https://rtyley.github.io/bfg-repo-cleaner/ 下载

# 创建镜像克隆
git clone --mirror https://github.com/yyz05279/rongyao-manager-erp-admin.git

# 清理文件
bfg --delete-files '# 二元化盐记录管理*' rongyao-manager-erp-admin.git

# 清理引用
cd rongyao-manager-erp-admin.git
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 推送回远程
git push --mirror
```

## 后续建议

### 1. 更新 .gitignore

已包含规则：
```
src/**/*.md
```

### 2. 文件命名规范

避免在文件名中使用以下特殊字符：
- `#` - 注释符号
- `"` - 引号
- `*` - 通配符
- `?` - 通配符
- `<` `>` - 重定向符
- `|` - 管道符

### 3. 文档管理

- 所有项目文档放在 `/docs` 目录
- 不要在 `src` 目录中存放 `.md` 文件
- 使用 kebab-case 命名：`feature-description.md`

## 相关资源

- [GitHub Actions 文档](https://docs.github.com/en/actions)
- [Git 忽略文件](https://docs.github.com/en/get-started/git-basics/ignoring-files)
- [BFG Repo-Cleaner](https://rtyley.github.io/bfg-repo-cleaner/)
- [GitHub CLI](https://cli.github.com/)

