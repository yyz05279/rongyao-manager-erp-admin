# 项目设备系统列表操作栏和编辑表单修改记录

## 修改概述

本次修改主要针对项目设备系统列表页面进行了两项优化：
1. 将操作栏的"更多"下拉按钮替换为独立的"激活"按钮
2. 在编辑弹窗中将 `projectId` 和 `templateId` 字段设置为只读

## 修改时间

2025-01-XX

## 修改内容

### 1. 操作栏按钮调整

**文件**: `src/views/erp/saltprocess/equipment-system/index.vue`

#### 1.1 模板部分修改（第147-178行）

**修改前**:
- 操作栏包含：查看详情、编辑、复制、更多（下拉菜单）、删除
- "更多"下拉菜单包含：激活、完成、归档三个选项

**修改后**:
- 操作栏包含：查看详情、编辑、复制、激活、删除
- 移除了"更多"下拉菜单
- 新增独立的"激活"按钮
- 激活按钮特性：
  - 图标：`Check`
  - 类型：`success`（绿色）
  - 当设备系统状态已为 `ACTIVE` 时，按钮禁用
  - 点击触发 `handleActivate` 函数

```vue
<el-tooltip content="激活" placement="top">
  <el-button
    link
    type="success"
    icon="Check"
    :disabled="scope.row.status === 'ACTIVE'"
    @click.stop="handleActivate(scope.row)"
    v-hasPermi="['erp:saltprocess:projectEquipmentSystem:edit']"
  />
</el-tooltip>
```

#### 1.2 脚本部分修改

**新增函数**（第423-433行）:
```typescript
// 激活设备系统
const handleActivate = async (row: ProjectEquipmentSystemVO) => {
  try {
    await updateSystemStatus(row.id, 'ACTIVE');
    ElMessage.success('已设置为激活状态');
    getList();
  } catch (error) {
    console.error('激活失败:', error);
    ElMessage.error('激活失败');
  }
};
```

**删除的函数**:
- `createDropdownHandler`: 下拉菜单命令包装函数（不再需要）
- `handleCommand`: 下拉菜单命令处理函数（不再需要）
- `handleAdd`: 未使用的新增函数（代码清理）

### 2. 编辑弹窗字段限制

**文件**: `src/views/erp/saltprocess/equipment-system/components/ProjectEquipmentSystemForm.vue`

#### 2.1 项目ID字段（第19-21行）

**修改前**:
```vue
<el-form-item label="项目ID" prop="projectId">
  <el-input-number v-model="form.projectId" :min="1" placeholder="请输入项目ID" style="width: 100%" />
</el-form-item>
```

**修改后**:
```vue
<el-form-item label="项目ID" prop="projectId">
  <el-input-number v-model="form.projectId" :min="1" placeholder="请输入项目ID" :disabled="true" style="width: 100%" />
</el-form-item>
```

#### 2.2 模板ID字段（第50-52行）

**修改前**:
```vue
<el-form-item label="模板ID" prop="templateId">
  <el-input-number v-model="form.templateId" :min="0" placeholder="可选，从模板创建时填写" style="width: 100%" />
</el-form-item>
```

**修改后**:
```vue
<el-form-item label="模板ID" prop="templateId">
  <el-input-number v-model="form.templateId" :min="0" placeholder="可选，从模板创建时填写" :disabled="true" style="width: 100%" />
</el-form-item>
```

## 功能特性

### 激活按钮特性
1. **独立按钮**: 不再隐藏在下拉菜单中，操作更直观
2. **状态感知**: 当设备系统已处于激活状态时，按钮自动禁用
3. **权限控制**: 需要 `erp:saltprocess:projectEquipmentSystem:edit` 权限
4. **用户反馈**: 操作成功后显示提示信息并刷新列表

### 只读字段特性
1. **项目ID**: 编辑时不可修改，保证设备系统与项目的关联关系不变
2. **模板ID**: 编辑时不可修改，保证设备系统与模板的关联关系不变
3. **视觉反馈**: 禁用状态下字段显示为灰色背景，明确告知用户不可编辑
4. **数据保护**: 提交表单时这两个字段的值保持不变

## 用户体验改进

1. **操作更便捷**: 激活功能从下拉菜单提升为独立按钮，减少点击次数
2. **界面更清晰**: 常用操作直接展示，不常用操作（完成、归档）可通过其他方式实现
3. **数据更安全**: 关键关联字段设为只读，防止误操作导致数据关系错误
4. **状态更明确**: 禁用状态的按钮和字段提供清晰的视觉反馈

## 注意事项

1. 激活按钮仅在设备系统状态不为 `ACTIVE` 时可用
2. 项目ID和模板ID在编辑时始终为只读状态
3. 如需修改项目或模板关联，需要通过其他方式（如重新关联）
4. 删除了"完成"和"归档"的快捷操作，如需这些功能可考虑其他实现方式

## 相关文档

- [项目设备系统管理接口文档](./项目设备系统管理接口文档.md)
- [项目开发编码规范](../项目开发编码规范.md)

