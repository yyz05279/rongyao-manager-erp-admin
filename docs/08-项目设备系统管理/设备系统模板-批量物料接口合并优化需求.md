# è®¾å¤‡ç³»ç»Ÿæ¨¡æ¿-æ‰¹é‡ç‰©æ–™æ¥å£åˆå¹¶ä¼˜åŒ–éœ€æ±‚

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

å°†ç°æœ‰çš„æ‰¹é‡æ–°å¢ï¼ˆPOSTï¼‰å’Œæ‰¹é‡ç¼–è¾‘ï¼ˆPUTï¼‰ç‰©æ–™æ¥å£åˆå¹¶ä¸ºä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­åŒæ—¶å¤„ç†æ–°å¢å’Œæ›´æ–°æ“ä½œã€‚

## ğŸ¯ æ”¹é€ ç›®æ ‡

-   **å‡å°‘æ¥å£è°ƒç”¨æ¬¡æ•°**ï¼šå‰ç«¯åªéœ€è°ƒç”¨ä¸€æ¬¡æ¥å£
-   **æå‡æ•°æ®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ“ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆ
-   **ä¼˜åŒ–æ€§èƒ½**ï¼šå‡å°‘ç½‘ç»œè¯·æ±‚å’Œæ•°æ®åº“è¿æ¥

## ğŸ“ å½“å‰æ¥å£

### æ‰¹é‡æ–°å¢ç‰©æ–™

-   **è·¯å¾„**: `POST /erp/saltprocess/equipmentSystemTemplate/item/{itemTemplateId}/materials/batch`
-   **åŠŸèƒ½**: æ‰¹é‡æ–°å¢ç‰©æ–™ï¼ˆæ‰€æœ‰ç‰©æ–™éƒ½æ²¡æœ‰ idï¼‰

### æ‰¹é‡ç¼–è¾‘ç‰©æ–™

-   **è·¯å¾„**: `PUT /erp/saltprocess/equipmentSystemTemplate/item/{itemTemplateId}/materials/batch`
-   **åŠŸèƒ½**: æ‰¹é‡æ›´æ–°ç‰©æ–™ï¼ˆæ‰€æœ‰ç‰©æ–™éƒ½æœ‰ idï¼‰

## ğŸ”§ æ”¹é€ æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šå¢å¼º POST æ¥å£æ”¯æŒ Upsert æ“ä½œ

ä¿®æ”¹ POST æ¥å£é€»è¾‘ï¼Œé€šè¿‡ `id` å­—æ®µåˆ¤æ–­æ‰§è¡Œæ–°å¢è¿˜æ˜¯æ›´æ–°ï¼š

```
POST /erp/saltprocess/equipmentSystemTemplate/item/{itemTemplateId}/materials/batch
```

#### è¯·æ±‚ä½“ç¤ºä¾‹

```json
[
    {
        // æ²¡æœ‰ id å­—æ®µ â†’ æ–°å¢æ“ä½œ
        "itemTemplateId": "1993838344819052546",
        "materialId": "1985570846126518273",
        "materialName": "æ§½å¼æ¡¥æ¶",
        "specification": "",
        "defaultQuantity": 1,
        "defaultUnit": "ä¸ª",
        "status": "ACTIVE",
        "isRequired": true,
        "remarks": ""
    },
    {
        // æœ‰ id å­—æ®µ â†’ æ›´æ–°æ“ä½œ
        "id": "1993838345569832961",
        "itemTemplateId": "1993838344819052546",
        "materialName": "å‚ç›´ä¸‹å¼¯é€š",
        "specification": "",
        "defaultQuantity": 2,
        "defaultUnit": "ä¸ª",
        "status": "ACTIVE",
        "isRequired": true,
        "remarks": "ä¿®æ”¹æ•°é‡"
    }
]
```

#### åç«¯å¤„ç†é€»è¾‘

```java
@PostMapping("/item/{itemTemplateId}/materials/batch")
@Transactional(rollbackFor = Exception.class)
public R<BatchOperationResultVo> batchSaveMaterials(
    @PathVariable Long itemTemplateId,
    @RequestBody List<ErpSaltMaterialTemplateBo> materials
) {
    int insertCount = 0;
    int updateCount = 0;
    List<String> errors = new ArrayList<>();

    for (ErpSaltMaterialTemplateBo material : materials) {
        try {
            // ç»Ÿä¸€è®¾ç½® itemTemplateId
            material.setItemTemplateId(itemTemplateId);

            if (material.getId() != null) {
                // æœ‰ id â†’ æ‰§è¡Œæ›´æ–°
                materialTemplateService.updateById(material);
                updateCount++;
            } else {
                // æ²¡æœ‰ id â†’ æ‰§è¡Œæ–°å¢
                materialTemplateService.save(material);
                insertCount++;
            }
        } catch (Exception e) {
            errors.add("ç‰©æ–™å¤„ç†å¤±è´¥: " + material.getMaterialName() + ", åŸå› : " + e.getMessage());
        }
    }

    return R.ok(new BatchOperationResultVo(insertCount, updateCount, 0, errors));
}
```

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": {
        "insertCount": 1,
        "updateCount": 2,
        "deleteCount": 0,
        "errors": []
    }
}
```

## âœ… å‰ç«¯å·²å®Œæˆçš„ä¿®æ”¹

å‰ç«¯ä»£ç å·²è°ƒæ•´ä¸ºåˆå¹¶è°ƒç”¨ï¼š

```typescript
// åˆå¹¶æ–°å¢å’Œæ›´æ–°æ•°æ®ï¼Œç»Ÿä¸€è°ƒç”¨ POST æ¥å£
const allMaterials = [
    ...materialsToAdd.map((material) => ({
        // æ–°å¢ç‰©æ–™ï¼Œæ²¡æœ‰ id å­—æ®µ
        itemTemplateId: itemTemplateId,
        materialId: material.materialId,
        // ...å…¶ä»–å­—æ®µ
    })),
    ...materialsToUpdate.map((material) => ({
        id: material.id, // æ›´æ–°ç‰©æ–™ï¼Œæœ‰ id å­—æ®µ
        itemTemplateId: itemTemplateId,
        materialId: material.materialId,
        // ...å…¶ä»–å­—æ®µ
    })),
];

await batchAddEquipmentSystemItemMaterials(itemTemplateId, allMaterials);
```

## ğŸ“Œ åç«¯æ”¹é€ æ³¨æ„äº‹é¡¹

1. **äº‹åŠ¡ç®¡ç†**ï¼šç¡®ä¿æ‰€æœ‰æ“ä½œåœ¨åŒä¸€äº‹åŠ¡ä¸­
2. **æ•°æ®éªŒè¯**ï¼šéªŒè¯ç‰©æ–™å±äºæŒ‡å®šçš„å­é¡¹æ¨¡æ¿
3. **é”™è¯¯å¤„ç†**ï¼šè¿”å›è¯¦ç»†çš„æ“ä½œç»Ÿè®¡å’Œé”™è¯¯ä¿¡æ¯
4. **å‘åå…¼å®¹**ï¼šä¿ç•™åŸæœ‰çš„ PUT æ¥å£ï¼ˆå¯é€‰ï¼‰

---

**åˆ›å»ºæ—¶é—´**: 2025-01-27
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: âœ… å·²å®Œæˆ

## ğŸ“‹ å®ç°è®°å½•

### åç«¯å®ç°å®Œæˆï¼ˆ2025-01-27ï¼‰

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**

1. **BatchOperationResultVo.java** - æ·»åŠ  insertCountã€updateCountã€deleteCount å­—æ®µï¼Œæ–°å¢ upsertResult å·¥å‚æ–¹æ³•
2. **IErpSaltMaterialTemplateService.java** - æ·»åŠ  batchSaveMaterials æ–¹æ³•å£°æ˜
3. **ErpSaltMaterialTemplateServiceImpl.java** - å®ç° batchSaveMaterials æ–¹æ³•ï¼ˆUpsert é€»è¾‘ï¼‰
4. **ErpSaltEquipmentSystemTemplateController.java** - ä¿®æ”¹ POST æ¥å£æ”¯æŒ Upsertï¼Œä¿ç•™ PUT æ¥å£å‘åå…¼å®¹ï¼ˆæ ‡è®°@Deprecatedï¼‰

**å®ç°ç‰¹æ€§ï¼š**

-   âœ… é€šè¿‡ id å­—æ®µåˆ¤æ–­æ–°å¢/æ›´æ–°æ“ä½œ
-   âœ… åŒä¸€äº‹åŠ¡ä¸­å¤„ç†æ‰€æœ‰æ“ä½œ
-   âœ… è¯¦ç»†çš„æ“ä½œç»Ÿè®¡ï¼ˆinsertCountã€updateCountã€failureCountï¼‰
-   âœ… å®Œæ•´çš„æ•°æ®éš”ç¦»éªŒè¯
-   âœ… æ‰‹åŠ¨å‚æ•°æ ¡éªŒï¼ˆAddGroup/EditGroupï¼‰
-   âœ… å‘åå…¼å®¹ï¼ˆPUT æ¥å£ä¿ç•™ï¼‰
