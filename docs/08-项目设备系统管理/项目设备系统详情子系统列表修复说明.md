# é¡¹ç›®è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…å­ç³»ç»Ÿåˆ—è¡¨ä¿®å¤è¯´æ˜

## ä¿®å¤æ—¥æœŸ
2025-11-24

## é—®é¢˜æè¿°

é¡¹ç›®è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…é¡µé¢ï¼ˆProjectEquipmentSystemDetail.vueï¼‰ä¸­çš„å­ç³»ç»Ÿåˆ—è¡¨ç»„ä»¶ï¼ˆProjectSubsystemManagement.vueï¼‰æ— æ³•æ˜¾ç¤ºæ•°æ®ã€‚

### æ ¹æœ¬åŸå› 

1. **ç±»å‹å®šä¹‰ä¸å®Œæ•´**ï¼š`ProjectSubsystemVO` æ¥å£ç¼ºå°‘åç«¯è¿”å›çš„é¢å¤–å­—æ®µï¼ˆ`createDept`ã€`createBy`ã€`tenantId`ã€`delFlag` ç­‰ï¼‰
2. **å­—æ®µç±»å‹ä¸åŒ¹é…**ï¼šæŸäº›å­—æ®µå¯èƒ½ä¸º `null`ï¼Œä½†ç±»å‹å®šä¹‰ä¸­æœªåŒ…å« `null` ç±»å‹
3. **totalWeight å­—æ®µç±»å‹é—®é¢˜**ï¼šåç«¯è¿”å›çš„æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ˆå¦‚ `"0.00"`ï¼‰ï¼Œä½†å‰ç«¯æœŸæœ›çš„æ˜¯æ•°å­—ç±»å‹

## ä¿®å¤å†…å®¹

### 1. æ›´æ–°ç±»å‹å®šä¹‰

**æ–‡ä»¶**: `src/api/erp/saltprocess/equipment-system/types.ts`

#### ä¿®æ”¹å‰ï¼š
```typescript
export interface ProjectSubsystemVO {
  id: string | number;
  projectSystemId: string | number;
  projectId: string | number;
  templateId?: string | number;
  subsystemCode: string;
  subsystemName: string;
  subsystemType: string;
  category?: string;
  specification?: string;
  model?: string;
  manufacturer?: string;
  description?: string;
  itemCount?: number;
  materialCount?: number;
  totalWeight?: number;
  status: string;
  sequenceNumber?: number;
  remarks?: string;
  version?: number;
  createTime?: string;
  updateTime?: string;
}
```

#### ä¿®æ”¹åï¼š
```typescript
export interface ProjectSubsystemVO {
  id: string | number;
  projectSystemId: string | number;
  projectId: string | number;
  templateId?: string | number | null;
  subsystemCode: string;
  subsystemName: string;
  subsystemType: string;
  category?: string | null;
  specification?: string | null;
  model?: string | null;
  manufacturer?: string | null;
  description?: string | null;
  itemCount?: number;
  materialCount?: number;
  totalWeight?: number | string;  // æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼ˆå¦‚ "0.00"ï¼‰
  status: string;
  sequenceNumber?: number;
  remarks?: string | null;
  version?: number;
  createTime?: string;
  updateTime?: string;
  // åç«¯è¿”å›çš„é¢å¤–å­—æ®µ
  createDept?: string | number | null;
  createBy?: string | number | null;
  updateBy?: string | number | null;
  tenantId?: string | null;
  delFlag?: number;
}
```

### 2. ä¿®æ”¹ ProjectSubsystemManagement ç»„ä»¶

**æ–‡ä»¶**: `src/views/erp/saltprocess/equipment-system/components/ProjectSubsystemManagement.vue`

#### ä¸»è¦ä¿®æ”¹ï¼š

1. **å¯¼å…¥ç»Ÿä¸€ç±»å‹å®šä¹‰**ï¼š
```typescript
import type { ProjectSubsystemVO } from '@/api/erp/saltprocess/equipment-system/types';
```

2. **æ·»åŠ è°ƒè¯•æ—¥å¿—**ï¼š
```typescript
watch(
  () => props.projectSubsystems,
  (newSubsystems) => {
    console.log[object Object]SubsystemManagement - æ¥æ”¶åˆ°å­ç³»ç»Ÿæ•°æ®:', newSubsystems);
    if (newSubsystems !== undefined) {
      subsystemList.value = newSubsystems;
      console.log('âœ… å­ç³»ç»Ÿåˆ—è¡¨å·²æ›´æ–°ï¼Œæ•°é‡:', subsystemList.value.length);
    }
  },
  { deep: true, immediate: true }
);
```

3. **æ·»åŠ  formatWeight è¾…åŠ©å‡½æ•°**ï¼š
```typescript
// æ ¼å¼åŒ–é‡é‡æ˜¾ç¤º
const formatWeight = (weight?: number | string | null): string => {
  if (weight === null || weight === undefined) {
    return '-';
  }
  
  // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›
  if (typeof weight === 'string') {
    const num = parseFloat(weight);
    return isNaN(num) ? '-' : num.toFixed(2);
  }
  
  // å¦‚æœæ˜¯æ•°å­—ï¼Œæ ¼å¼åŒ–ä¸ºä¸¤ä½å°æ•°
  return weight.toFixed(2);
};
```

4. **æ›´æ–°è¡¨æ ¼åˆ—**ï¼š
```vue
<el-table-column label="æ€»é‡é‡(kg)" width="120" align="center">
  <template #default="scope">
    {{ formatWeight(scope.row.totalWeight) }}
  </template>
</el-table-column>
```

### 3. ä¿®æ”¹ ProjectSubsystemDetail ç»„ä»¶

**æ–‡ä»¶**: `src/views/erp/saltprocess/equipment-system/components/ProjectSubsystemDetail.vue`

#### ä¸»è¦ä¿®æ”¹ï¼š

1. **ä½¿ç”¨ç»Ÿä¸€ç±»å‹å®šä¹‰**ï¼š
```typescript
import type { ProjectSubsystemVO } from '@/api/erp/saltprocess/equipment-system/types';
type ProjectSubsystemDetailVO = ProjectSubsystemVO;
```

2. **æ·»åŠ  formatWeight å‡½æ•°**ï¼ˆä¸ ProjectSubsystemManagement ç›¸åŒï¼‰

3. **æ›´æ–°æ€»é‡é‡æ˜¾ç¤º**ï¼š
```vue
<el-descriptions-item label="æ€»é‡é‡">
  {{ formatWeight(detail.totalWeight) }}
</el-descriptions-item>
```

### 4. æ·»åŠ è°ƒè¯•æ—¥å¿—åˆ° ProjectEquipmentSystemDetail

**æ–‡ä»¶**: `src/views/erp/saltprocess/equipment-system/components/ProjectEquipmentSystemDetail.vue`

```typescript
const getDetail = async () => {
  loading.value = true;
  try {
    const res = await getProjectEquipmentSystem(props.systemId);
    detail.value = res.data;
    console.log('ğŸ“¦ ProjectEquipmentSystemDetail - è·å–åˆ°çš„è¯¦æƒ…æ•°æ®:', res.data);
    console.log('ğŸ“‹ é¡¹ç›®å­ç³»ç»Ÿåˆ—è¡¨:', res.data.projectSubsystems);
    console.log('ğŸ“Š å­ç³»ç»Ÿæ•°é‡:', res.data.projectSubsystems?.length || 0);
  } catch (error) {
    console.error('è·å–è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…å¤±è´¥:', error);
    ElMessage.error('è·å–è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…å¤±è´¥');
  } finally {
    loading.value = false;
  }
};
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ•°æ®
ä½¿ç”¨å®é™…APIè¿”å›çš„æ•°æ®è¿›è¡Œæµ‹è¯•ï¼š
- é¡¹ç›®ID: `1967857798821703681`
- è®¾å¤‡ç³»ç»ŸID: `1991748283537481729`
- å­ç³»ç»Ÿæ•°é‡: 2æ¡ï¼ˆ"å­è¾“é€" å’Œ "æµ‹è¯•01"ï¼‰

### é¢„æœŸç»“æœ
- âœ… å­ç³»ç»Ÿåˆ—è¡¨èƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤º2æ¡æ•°æ®
- âœ… æ‰€æœ‰å­—æ®µéƒ½èƒ½æ­£ç¡®æ˜ å°„å’Œæ˜¾ç¤º
- âœ… `null` å€¼æ˜¾ç¤ºä¸º "-"
- âœ… `totalWeight` å­—ç¬¦ä¸²ç±»å‹æ­£ç¡®æ ¼å¼åŒ–
- âœ… è¡¨æ ¼å¸ƒå±€æ­£å¸¸
- âœ… æ— TypeScriptç±»å‹é”™è¯¯
- âœ… æ§åˆ¶å°è¾“å‡ºè°ƒè¯•æ—¥å¿—

## æ–‡ä»¶å˜æ›´æ¸…å•

### ä¿®æ”¹æ–‡ä»¶ï¼š
1. `src/api/erp/saltprocess/equipment-system/types.ts`
   - æ›´æ–° `ProjectSubsystemVO` æ¥å£å®šä¹‰
   - æ·»åŠ åç«¯è¿”å›çš„é¢å¤–å­—æ®µ
   - æ”¯æŒ `null` ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹çš„ `totalWeight`

2. `src/views/erp/saltprocess/equipment-system/components/ProjectSubsystemManagement.vue`
   - å¯¼å…¥ç»Ÿä¸€ç±»å‹å®šä¹‰
   - æ·»åŠ è°ƒè¯•æ—¥å¿—
   - æ·»åŠ  `formatWeight` è¾…åŠ©å‡½æ•°
   - æ›´æ–°è¡¨æ ¼åˆ—æ˜¾ç¤ºé€»è¾‘

3. `src/views/erp/saltprocess/equipment-system/components/ProjectSubsystemDetail.vue`
   - ä½¿ç”¨ç»Ÿä¸€ç±»å‹å®šä¹‰
   - æ·»åŠ  `formatWeight` è¾…åŠ©å‡½æ•°
   - æ›´æ–°æ€»é‡é‡æ˜¾ç¤º

4. `src/views/erp/saltprocess/equipment-system/components/ProjectEquipmentSystemDetail.vue`
   - æ·»åŠ è°ƒè¯•æ—¥å¿—

### æ–°å¢æ–‡ä»¶ï¼š
- `docs/08-é¡¹ç›®è®¾å¤‡ç³»ç»Ÿç®¡ç†/é¡¹ç›®è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…å­ç³»ç»Ÿåˆ—è¡¨ä¿®å¤è¯´æ˜.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰

## åç»­å»ºè®®

1. **ç§»é™¤è°ƒè¯•æ—¥å¿—**ï¼šåœ¨ç¡®è®¤åŠŸèƒ½æ­£å¸¸åï¼Œå¯ä»¥ç§»é™¤æˆ–æ³¨é‡Šæ‰è°ƒè¯•æ—¥å¿—
2. **ç»Ÿä¸€ç±»å‹å®šä¹‰**ï¼šå»ºè®®æ‰€æœ‰ç›¸å…³ç»„ä»¶éƒ½ä½¿ç”¨ç»Ÿä¸€çš„ç±»å‹å®šä¹‰æ–‡ä»¶
3. **é”™è¯¯å¤„ç†**ï¼šè€ƒè™‘æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¦‚æœå­ç³»ç»Ÿæ•°æ®é‡å¾ˆå¤§ï¼Œè€ƒè™‘æ·»åŠ åˆ†é¡µæˆ–è™šæ‹Ÿæ»šåŠ¨

## ç›¸å…³æ–‡æ¡£

- [åŒ–ç›é¡¹ç›®è®¾å¤‡ç³»ç»Ÿç®¡ç†APIæ–‡æ¡£](./åŒ–ç›é¡¹ç›®è®¾å¤‡ç³»ç»Ÿç®¡ç†APIæ–‡æ¡£.md)
- [é¡¹ç›®è®¾å¤‡ç³»ç»Ÿå…³è”ç»„ä»¶ä½¿ç”¨è¯´æ˜](./é¡¹ç›®è®¾å¤‡ç³»ç»Ÿå…³è”ç»„ä»¶ä½¿ç”¨è¯´æ˜.md)

