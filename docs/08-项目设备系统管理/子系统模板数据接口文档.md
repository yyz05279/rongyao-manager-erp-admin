# 子系统模板数据接口文档

## 接口概述

本文档包含两个接口：

1. **子系统模板数据接口**：查询子系统模板基本信息和关联的子项模板列表（2 层数据结构）
2. **物料模板查询接口**：根据子项模板 ID 查询关联的物料模板列表

采用按需加载的设计，提升查询性能，减少不必要的数据传输。

---

## 接口 1: 获取子系统模板数据

### 基本信息

| 项目         | 内容                                                              |
| ------------ | ----------------------------------------------------------------- |
| **接口名称** | 获取子系统模板数据                                                |
| **接口路径** | `/erp/saltprocess/equipmentSystemTemplate/subsystemTemplate/{id}` |
| **请求方法** | GET                                                               |
| **接口权限** | `erp:saltprocess:equipmentSystemTemplate:query`                   |
| **开发时间** | 2025-11-13                                                        |
| **数据层级** | 2 层（子系统 + 子项）                                             |

### 业务场景

-   查看子系统模板的基本配置信息
-   获取子系统下所有子项的列表
-   用于设备系统模板的详情展示
-   支持子系统模板数据的快速加载

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明          | 示例                |
| ------ | ---- | ---- | ------------- | ------------------- |
| id     | Long | 是   | 子系统模板 ID | 1988835019686019073 |

#### 请求示例

```http
GET /erp/saltprocess/equipmentSystemTemplate/subsystemTemplate/1988835019686019073
Authorization: Bearer {token}
```

### 响应数据

#### 响应结构

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "id": "1988835019686019073",
        "systemTemplateId": "1988835019686019072",
        "templateCode": "SUBSYS_20251113_001",
        "subsystemName": "固态处理厂",
        "subsystemType": "SOLID",
        "description": "固态处理厂子系统",
        "itemCount": 2,
        "totalMaterials": 5,
        "estimatedWeight": "1500.00",
        "status": "ACTIVE",
        "sortOrder": 1,
        "remarks": "",
        "createTime": "2025-11-13 10:00:00",
        "updateTime": "2025-11-13 10:00:00",
        "items": [
            {
                "id": "1001",
                "subsystemTemplateId": "1988835019686019073",
                "itemName": "反应釜设备",
                "itemCode": "ITEM_001",
                "specification": "5000L",
                "unit": "台",
                "quantity": "2.00",
                "unitWeight": "500.00",
                "totalWeight": "1000.00",
                "materialCount": 3,
                "category": "主设备",
                "sortOrder": 1,
                "remarks": "主要反应设备",
                "createTime": "2025-11-13 10:00:00"
            },
            {
                "id": "1002",
                "subsystemTemplateId": "1988835019686019073",
                "itemName": "输送泵",
                "itemCode": "ITEM_002",
                "specification": "100m³/h",
                "unit": "台",
                "quantity": "3.00",
                "unitWeight": "150.00",
                "totalWeight": "450.00",
                "materialCount": 2,
                "category": "辅助设备",
                "sortOrder": 2,
                "remarks": "",
                "createTime": "2025-11-13 10:00:00"
            }
        ]
    }
}
```

**注意**：

-   `items` 数组中的子项对象**不包含** `materials` 字段数据
-   如需查询子项的物料列表，请使用接口 2

#### 响应字段说明

##### 子系统模板字段 (ErpSaltSubsystemTemplateVo)

| 字段名           | 类型       | 说明                |
| ---------------- | ---------- | ------------------- |
| id               | Long       | 子系统模板 ID       |
| systemTemplateId | Long       | 所属设备系统模板 ID |
| templateCode     | String     | 子系统模板编码      |
| subsystemName    | String     | 子系统名称          |
| subsystemType    | String     | 子系统类型          |
| description      | String     | 描述                |
| itemCount        | Integer    | 子项数量            |
| totalMaterials   | Integer    | 物料总数            |
| estimatedWeight  | BigDecimal | 预估重量(kg)        |
| status           | String     | 状态                |
| sortOrder        | Integer    | 排序号              |
| remarks          | String     | 备注                |
| createTime       | Date       | 创建时间            |
| updateTime       | Date       | 更新时间            |
| items            | List       | 子项模板列表        |

##### 子项模板字段 (ErpSaltItemTemplateVo)

| 字段名              | 类型       | 说明              |
| ------------------- | ---------- | ----------------- |
| id                  | Long       | 子项模板 ID       |
| subsystemTemplateId | Long       | 所属子系统模板 ID |
| itemName            | String     | 子项名称          |
| itemCode            | String     | 子项编码          |
| specification       | String     | 规格型号          |
| unit                | String     | 单位              |
| quantity            | BigDecimal | 数量              |
| unitWeight          | BigDecimal | 单位重量(kg)      |
| totalWeight         | BigDecimal | 总重量(kg)        |
| materialCount       | Integer    | 物料数量          |
| category            | String     | 分类              |
| sortOrder           | Integer    | 排序号            |
| remarks             | String     | 备注              |
| createTime          | Date       | 创建时间          |

---

## 接口 2: 获取子项物料模板列表

### 基本信息

| 项目         | 内容                                                      |
| ------------ | --------------------------------------------------------- |
| **接口名称** | 获取子项物料模板列表                                      |
| **接口路径** | `/erp/saltprocess/equipmentSystemTemplate/materials/{id}` |
| **请求方法** | GET                                                       |
| **接口权限** | `erp:saltprocess:equipmentSystemTemplate:query`           |
| **开发时间** | 2025-11-13                                                |
| **数据层级** | 1 层（物料列表）                                          |

### 业务场景

-   按需加载子项的物料模板数据
-   查看子项的详细物料配置
-   支持物料数据的独立查询和展示
-   减少初始加载的数据量，提升性能

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明        | 示例 |
| ------ | ---- | ---- | ----------- | ---- |
| id     | Long | 是   | 子项模板 ID | 1001 |

#### 请求示例

```http
GET /erp/saltprocess/equipmentSystemTemplate/materials/1001
Authorization: Bearer {token}
```

### 响应数据

#### 响应结构

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "id": "2001",
            "itemTemplateId": "1001",
            "materialName": "不锈钢板",
            "materialCode": "MAT_SS304_001",
            "specification": "304不锈钢 10mm",
            "unit": "kg",
            "quantity": "200.00",
            "unitWeight": "1.00",
            "totalWeight": "200.00",
            "category": "钢材",
            "sortOrder": 1,
            "remarks": "主体材料",
            "createTime": "2025-11-13 10:00:00"
        },
        {
            "id": "2002",
            "itemTemplateId": "1001",
            "materialName": "保温材料",
            "materialCode": "MAT_INS_001",
            "specification": "岩棉 50mm",
            "unit": "m²",
            "quantity": "50.00",
            "unitWeight": "5.00",
            "totalWeight": "250.00",
            "category": "保温材料",
            "sortOrder": 2,
            "remarks": "",
            "createTime": "2025-11-13 10:00:00"
        },
        {
            "id": "2003",
            "itemTemplateId": "1001",
            "materialName": "法兰",
            "materialCode": "MAT_FLANGE_001",
            "specification": "DN100 PN16",
            "unit": "个",
            "quantity": "8.00",
            "unitWeight": "5.00",
            "totalWeight": "40.00",
            "category": "管件",
            "sortOrder": 3,
            "remarks": "",
            "createTime": "2025-11-13 10:00:00"
        }
    ]
}
```

#### 响应字段说明

##### 物料模板字段 (ErpSaltMaterialTemplateVo)

| 字段名         | 类型       | 说明            |
| -------------- | ---------- | --------------- |
| id             | Long       | 物料模板 ID     |
| itemTemplateId | Long       | 所属子项模板 ID |
| materialName   | String     | 物料名称        |
| materialCode   | String     | 物料编码        |
| specification  | String     | 规格型号        |
| unit           | String     | 单位            |
| quantity       | BigDecimal | 数量            |
| unitWeight     | BigDecimal | 单位重量(kg)    |
| totalWeight    | BigDecimal | 总重量(kg)      |
| category       | String     | 分类            |
| sortOrder      | Integer    | 排序号          |
| remarks        | String     | 备注            |
| createTime     | Date       | 创建时间        |

---

## 使用示例

### 场景 1: 加载子系统模板详情页

```javascript
// 1. 首先加载子系统和子项数据
const response1 = await fetch(
    "/erp/saltprocess/equipmentSystemTemplate/subsystemTemplate/1988835019686019073"
);
const subsystemData = await response1.json();

console.log("子系统名称:", subsystemData.data.subsystemName);
console.log("子项数量:", subsystemData.data.items.length);

// 2. 用户点击某个子项时，再加载该子项的物料数据
const itemId = subsystemData.data.items[0].id;
const response2 = await fetch(
    `/erp/saltprocess/equipmentSystemTemplate/materials/${itemId}`
);
const materialsData = await response2.json();

console.log("物料数量:", materialsData.data.length);
```

### 场景 2: 批量加载所有子项的物料数据

```javascript
// 1. 加载子系统数据
const response = await fetch(
    "/erp/saltprocess/equipmentSystemTemplate/subsystemTemplate/1988835019686019073"
);
const subsystemData = await response.json();

// 2. 并发加载所有子项的物料数据
const materialPromises = subsystemData.data.items.map((item) =>
    fetch(`/erp/saltprocess/equipmentSystemTemplate/materials/${item.id}`).then(
        (res) => res.json()
    )
);

const materialsResults = await Promise.all(materialPromises);

// 3. 组装完整数据
subsystemData.data.items.forEach((item, index) => {
    item.materials = materialsResults[index].data;
});

console.log("完整数据:", subsystemData);
```

---

## 性能优化说明

### 优化策略

1. **按需加载**：子项的物料数据只在需要时才加载，避免一次性加载大量数据
2. **减少传输**：初始加载只返回 2 层数据（子系统+子项），减少网络传输量
3. **并发查询**：支持并发查询多个子项的物料数据，提升加载速度
4. **缓存友好**：物料数据独立接口，便于前端实现缓存策略

### 性能对比

| 场景             | 原方案（4 层嵌套）     | 新方案（按需加载）          | 优化效果           |
| ---------------- | ---------------------- | --------------------------- | ------------------ |
| 初始加载         | 1 次查询，返回全部数据 | 1 次查询，只返回子系统+子项 | 数据量减少 60-80%  |
| 查看单个子项物料 | 已加载                 | 1 次额外查询                | 按需加载，节省带宽 |
| 查看所有子项物料 | 已加载                 | N 次并发查询                | 可控的并发加载     |

---

## 错误码说明

| 错误码 | 说明                      | 处理建议         |
| ------ | ------------------------- | ---------------- |
| 200    | 操作成功                  | -                |
| 404    | 子系统模板/子项模板不存在 | 检查 ID 是否正确 |
| 403    | 无权限访问                | 检查用户权限配置 |
| 500    | 服务器内部错误            | 联系技术支持     |

---

## 更新日志

| 版本 | 日期       | 说明                                   |
| ---- | ---------- | -------------------------------------- |
| v1.0 | 2025-11-13 | 初始版本，拆分为两个接口，支持按需加载 |
