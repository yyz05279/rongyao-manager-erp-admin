# 批量从基础物料库复制物料接口文档

## 接口概述

该接口用于从基础物料库批量复制物料到子项模板，支持一次性添加多个物料，并自动过滤已存在的物料，避免重复添加。

---

## 接口信息

### 基本信息

- **接口名称**: 批量从基础物料库复制物料
- **接口路径**: `/erp/saltprocess/equipmentSystemTemplate/item/{itemTemplateId}/materials/from-base`
- **请求方式**: `POST`
- **权限要求**: `erp:saltprocess:equipmentSystemTemplate:add`

---

## 请求参数

### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| itemTemplateId | Long | 是 | 子项模板ID |

### 请求体参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| materialIds | List<Long> | 是 | 基础物料ID列表 | [1001, 1002, 1003] |

---

## 请求示例

### cURL

```bash
curl -X POST "http://localhost:8080/erp/saltprocess/equipmentSystemTemplate/item/1991059115094241282/materials/from-base" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '[1985570844675289089, 1985570844675289090, 1985570844675289091]'
```

### JavaScript (Axios)

```javascript
axios.post(
  '/erp/saltprocess/equipmentSystemTemplate/item/1991059115094241282/materials/from-base',
  [1985570844675289089, 1985570844675289090, 1985570844675289091],
  {
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer YOUR_TOKEN'
    }
  }
)
.then(response => {
  console.log('批量添加成功:', response.data);
})
.catch(error => {
  console.error('批量添加失败:', error);
});
```

### Java (RestTemplate)

```java
RestTemplate restTemplate = new RestTemplate();
String url = "http://localhost:8080/erp/saltprocess/equipmentSystemTemplate/item/1991059115094241282/materials/from-base";

List<Long> materialIds = Arrays.asList(
    1985570844675289089L,
    1985570844675289090L,
    1985570844675289091L
);

HttpHeaders headers = new HttpHeaders();
headers.setContentType(MediaType.APPLICATION_JSON);
headers.set("Authorization", "Bearer YOUR_TOKEN");

HttpEntity<List<Long>> request = new HttpEntity<>(materialIds, headers);
ResponseEntity<R> response = restTemplate.postForEntity(url, request, R.class);
```

---

## 响应结果

### 成功响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

### 失败响应

#### 部分物料不存在

```json
{
  "code": 500,
  "msg": "部分基础物料不存在",
  "data": null
}
```

#### 物料列表为空

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

---

## 业务逻辑说明

### 处理流程

1. **参数校验**: 检查物料ID列表是否为空
2. **批量查询**: 从基础物料库批量查询物料信息
3. **重复检查**: 查询子项模板下已存在的物料编码
4. **过滤重复**: 自动过滤已存在的物料，避免重复添加
5. **批量插入**: 将新物料批量插入到子项模板

### 重复物料处理

- 系统会自动检查子项模板中已存在的物料编码
- 如果提交的物料编码已存在，会跳过该物料并记录日志
- 只有新物料会被添加到子项模板中

### 事务管理

- 所有数据库操作在同一事务中执行
- 如果任何步骤失败，所有操作将回滚
- 确保数据一致性

---

## 注意事项

1. **批量操作**: 建议每次提交的物料数量不超过 100 个
2. **重复提交**: 接口已添加 `@RepeatSubmit` 注解，防止重复提交
3. **权限控制**: 需要 `erp:saltprocess:equipmentSystemTemplate:add` 权限
4. **日志记录**: 操作会记录到系统日志中，便于追踪

---

## 错误码说明

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 200 | 操作成功 | - |
| 500 | 部分基础物料不存在 | 检查物料ID是否正确 |
| 403 | 权限不足 | 联系管理员分配权限 |
| 400 | 参数错误 | 检查请求参数格式 |

---

## 更新日志

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-11-19 | 初始版本，支持批量添加物料 |

