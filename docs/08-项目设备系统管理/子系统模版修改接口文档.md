# 子系统模版修改接口文档

## 接口信息

### 基本信息

-   **接口名称**: 修改设备系统模版关联的子系统模版基本信息
-   **接口路径**: `PUT /erp/saltprocess/equipmentSystemTemplate/subsystem`
-   **权限标识**: `erp:saltprocess:equipmentSystemTemplate:edit`
-   **开发时间**: 2025-01-14

### 功能说明

-   ✅ 只修改子系统模版的基本信息字段（名称、类别、描述、排序号、是否必需、备注等）
-   ❌ 不包含子项数据的增删改（子项模版表 `erp_salt_item_template`）
-   ❌ 不包含物料数据的增删改（物料模版表 `erp_salt_material_template`）
-   ✅ 遵循快照隔离机制，只影响当前子系统模版数据
-   ✅ 不影响公司子系统库（`erp_subsystem_template`）中的原始模版数据

## 请求参数

### 请求头

```
Content-Type: application/json
Authorization: Bearer {token}
```

### 请求体（JSON）

```json
{
    "id": 1, // 必填：子系统模版ID
    "subsystemName": "平面输送机", // 可选：子系统名称
    "category": "输送设备", // 可选：子系统类别
    "subsystemType": "机械类", // 可选：子系统类型（手动输入，如：机械类、电控类、管路类等）
    "description": "用于物料输送", // 可选：描述
    "sequenceNumber": 1, // 可选：排序号
    "status": "ACTIVE", // 可选：状态（DRAFT-草稿，ACTIVE-启用，INACTIVE-停用，ARCHIVED-归档）
    "remarks": "备注信息" // 可选：备注
}
```

### 字段说明

| 字段名         | 类型    | 必填 | 说明                   | 示例           |
| -------------- | ------- | ---- | ---------------------- | -------------- |
| id             | Long    | 是   | 子系统模版 ID          | 1              |
| subsystemName  | String  | 否   | 子系统名称             | "平面输送机"   |
| category       | String  | 否   | 子系统类别             | "输送设备"     |
| subsystemType  | String  | 否   | 子系统类型（手动输入） | "机械类"       |
| description    | String  | 否   | 描述                   | "用于物料输送" |
| sequenceNumber | Integer | 否   | 排序号                 | 1              |
| status         | String  | 否   | 状态                   | "ACTIVE"       |
| remarks        | String  | 否   | 备注                   | "备注信息"     |

### 字段验证规则

-   `subsystemName`: 最大长度 100 个字符
-   `category`: 最大长度 50 个字符
-   `subsystemType`: 最大长度 50 个字符，手动输入
-   `description`: 最大长度 500 个字符
-   `sequenceNumber`: 不能小于 0
-   `status`: 最大长度 20 个字符（DRAFT-草稿，ACTIVE-启用，INACTIVE-停用，ARCHIVED-归档）
-   `remarks`: 最大长度 500 个字符

### 字段说明

-   **itemCount** 和 **materialCount** 是统计字段，由系统自动维护，不需要前端传入
-   **estimatedWeight** 是系统自动计算字段，不需要前端传入
-   **templateCode** 由系统自动生成，不需要前端传入

## 响应结果

### 成功响应

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": null
}
```

### 失败响应

```json
{
    "code": 500,
    "msg": "子系统模板不存在",
    "data": null
}
```

## 使用示例

### cURL 示例

```bash
curl -X PUT "http://localhost:8080/erp/saltprocess/equipmentSystemTemplate/subsystem" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "id": 1,
    "subsystemName": "平面输送机（改进版）",
    "category": "输送设备",
    "subsystemType": "机械类",
    "description": "用于物料输送，已优化性能",
    "sequenceNumber": 2,
    "status": "ACTIVE",
    "remarks": "2025年1月更新"
  }'
```

### JavaScript 示例

```javascript
const updateSubsystem = async (data) => {
    const response = await fetch(
        "/erp/saltprocess/equipmentSystemTemplate/subsystem",
        {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(data),
        }
    );
    return await response.json();
};

// 使用示例
updateSubsystem({
    id: 1,
    subsystemName: "平面输送机（改进版）",
    category: "输送设备",
    subsystemType: "机械类",
    description: "用于物料输送，已优化性能",
    sequenceNumber: 2,
    status: "ACTIVE",
    remarks: "2025年1月更新",
});
```

## 注意事项

1. **数据隔离**: 修改操作只影响设备系统模版关联的子系统模版数据，不影响公司子系统库中的原始模版数据
2. **权限要求**: 需要 `erp:saltprocess:equipmentSystemTemplate:edit` 权限
3. **事务保证**: 操作在事务中执行，失败会自动回滚
4. **日志记录**: 系统会记录所有字段的变更情况
5. **防重复提交**: 接口使用了 `@RepeatSubmit` 注解，防止重复提交

## 相关接口

-   查询子系统模版详情: `GET /erp/saltprocess/equipmentSystemTemplate/subsystemTemplate/{id}`
-   查询设备系统模版详情: `GET /erp/saltprocess/equipmentSystemTemplate/{id}`
-   修改设备系统模版: `PUT /erp/saltprocess/equipmentSystemTemplate`

## 技术实现

### 实现层级

-   **Controller 层**: `ErpSaltEquipmentSystemTemplateController.updateSubsystem()`
-   **Service 层**: `ErpSaltSubsystemTemplateServiceImpl.updateByBo()`
-   **Mapper 层**: `ErpSaltSubsystemTemplateMapper.updateById()`（继承自 BaseMapperPlus）

### 关键代码位置

-   Controller: `haitang-modules/haitang-erp/src/main/java/com/haitang/erp/controller/saltprocess/ErpSaltEquipmentSystemTemplateController.java`
-   Service: `haitang-modules/haitang-erp/src/main/java/com/haitang/erp/service/saltprocess/impl/ErpSaltSubsystemTemplateServiceImpl.java`
-   Bo: `haitang-modules/haitang-erp/src/main/java/com/haitang/erp/domain/saltprocess/bo/ErpSaltSubsystemTemplateBo.java`
