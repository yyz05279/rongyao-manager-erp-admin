# 项目设备系统关联组件使用说明

## 组件概述

`ProjectEquipmentSystemForm.vue` 是一个用于将设备系统模板批量关联到项目的弹窗组件。

**文件路径：** `/src/views/erp/saltprocess/equipment-system/components/ProjectEquipmentSystemForm.vue`

## 功能特性

### 1. 项目选择
- 支持从项目列表中选择目标项目
- 支持搜索过滤（filterable）
- 支持清空选择（clearable）
- 显示项目名称和项目编码

### 2. 设备系统模板多选
- 使用表格形式展示可用模板
- 支持多选（checkbox）
- 显示模板编号、名称、系统类型、子系统数、子项数、状态等信息
- 系统类型和状态使用标签（tag）展示，颜色区分
- 表格最大高度 400px，超出可滚动

### 3. 表单验证
- 必须选择一个项目
- 必须至少选择一个设备系统模板
- 验证失败时显示友好提示

### 4. 提交关联
- 调用批量创建接口 `/erp/saltprocess/projectEquipmentSystem/create-from-templates`
- 显示 loading 状态
- 成功后显示提示并通知父组件刷新
- 失败时显示错误信息

## 组件接口

### Props

```typescript
interface Props {
  visible: boolean;  // 控制弹窗显示/隐藏
}
```

### Emits

```typescript
interface Emits {
  'update:visible': [value: boolean];  // 更新弹窗显示状态
  'success': [];                       // 关联成功事件
}
```

## 使用示例

### 在父组件中使用

```vue
<template>
  <div>
    <!-- 触发按钮 -->
    <el-button type="primary" @click="showDialog">
      关联设备系统
    </el-button>

    <!-- 关联弹窗组件 -->
    <ProjectEquipmentSystemForm
      v-model:visible="dialogVisible"
      @success="handleSuccess"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import ProjectEquipmentSystemForm from './components/ProjectEquipmentSystemForm.vue';

const dialogVisible = ref(false);

// 显示弹窗
const showDialog = () => {
  dialogVisible.value = true;
};

// 关联成功处理
const handleSuccess = () => {
  // 刷新列表或其他操作
  console.log('关联成功，刷新数据');
  loadData();
};

const loadData = () => {
  // 重新加载数据的逻辑
};
</script>
```

## API 接口说明

### 1. 项目简化列表接口

**接口路径：** `GET /erp/project/simple`

**响应数据：**
```json
[
  {
    "id": 1,
    "projectName": "海棠化盐项目A",
    "projectCode": "PRJ-2024-001"
  }
]
```

### 2. 启用状态模板列表接口

**接口路径：** `GET /erp/saltprocess/equipmentSystemTemplate/active`

**响应数据：**
```json
[
  {
    "id": 1001,
    "templateCode": "TPL-SOLID-001",
    "templateName": "固态化盐系统标准模板",
    "systemType": "SOLID",
    "subsystemCount": 3,
    "totalItems": 15,
    "status": "ACTIVE"
  }
]
```

### 3. 批量创建接口

**接口路径：** `POST /erp/saltprocess/projectEquipmentSystem/create-from-templates`

**请求参数：**
```json
{
  "projectId": 123456,
  "templateIds": [1001, 1002, 1005]
}
```

**响应数据：**
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    "SYS-6YbK8qvJpT",
    "SYS-3aNw2LmQfX",
    "SYS-Xp9Zr1UdMe"
  ]
}
```

## 样式说明

- 弹窗宽度：900px
- 表格最大高度：400px
- 使用 Element Plus 的 tag 组件展示类型和状态
- 响应式设计，适配不同屏幕尺寸

## 注意事项

1. **接口依赖**：确保后端已实现相关接口
2. **权限控制**：需要 `erp:saltprocess:projectEquipmentSystem:add` 权限
3. **数据验证**：前端和后端都需要进行数据验证
4. **错误处理**：接口调用失败时会显示错误信息
5. **状态管理**：使用 v-model 双向绑定弹窗显示状态

## 后续优化建议

1. 添加模板预览功能
2. 支持按系统类型筛选模板
3. 添加批量操作进度提示
4. 支持模板搜索功能
5. 添加已关联模板的排除逻辑

