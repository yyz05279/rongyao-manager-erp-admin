# é¡¹ç›®å­ç³»ç»Ÿæ·»åŠ æµç¨‹æ—¥å¿—è¿½è¸ª

## ğŸ“Œ æ¦‚è¿°

ä¸ºäº†è¿½è¸ªé¡¹ç›®è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…é¡µé¢ä¸­"æ·»åŠ å­ç³»ç»Ÿ"åŠŸèƒ½çš„æ•°æ®æµè½¬è¿‡ç¨‹ï¼Œåœ¨ç›¸å…³ç»„ä»¶ä¸­æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºã€‚é€šè¿‡è¿™äº›æ—¥å¿—ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ä»ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åˆ°æ¥å£è°ƒç”¨çš„å®Œæ•´è·¯å¾„ã€‚

**ä¿®æ”¹æ—¥æœŸ**: 2025-11-25  
**ä¿®æ”¹äººå‘˜**: æµ·æ£ å¼€å‘å›¢é˜Ÿ

---

## ğŸ” é—®é¢˜èƒŒæ™¯

ç”¨æˆ·åœ¨é¡¹ç›®è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…é¡µé¢ç‚¹å‡»"æ·»åŠ å­ç³»ç»Ÿ"æŒ‰é’®ï¼Œé€‰æ‹©å­ç³»ç»Ÿæ¨¡æ¿åç‚¹å‡»"ç¡®å®š"ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ POST æ¥å£åˆ›å»ºæ–°çš„é¡¹ç›®å­ç³»ç»Ÿã€‚ä¸ºäº†è¿½è¸ªè¿™ä¸ªè¿‡ç¨‹ï¼Œéœ€è¦æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºã€‚

---

## ğŸ“ ä¿®æ”¹å†…å®¹

### 1. ProjectEquipmentSystemDetail.vue

**æ–‡ä»¶è·¯å¾„**: `src/views/erp/saltprocess/equipment-system/components/ProjectEquipmentSystemDetail.vue`

#### ä¿®æ”¹ä½ç½®: `getDetail()` æ–¹æ³•

**ä¿®æ”¹å†…å®¹**:
```typescript
const getDetail = async () => {
  console.log('ğŸ”„ [ProjectEquipmentSystemDetail.getDetail] å¼€å§‹è·å–ç³»ç»Ÿè¯¦æƒ…');
  console.log('ğŸ“‹ ç³»ç»ŸID:', props.systemId);
  
  loading.value = true;
  try {
    const res = await getProjectEquipmentSystem(props.systemId);
    detail.value = res.data;
    
    console.log('âœ… [ProjectEquipmentSystemDetail.getDetail] è·å–è¯¦æƒ…æˆåŠŸ');
    console.log('ğŸ“¦ è¯¦æƒ…æ•°æ®:', res.data);
    console.log('ğŸ“‹ é¡¹ç›®å­ç³»ç»Ÿåˆ—è¡¨:', res.data.projectSubsystems);
    console.log('ğŸ“Š å­ç³»ç»Ÿæ•°é‡:', res.data.projectSubsystems?.length || 0);
    
    // è®°å½•æ¯ä¸ªå­ç³»ç»Ÿçš„å…³é”®ä¿¡æ¯
    if (res.data.projectSubsystems && res.data.projectSubsystems.length > 0) {
      console.log('ğŸ“ [ProjectEquipmentSystemDetail.getDetail] å­ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯:');
      res.data.projectSubsystems.forEach((subsystem, index) => {
        console.log(`  ${index + 1}. ID: ${subsystem.id}, åç§°: ${subsystem.subsystemName}, æ¨¡æ¿ID: ${(subsystem as any).templateId || (subsystem as any).referenceTemplateId || 'N/A'}`);
      });
    }
  } catch (error) {
    console.error('âŒ [ProjectEquipmentSystemDetail.getDetail] è·å–è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…å¤±è´¥:', error);
    ElMessage.error('è·å–è®¾å¤‡ç³»ç»Ÿè¯¦æƒ…å¤±è´¥');
  } finally {
    loading.value = false;
  }
};
```

**æ—¥å¿—è¯´æ˜**:
- è®°å½•è·å–è¯¦æƒ…çš„å¼€å§‹å’Œç»“æŸ
- è¾“å‡ºç³»ç»ŸIDå’Œå®Œæ•´çš„è¯¦æƒ…æ•°æ®
- åˆ—å‡ºæ‰€æœ‰å­ç³»ç»Ÿçš„å…³é”®ä¿¡æ¯ï¼ˆIDã€åç§°ã€æ¨¡æ¿IDï¼‰

---

### 2. ProjectSubsystemManagement.vue

**æ–‡ä»¶è·¯å¾„**: `src/views/erp/saltprocess/equipment-system/components/ProjectSubsystemManagement.vue`

#### ä¿®æ”¹ä½ç½® 1: `handleAddSubsystem()` æ–¹æ³•

**ä¿®æ”¹å†…å®¹**:
```typescript
// æ·»åŠ å­ç³»ç»Ÿ
const handleAddSubsystem = () => {
  console.log('ğŸ¯ [ProjectSubsystemManagement.handleAddSubsystem] ç”¨æˆ·ç‚¹å‡»æ·»åŠ å­ç³»ç»ŸæŒ‰é’®');
  console.log('ğŸ“‹ å½“å‰ç³»ç»ŸID:', props.systemId);
  console.log('ğŸ“‹ å½“å‰é¡¹ç›®ID:', props.projectId);
  console.log('ğŸ“‹ å·²å­˜åœ¨çš„æ¨¡æ¿IDåˆ—è¡¨:', existingTemplateIds.value);
  subsystemSelectorVisible.value = true;
};
```

**æ—¥å¿—è¯´æ˜**:
- è®°å½•ç”¨æˆ·ç‚¹å‡»æ·»åŠ æŒ‰é’®çš„åŠ¨ä½œ
- è¾“å‡ºå½“å‰çš„ç³»ç»ŸIDã€é¡¹ç›®ID
- æ˜¾ç¤ºå·²å­˜åœ¨çš„æ¨¡æ¿IDåˆ—è¡¨ï¼ˆç”¨äºå»é‡ï¼‰

#### ä¿®æ”¹ä½ç½® 2: `handleSubsystemConfirm()` æ–¹æ³•

**ä¿®æ”¹å†…å®¹**:
```typescript
// å¤„ç†å­ç³»ç»Ÿç¡®è®¤
const handleSubsystemConfirm = async (selectedTemplates: SubsystemTemplateVO[]) => {
  console.log('ğŸ‰ [ProjectSubsystemManagement.handleSubsystemConfirm] æ¥æ”¶åˆ°å­ç³»ç»Ÿæ¨¡æ¿é€‰æ‹©ç¡®è®¤');
  console.log('ğŸ“¦ æ¥æ”¶åˆ°çš„æ¨¡æ¿æ•°æ®:', selectedTemplates);
  console.log('ğŸ“Š æ¨¡æ¿æ•°é‡:', selectedTemplates.length);
  console.log('ğŸ“‹ æ¨¡æ¿è¯¦ç»†ä¿¡æ¯:', JSON.stringify(selectedTemplates, null, 2));
  
  try {
    console.log('ğŸ”„ [ProjectSubsystemManagement.handleSubsystemConfirm] å¼€å§‹æ‰¹é‡åˆ›å»ºé¡¹ç›®å­ç³»ç»Ÿ');
    
    // æ‰¹é‡åˆ›å»ºé¡¹ç›®å­ç³»ç»Ÿ
    for (let i = 0; i < selectedTemplates.length; i++) {
      const template = selectedTemplates[i];
      console.log(`\nğŸ“ [ProjectSubsystemManagement.handleSubsystemConfirm] å¤„ç†ç¬¬ ${i + 1}/${selectedTemplates.length} ä¸ªæ¨¡æ¿`);
      console.log('ğŸ“‹ æ¨¡æ¿ID:', template.id);
      console.log('ğŸ“‹ æ¨¡æ¿ç¼–ç :', template.templateCode);
      console.log('ğŸ“‹ æ¨¡æ¿åç§°:', template.templateName);
      
      const subsystemData: ProjectSubsystemAddForm = {
        // ... æ„é€ æ•°æ®
      };

      console.log('ğŸ“¤ [ProjectSubsystemManagement.handleSubsystemConfirm] å‡†å¤‡è°ƒç”¨ addProjectSubsystem æ¥å£');
      console.log('ğŸ“‹ æ¥å£å‚æ•°:', subsystemData);
      console.log('[object Object] POST (æ–°å¢å­ç³»ç»Ÿ)');
      console.log('ğŸ” è°ƒç”¨æ ˆ: ProjectSubsystemManagement.handleSubsystemConfirm -> addProjectSubsystem');
      
      const response = await addProjectSubsystem(subsystemData);
      
      console.log('âœ… [ProjectSubsystemManagement.handleSubsystemConfirm] æ¥å£è°ƒç”¨æˆåŠŸ');
      console.log('ğŸ“‹ å“åº”æ•°æ®:', response);
    }

    console.log('ğŸ‰ [ProjectSubsystemManagement.handleSubsystemConfirm] æ‰€æœ‰å­ç³»ç»Ÿåˆ›å»ºå®Œæˆ');
    ElMessage.success(`æˆåŠŸæ·»åŠ  ${selectedTemplates.length} ä¸ªå­ç³»ç»Ÿ`);
    
    console.log('ğŸ”„ [ProjectSubsystemManagement.handleSubsystemConfirm] è§¦å‘åˆ·æ–°äº‹ä»¶');
    emit('refresh');
  } catch (error: any) {
    console.error('âŒ [ProjectSubsystemManagement.handleSubsystemConfirm] æ·»åŠ å­ç³»ç»Ÿå¤±è´¥:', error);
    console.error('âŒ é”™è¯¯è¯¦æƒ…:', JSON.stringify(error, null, 2));
    ElMessage.error('æ·»åŠ å­ç³»ç»Ÿå¤±è´¥');
  }
};
```

**æ—¥å¿—è¯´æ˜**:
- è®°å½•æ¥æ”¶åˆ°çš„æ¨¡æ¿æ•°æ®ï¼ˆæ•°é‡ã€è¯¦ç»†ä¿¡æ¯ï¼‰
- è¿½è¸ªæ¯ä¸ªæ¨¡æ¿çš„å¤„ç†è¿‡ç¨‹
- åœ¨æ¥å£è°ƒç”¨å‰è¾“å‡ºå®Œæ•´çš„è¯·æ±‚å‚æ•°
- æ˜ç¡®æ ‡æ³¨æ¥å£æ–¹æ³•ï¼ˆPOSTï¼‰å’Œè°ƒç”¨æ ˆ
- è®°å½•æ¥å£è°ƒç”¨æˆåŠŸåçš„å“åº”æ•°æ®
- è®°å½•é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰

---

## ğŸ¯ æ—¥å¿—è¾“å‡ºç¤ºä¾‹

å½“ç”¨æˆ·æ‰§è¡Œ"æ·»åŠ å­ç³»ç»Ÿ"æ“ä½œæ—¶ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼š


