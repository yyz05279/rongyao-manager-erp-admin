# 物料模板管理页批量修改接口更新文档

##[object Object]更新概述

将物料模板管理页（`material-template/index.vue`）的修改接口从单个修改接口更新为批量修改接口，以保持与系统其他模块的一致性。

**更新日期**: 2025-11-20  
**更新模块**: 子系统管理 - 物料模板管理  
**影响范围**: API 接口层、页面视图层

---

## 🔄 更新内容

### 1. API 接口层更新

**文件**: `src/api/erp/subsystem/material-template.ts`

#### 新增批量修改接口

```typescript
/**
 * 批量修改物料模板
 * 说明：批量修改多个物料模板的配置（如默认数量等）
 * @param data 物料表单数据数组（每个必须包含id）
 */
export const updateMaterialTemplateBatch = (data: SubsystemMaterialTemplateForm[]): AxiosPromise<void> => {
  return request({
    url: '/erp/subsystem/material-template/batch',
    method: 'put',
    data
  });
};
```

**接口特点**:
- 接受物料表单数据数组作为参数
- 每个物料数据必须包含 `id` 字段用于定位
- 支持一次修改多个物料模板
- 请求路径: `PUT /erp/subsystem/material-template/batch`

---

### 2. 页面视图层更新

**文件**: `src/views/erp/subsystem/material-template/index.vue`

#### 2.1 导入更新

**修改前**:
```typescript
import {
  listMaterialTemplate,
  getMaterialTemplate,
  addMaterialTemplate,
  updateMaterialTemplate,  // ❌ 单个修改接口
  delMaterialTemplate
} from '@/api/erp/subsystem/material-template';
```

**修改后**:
```typescript
import {
  listMaterialTemplate,
  getMaterialTemplate,
  addMaterialTemplate,
  updateMaterialTemplateBatch,  // ✅ 批量修改接口
  delMaterialTemplate
} from '@/api/erp/subsystem/material-template';
```

#### 2.2 提交表单逻辑更新

**修改前**:
```typescript
const submitForm = async () => {
  try {
    await formRef.value?.validate();

    dialog.loading = true;
    if (form.id) {
      await updateMaterialTemplate(form);  // ❌ 单个修改
      ElMessage.success('修改成功');
    } else {
      await addMaterialTemplate(form);
      ElMessage.success('新增成功');
    }

    dialog.visible = false;
    getList();
  } catch (error) {
    if (error !== false) {
      console.error('保存物料失败:', error);
      ElMessage.error('保存失败');
    }
  } finally {
    dialog.loading = false;
  }
};
```

**修改后**:
```typescript
const submitForm = async () => {
  try {
    await formRef.value?.validate();

    dialog.loading = true;
    if (form.id) {
      // 使用批量修改接口
      await updateMaterialTemplateBatch([form]);  // ✅ 批量修改（传入数组）
      ElMessage.success('修改成功');
    } else {
      await addMaterialTemplate(form);
      ElMessage.success('新增成功');
    }

    dialog.visible = false;
    getList();
  } catch (error) {
    if (error !== false) {
      console.error('保存物料失败:', error);
      ElMessage.error('保存失败');
    }
  } finally {
    dialog.loading = false;
  }
};
```

**关键变化**:
- 将 `updateMaterialTemplate(form)` 改为 `updateMaterialTemplateBatch([form])`
- 单个表单数据包装成数组传递给批量接口
- 保持原有的用户体验和功能逻辑不变

---

## ✅ 更新优势

1. **接口统一**: 与系统其他模块（如子项模板、设备系统模板）保持一致
2. **扩展性强**: 为未来支持真正的批量修改功能预留接口
3. **代码规范**: 符合项目编码规范和最佳实践
4. **向后兼容**: 保持原有单个修改功能的用户体验

---

## 📝 测试建议

### 功能测试
1. ✅ 测试单个物料模板的修改功能
2. ✅ 验证修改后数据正确保存
3. ✅ 检查成功/失败提示消息
4. ✅ 确认列表数据刷新正常

### 接口测试
1. ✅ 验证批量接口接受单个元素数组
2. ✅ 测试批量接口的错误处理
3. ✅ 确认请求参数格式正确

---

## 🔗 相关文档

- [子项模板物料管理API更新文档](./子项模板物料管理API更新文档.md)
- [项目开发编码规范](../../项目开发编码规范.md)

---

## 📌 注意事项

1. 保留了原有的 `updateMaterialTemplate` 单个修改接口，以便其他模块可能的使用
2. 批量接口要求每个物料数据必须包含 `id` 字段
3. 前端将单个表单数据包装成数组 `[form]` 传递给批量接口
4. 后端需要实现对应的批量修改接口 `PUT /erp/subsystem/material-template/batch`

