# å­ç³»ç»Ÿç‰©æ–™æŸ¥è¯¢æ¥å£ä¿®å¤æ€»ç»“

## ğŸ“‹ ä¿®å¤æ¦‚è¿°

**ä¿®å¤æ—¥æœŸ**ï¼š2025-11-07  
**ä¿®å¤äººå‘˜**ï¼šAI åŠ©æ‰‹  
**é—®é¢˜ä¸¥é‡çº§åˆ«**ï¼šä¸­ç­‰

## ğŸ› é—®é¢˜æè¿°

åœ¨å­é¡¹æ¨¡æ¿ç®¡ç†ç‹¬ç«‹é¡µé¢ï¼ˆ`src/views/erp/subsystem/item-template/index.vue`ï¼‰ä¸­ï¼Œç‰©æ–™æŸ¥è¯¢æ¥å£è°ƒç”¨ä¸æ­£ç¡®ï¼Œå¯¼è‡´æ•°æ®éš”ç¦»å¤±è´¥ã€‚

### é—®é¢˜ç°è±¡

1. **é”™è¯¯çš„æ¥å£è°ƒç”¨**
   - è°ƒç”¨äº† `listMaterialTemplateByItemId(materialDialog.itemId)`
   - ç¼ºå°‘ `templateId` å‚æ•°
   - å¯èƒ½æŸ¥è¯¢åˆ°é”™è¯¯çš„æ•°æ®æˆ–è¿”å›ç©ºç»“æœ

2. **å‡½æ•°å‘½åä¸æ¸…æ™°**
   - `getItemMaterials` å’Œ `listMaterialTemplateByItemId` ä¸èƒ½æ˜ç¡®è¡¨è¾¾å…¶ç”¨é€”
   - å®¹æ˜“æ··æ·†æ¨¡æ¿ç‰©æ–™å’Œå­ç³»ç»Ÿç‰©æ–™çš„æŸ¥è¯¢

## âœ… ä¿®å¤å†…å®¹

### 1. ä¿®å¤å­é¡¹æ¨¡æ¿ç®¡ç†ç‹¬ç«‹é¡µé¢çš„æ¥å£è°ƒç”¨

**æ–‡ä»¶**ï¼š`src/views/erp/subsystem/item-template/index.vue`

**ä¿®æ”¹å‰**ï¼š
```typescript
// ç¬¬ 437 è¡Œ
const response = await listMaterialTemplateByItemId(materialDialog.itemId);
```

**ä¿®æ”¹å**ï¼š
```typescript
// ç¬¬ 440 è¡Œ
// âœ… ä¿®å¤ï¼šå­é¡¹æ¨¡æ¿ç®¡ç†é¡µé¢åº”è¯¥è°ƒç”¨ä¸“é—¨çš„æ¨¡æ¿ç‰©æ–™æ¥å£
// è¯¥æ¥å£æŸ¥è¯¢ template_id = NULL çš„æ¨¡æ¿ç‰©æ–™ï¼Œä¸æ˜¯å­ç³»ç»Ÿç‰©æ–™
const response = await getItemMaterials(materialDialog.itemId);
```

**åŒæ—¶**ï¼š
- âœ… æ·»åŠ äº† `getItemMaterials` çš„å¯¼å…¥
- âœ… ç§»é™¤äº†ä¸å†ä½¿ç”¨çš„ `listMaterialTemplateByItemId` å¯¼å…¥

### 2. ä¼˜åŒ– API å‡½æ•°å‘½å

**æ–‡ä»¶**ï¼š`src/api/erp/subsystem/item-template.ts`

**ä¼˜åŒ–å†…å®¹**ï¼š
```typescript
/**
 * æŸ¥è¯¢å­é¡¹æ¨¡æ¿çš„é»˜è®¤ç‰©æ–™åˆ—è¡¨ï¼ˆæ¨¡æ¿çº§åˆ«ï¼‰
 * 
 * è¯´æ˜ï¼šè¯¥æ¥å£æŸ¥è¯¢å­é¡¹æ¨¡æ¿çš„é»˜è®¤ç‰©æ–™é…ç½®ï¼Œå³ template_id = NULL çš„æ¨¡æ¿ç‰©æ–™
 * ç”¨é€”ï¼šåœ¨"å­é¡¹æ¨¡æ¿ç®¡ç†"é¡µé¢ä¸­ä½¿ç”¨ï¼Œä¸æ¶‰åŠå…·ä½“å­ç³»ç»Ÿ
 * æ•°æ®ç‰¹å¾ï¼šè¿”å›çš„ç‰©æ–™è®°å½•çš„ templateId å­—æ®µä¸º null
 * 
 * @param itemTemplateId å­é¡¹æ¨¡æ¿ID
 * @returns æ¨¡æ¿ç‰©æ–™åˆ—è¡¨
 */
export const getItemTemplateMaterials = (itemTemplateId: string | number): AxiosPromise<any[]> => {
  return request({
    url: `/erp/subsystem/item-template/${itemTemplateId}/materials`,
    method: 'get'
  });
};

/**
 * @deprecated è¯·ä½¿ç”¨ getItemTemplateMaterials ä»£æ›¿ï¼Œå‡½æ•°åæ›´æ¸…æ™°
 */
export const getItemMaterials = getItemTemplateMaterials;
```

**æ–‡ä»¶**ï¼š`src/api/erp/subsystem/material-template.ts`

**ä¼˜åŒ–å†…å®¹**ï¼š
```typescript
/**
 * æŸ¥è¯¢å­é¡¹åœ¨å­ç³»ç»Ÿä¸­çš„ç‰©æ–™åˆ—è¡¨ï¼ˆå­ç³»ç»Ÿçº§åˆ«ï¼‰
 * 
 * è¯´æ˜ï¼šè¯¥æ¥å£æŸ¥è¯¢ç‰¹å®šå­ç³»ç»Ÿä¸­æŸä¸ªå­é¡¹çš„ç‰©æ–™é…ç½®ï¼Œå³ template_id = å­ç³»ç»ŸID çš„ç‰©æ–™
 * ç”¨é€”ï¼šåœ¨"å­ç³»ç»Ÿè¯¦æƒ…"é¡µé¢ä¸­ä½¿ç”¨ï¼ŒæŸ¥è¯¢è¯¥å­ç³»ç»Ÿä¸­çš„ç‰©æ–™é…ç½®
 * æ•°æ®ç‰¹å¾ï¼šè¿”å›çš„ç‰©æ–™è®°å½•çš„ templateId å­—æ®µæœ‰å…·ä½“å€¼ï¼ˆå­ç³»ç»ŸIDï¼‰
 * 
 * âš ï¸ é‡è¦ï¼šåœ¨å­ç³»ç»Ÿè¯¦æƒ…é¡µé¢ä¸­ï¼Œå¿…é¡»ä¼ é€’ templateId å‚æ•°å®ç°æ•°æ®éš”ç¦»
 * 
 * @param itemTemplateId å­é¡¹æ¨¡æ¿IDï¼ˆå¿…å¡«ï¼‰
 * @param templateId å­ç³»ç»Ÿæ¨¡æ¿IDï¼ˆå¿…å¡«ï¼Œç”¨äºæ•°æ®éš”ç¦»ï¼‰
 * @returns å­ç³»ç»Ÿç‰©æ–™åˆ—è¡¨
 */
export const getItemMaterialsInSubsystem = (
  itemTemplateId: string | number,
  templateId: string | number
): AxiosPromise<SubsystemMaterialTemplateVO[]> => {
  // å®ç°ä»£ç ...
};

/**
 * @deprecated è¯·ä½¿ç”¨ getItemMaterialsInSubsystem ä»£æ›¿ï¼Œå‡½æ•°åæ›´æ¸…æ™°
 */
export const listMaterialTemplateByItemId = getItemMaterialsInSubsystem;
```

### 3. æ›´æ–°æ–‡æ¡£

**æ–‡ä»¶**ï¼š`docs/07-å­ç³»ç»Ÿç®¡ç†/å­ç³»ç»Ÿç‰©æ–™æŸ¥è¯¢APIå¯¹æ¥æ–‡æ¡£.md`

**æ›´æ–°å†…å®¹**ï¼š
- âœ… æ·»åŠ äº†ç‰ˆæœ¬æ›´æ–°è®°å½•
- âœ… æ›´æ–°äº†æ‰€æœ‰ä»£ç ç¤ºä¾‹ï¼Œä½¿ç”¨æ–°çš„å‡½æ•°å
- âœ… æ·»åŠ äº† TypeScript ç±»å‹æ ‡æ³¨
- âœ… æ›´æ–°äº† API å¯¹æ¯”æ€»ç»“è¡¨æ ¼
- âœ… æ·»åŠ äº†ç›¸å…³æ–‡æ¡£é“¾æ¥

## ğŸ“Š å½±å“èŒƒå›´

### ä¿®æ”¹çš„æ–‡ä»¶
1. `src/views/erp/subsystem/item-template/index.vue` - ä¿®å¤æ¥å£è°ƒç”¨
2. `src/api/erp/subsystem/item-template.ts` - ä¼˜åŒ–å‡½æ•°å‘½åå’Œæ³¨é‡Š
3. `src/api/erp/subsystem/material-template.ts` - ä¼˜åŒ–å‡½æ•°å‘½åå’Œæ³¨é‡Š
4. `docs/07-å­ç³»ç»Ÿç®¡ç†/å­ç³»ç»Ÿç‰©æ–™æŸ¥è¯¢APIå¯¹æ¥æ–‡æ¡£.md` - æ›´æ–°æ–‡æ¡£

### æœªä¿®æ”¹çš„æ–‡ä»¶
- `src/views/erp/subsystem/template/components/ItemTemplateManagement.vue` - å·²éªŒè¯æ¥å£è°ƒç”¨æ­£ç¡®ï¼Œæ— éœ€ä¿®æ”¹

## ğŸ”„ å‘åå…¼å®¹æ€§

âœ… **å®Œå…¨å‘åå…¼å®¹**

æ‰€æœ‰æ—§å‡½æ•°åéƒ½ä¿ç•™ä¸ºæ–°å‡½æ•°çš„åˆ«åï¼Œå¹¶æ ‡è®°ä¸º `@deprecated`ï¼š
- `getItemMaterials` â†’ ä»ç„¶å¯ç”¨ï¼ŒæŒ‡å‘ `getItemTemplateMaterials`
- `listMaterialTemplateByItemId` â†’ ä»ç„¶å¯ç”¨ï¼ŒæŒ‡å‘ `getItemMaterialsInSubsystem`

ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯ç»§ç»­è¿è¡Œï¼Œå»ºè®®é€æ­¥è¿ç§»åˆ°æ–°å‡½æ•°åã€‚

## ğŸ“ æ•°æ®éš”ç¦»åŸåˆ™

### æ¨¡æ¿ç‰©æ–™ vs å­ç³»ç»Ÿç‰©æ–™

| ç±»å‹         | template_id | æŸ¥è¯¢æ¥å£                     | ä½¿ç”¨åœºæ™¯         |
| ------------ | ----------- | ---------------------------- | ---------------- |
| **æ¨¡æ¿ç‰©æ–™** | `NULL`      | `getItemTemplateMaterials`   | å­é¡¹æ¨¡æ¿ç®¡ç†é¡µé¢ |
| **å­ç³»ç»Ÿç‰©æ–™** | `<å­ç³»ç»ŸID>` | `getItemMaterialsInSubsystem` | å­ç³»ç»Ÿè¯¦æƒ…é¡µé¢   |

### æ­£ç¡®çš„è°ƒç”¨æ–¹å¼

**å­é¡¹æ¨¡æ¿ç®¡ç†é¡µé¢**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šæŸ¥è¯¢æ¨¡æ¿ç‰©æ–™ï¼ˆtemplate_id = NULLï¼‰
const { data } = await getItemTemplateMaterials(itemTemplateId);
```

**å­ç³»ç»Ÿè¯¦æƒ…é¡µé¢**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šæŸ¥è¯¢å­ç³»ç»Ÿç‰©æ–™ï¼ˆtemplate_id = å­ç³»ç»ŸIDï¼‰
const { data } = await getItemMaterialsInSubsystem(itemTemplateId, subsystemId);
```

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯ 1ï¼šå­é¡¹æ¨¡æ¿ç®¡ç†é¡µé¢**
1. æ‰“å¼€å­é¡¹æ¨¡æ¿ç®¡ç†é¡µé¢
2. ä¸ºæŸä¸ªå­é¡¹æ·»åŠ ç‰©æ–™ï¼ˆå¦‚ï¼šæ§½å¼æ¡¥æ¶ï¼Œæ•°é‡ 10ï¼‰
3. æŸ¥çœ‹è¯¥å­é¡¹çš„ç‰©æ–™åˆ—è¡¨
4. **é¢„æœŸ**ï¼šæ˜¾ç¤ºæ¨¡æ¿ç‰©æ–™ï¼Œæ•°é‡ä¸º 10

**æµ‹è¯•åœºæ™¯ 2ï¼šå­ç³»ç»Ÿè¯¦æƒ…é¡µé¢**
1. æ‰“å¼€æŸä¸ªå­ç³»ç»Ÿçš„è¯¦æƒ…é¡µé¢
2. æ·»åŠ åŒ…å«è¯¥å­é¡¹çš„é…ç½®
3. ä¿®æ”¹è¯¥å­é¡¹çš„ç‰©æ–™æ•°é‡ä¸º 20
4. **é¢„æœŸ**ï¼šåªå½±å“è¯¥å­ç³»ç»Ÿçš„ç‰©æ–™ï¼Œä¸å½±å“æ¨¡æ¿ç‰©æ–™

**æµ‹è¯•åœºæ™¯ 3ï¼šæ•°æ®éš”ç¦»éªŒè¯**
1. å®Œæˆåœºæ™¯ 1 å’Œåœºæ™¯ 2 çš„æ“ä½œ
2. è¿”å›å­é¡¹æ¨¡æ¿ç®¡ç†é¡µé¢æŸ¥çœ‹
3. **é¢„æœŸ**ï¼šæ¨¡æ¿ç‰©æ–™æ•°é‡ä»ä¸º 10ï¼ˆæœªè¢«ä¿®æ”¹ï¼‰
4. è¿”å›å­ç³»ç»Ÿè¯¦æƒ…é¡µé¢æŸ¥çœ‹
5. **é¢„æœŸ**ï¼šå­ç³»ç»Ÿç‰©æ–™æ•°é‡ä¸º 20ï¼ˆå·²ä¿®æ”¹ï¼‰

### 2. å›å½’æµ‹è¯•

- âœ… å­é¡¹æ¨¡æ¿çš„å¢åˆ æ”¹æŸ¥
- âœ… å­ç³»ç»Ÿæ¨¡æ¿çš„å¢åˆ æ”¹æŸ¥
- âœ… ç‰©æ–™çš„å¢åˆ æ”¹æŸ¥
- âœ… å­é¡¹æ·»åŠ åˆ°å­ç³»ç»Ÿ
- âœ… å­é¡¹ä»å­ç³»ç»Ÿç§»é™¤

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

1. **ä»£ç è¿ç§»**
   - å»ºè®®åœ¨åç»­è¿­ä»£ä¸­å°†æ‰€æœ‰æ—§å‡½æ•°åæ›¿æ¢ä¸ºæ–°å‡½æ•°å
   - åœ¨ä¸€ä¸ªç‰ˆæœ¬åå¯è€ƒè™‘ç§»é™¤ deprecated å‡½æ•°

2. **ç±»å‹å®Œå–„**
   - `getItemTemplateMaterials` è¿”å›ç±»å‹åº”è¯¥ä» `any[]` æ”¹ä¸ºå…·ä½“ç±»å‹
   - å»ºè®®å®šä¹‰ `MaterialTemplateVO` ç±»å‹

3. **é”™è¯¯å¤„ç†**
   - æ·»åŠ æ›´å‹å¥½çš„é”™è¯¯æç¤º
   - å½“æŸ¥è¯¢å¤±è´¥æ—¶æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·åŸå› 

4. **æ€§èƒ½ä¼˜åŒ–**
   - è€ƒè™‘æ·»åŠ ç‰©æ–™åˆ—è¡¨çš„æœ¬åœ°ç¼“å­˜
   - é¿å…é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å­ç³»ç»Ÿç‰©æ–™æŸ¥è¯¢ API å¯¹æ¥æ–‡æ¡£](./å­ç³»ç»Ÿç‰©æ–™æŸ¥è¯¢APIå¯¹æ¥æ–‡æ¡£.md)
- [å­ç³»ç»Ÿç®¡ç†æ¨¡å—å®Œæ•´ API æ–‡æ¡£](./å­ç³»ç»Ÿç®¡ç†æ¨¡å—å®Œæ•´APIæ–‡æ¡£.md)
- [å­ç³»ç»Ÿç‰©æ–™ç®¡ç†å¿«é€Ÿå‚è€ƒ](./å­ç³»ç»Ÿç‰©æ–™ç®¡ç†å¿«é€Ÿå‚è€ƒ.md)

## âœ… ä¿®å¤éªŒè¯æ¸…å•

- [x] ä¿®å¤å­é¡¹æ¨¡æ¿ç®¡ç†é¡µé¢çš„æ¥å£è°ƒç”¨
- [x] ä¼˜åŒ– API å‡½æ•°å‘½å
- [x] æ·»åŠ è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜
- [x] ä¿æŒå‘åå…¼å®¹æ€§
- [x] æ›´æ–°æ–‡æ¡£
- [x] éªŒè¯å­ç³»ç»Ÿè¯¦æƒ…é¡µé¢æ¥å£è°ƒç”¨æ­£ç¡®
- [ ] è¿›è¡ŒåŠŸèƒ½æµ‹è¯•
- [ ] è¿›è¡Œå›å½’æµ‹è¯•
- [ ] ä»£ç å®¡æŸ¥
- [ ] éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2025-11-07  
**æ–‡æ¡£ç»´æŠ¤**ï¼šæµ·æ£ å¼€å‘å›¢é˜Ÿ

