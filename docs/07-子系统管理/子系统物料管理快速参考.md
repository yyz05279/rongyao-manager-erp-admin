# å­ç³»ç»Ÿç‰©æ–™ç®¡ç†å¿«é€Ÿå‚è€ƒ

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

**æ•°æ®éš”ç¦»**ï¼šä¸åŒå­ç³»ç»Ÿä¸­åŒä¸€å­é¡¹çš„ç‰©æ–™é…ç½®å®Œå…¨ç‹¬ç«‹ï¼Œé€šè¿‡ `template_id` + `item_template_id` å”¯ä¸€æ ‡è¯†

## ğŸ”‘ å…³é”®å­—æ®µ

| å­—æ®µ             | è¯´æ˜         | ä½œç”¨               |
| ---------------- | ------------ | ------------------ |
| `template_id`    | å­ç³»ç»Ÿæ¨¡æ¿ID | åŒºåˆ†ä¸åŒå­ç³»ç»Ÿ     |
| `item_template_id` | å­é¡¹æ¨¡æ¿ID | æ ‡è¯†å­é¡¹           |
| `material_id`    | ç‰©æ–™ID       | æ ‡è¯†ç‰©æ–™           |

## ğŸ“– ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå­ç³»ç»Ÿç®¡ç†é¡µé¢ï¼ˆæ•°æ®éš”ç¦»ï¼‰

**ä½ç½®**ï¼š`å­ç³»ç»Ÿç®¡ç† > å­é¡¹ç®¡ç† > ç‰©æ–™ç®¡ç†`

**ç‰¹ç‚¹**ï¼šåªæ“ä½œå½“å‰å­ç³»ç»Ÿçš„ç‰©æ–™ï¼Œä¸å½±å“å…¶ä»–å­ç³»ç»Ÿ

**æŸ¥è¯¢**ï¼š
```typescript
await listMaterialTemplateByItemId(itemId, templateId); // âœ… ä¼ é€’ templateId
```

**æ–°å¢**ï¼š
```typescript
{
  templateId: props.templateId,  // âœ… å¿…é¡»è®¾ç½®
  itemTemplateId: itemId,
  materialId: materialId,
  // ...
}
```

---

### åœºæ™¯2ï¼šå­é¡¹æ¨¡æ¿ç‹¬ç«‹ç®¡ç†ï¼ˆå…¨å±€è§†å›¾ï¼‰

**ä½ç½®**ï¼š`å­é¡¹æ¨¡æ¿ç®¡ç† > ç‰©æ–™ç®¡ç†`

**ç‰¹ç‚¹**ï¼šæŸ¥çœ‹è¯¥å­é¡¹åœ¨æ‰€æœ‰å­ç³»ç»Ÿä¸­çš„ç‰©æ–™ä½¿ç”¨æƒ…å†µ

**æŸ¥è¯¢**ï¼š
```typescript
await listMaterialTemplateByItemId(itemId); // âœ… ä¸ä¼ é€’ templateId
```

**æ–°å¢**ï¼š
```typescript
{
  // âœ… ä¸è®¾ç½® templateIdï¼ˆåˆ›å»ºç‹¬ç«‹ç‰©æ–™ï¼‰
  itemTemplateId: itemId,
  materialId: materialId,
  // ...
}
```

---

## ğŸ”§ æ“ä½œæ¸…å•

### âœ… æŸ¥è¯¢æ“ä½œ

**å­ç³»ç»Ÿä¸­æŸ¥è¯¢**ï¼ˆæ•°æ®éš”ç¦»ï¼‰ï¼š
```typescript
const response = await listMaterialTemplateByItemId(itemId, templateId);
```

**å…¨å±€æŸ¥è¯¢**ï¼ˆæ‰€æœ‰å­ç³»ç»Ÿï¼‰ï¼š
```typescript
const response = await listMaterialTemplateByItemId(itemId);
```

---

### âœ… æ–°å¢æ“ä½œ

**å…³è”åˆ°å­ç³»ç»Ÿ**ï¼š
```typescript
await addMaterialTemplateBatch([{
  templateId: templateId,        // âœ… å…³è”å­ç³»ç»Ÿ
  itemTemplateId: itemId,
  materialId: materialId,
  defaultQuantity: 1,
  isRequired: true,
  remarks: ''
}]);
```

**ç‹¬ç«‹ç‰©æ–™**ï¼š
```typescript
await addMaterialTemplateBatch([{
  // templateId ä¸è®¾ç½®           // âœ… ç‹¬ç«‹ç‰©æ–™
  itemTemplateId: itemId,
  materialId: materialId,
  defaultQuantity: 1,
  isRequired: true,
  remarks: ''
}]);
```

---

### âœ… ç¼–è¾‘æ“ä½œ

```typescript
// 1. å¤åˆ¶åŸæœ‰æ•°æ®ï¼ˆä¿ç•™ templateIdï¼‰
Object.assign(materialForm, row);

// 2. ä¿®æ”¹éœ€è¦çš„å­—æ®µ
materialForm.defaultQuantity = 10;

// 3. æäº¤æ›´æ–°
await updateMaterialTemplate(materialForm);
```

**æ³¨æ„**ï¼š
- âœ… ä¿æŒ `templateId` ä¸å˜
- âœ… ä¸æ”¹å˜ç‰©æ–™çš„å½’å±å…³ç³»

---

### âœ… åˆ é™¤æ“ä½œ

```typescript
await delMaterialTemplate(materialId);
```

**æ³¨æ„**ï¼š
- âœ… é€šè¿‡è®°å½•IDç²¾ç¡®åˆ é™¤
- âœ… åªåˆ é™¤å½“å‰è®°å½•ï¼Œä¸å½±å“å…¶ä»–å­ç³»ç»Ÿ

---

## âš ï¸ å¸¸è§é”™è¯¯

### âŒ é”™è¯¯1ï¼šæŸ¥è¯¢æ—¶å¿˜è®°ä¼ é€’ templateId

```typescript
// âŒ é”™è¯¯ï¼šä¼šæŸ¥è¯¢æ‰€æœ‰å­ç³»ç»Ÿçš„ç‰©æ–™
const response = await listMaterialTemplateByItemId(itemId);
```

**ä¿®å¤**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šåªæŸ¥è¯¢å½“å‰å­ç³»ç»Ÿçš„ç‰©æ–™
const response = await listMaterialTemplateByItemId(itemId, templateId);
```

---

### âŒ é”™è¯¯2ï¼šæ–°å¢æ—¶å¿˜è®°è®¾ç½® templateId

```typescript
// âŒ é”™è¯¯ï¼šåœ¨å­ç³»ç»Ÿé¡µé¢åˆ›å»ºäº†ç‹¬ç«‹ç‰©æ–™
{
  itemTemplateId: itemId,
  materialId: materialId,
  // templateId æœªè®¾ç½®
}
```

**ä¿®å¤**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šå…³è”åˆ°å½“å‰å­ç³»ç»Ÿ
{
  templateId: props.templateId,  // âœ… å¿…é¡»è®¾ç½®
  itemTemplateId: itemId,
  materialId: materialId,
}
```

---

### âŒ é”™è¯¯3ï¼šç¼–è¾‘æ—¶ä¸¢å¤± templateId

```typescript
// âŒ é”™è¯¯ï¼šæ‰‹åŠ¨æ„é€ è¡¨å•ï¼Œä¸¢å¤± templateId
materialForm.value = {
  id: row.id,
  materialId: row.materialId,
  defaultQuantity: row.defaultQuantity,
  // templateId ä¸¢å¤±
};
```

**ä¿®å¤**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šå¤åˆ¶æ‰€æœ‰å­—æ®µ
Object.assign(materialForm, row);
```

---

## ğŸ“Š æ•°æ®éš”ç¦»éªŒè¯

### æµ‹è¯•åœºæ™¯

1. **å‡†å¤‡**ï¼šå­é¡¹Aåˆ†åˆ«å…³è”åˆ°å­ç³»ç»ŸXå’Œå­ç³»ç»ŸY
2. **æ“ä½œ**ï¼šåœ¨å­ç³»ç»ŸXä¸­ä¸ºå­é¡¹Aæ·»åŠ ç‰©æ–™M1
3. **éªŒè¯**ï¼šåœ¨å­ç³»ç»ŸYä¸­æŸ¥çœ‹å­é¡¹Açš„ç‰©æ–™åˆ—è¡¨

**é¢„æœŸç»“æœ**ï¼š
- âœ… å­ç³»ç»ŸXä¸­æœ‰ç‰©æ–™M1
- âœ… å­ç³»ç»ŸYä¸­æ²¡æœ‰ç‰©æ–™M1
- âœ… ä¸¤ä¸ªå­ç³»ç»Ÿçš„ç‰©æ–™åˆ—è¡¨å®Œå…¨ç‹¬ç«‹

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æ£€æŸ¥æŸ¥è¯¢å‚æ•°

```typescript
console.log('æŸ¥è¯¢å‚æ•°:', {
  itemTemplateId: itemId,
  templateId: templateId  // âœ… åº”è¯¥æœ‰å€¼
});

const response = await listMaterialTemplateByItemId(itemId, templateId);
console.log('æŸ¥è¯¢ç»“æœ:', response.data);
```

### æ£€æŸ¥æ–°å¢æ•°æ®

```typescript
const materialTemplate = {
  templateId: props.templateId,  // âœ… æ‰“å°æ£€æŸ¥
  itemTemplateId: itemId,
  materialId: materialId,
  // ...
};

console.log('æ–°å¢ç‰©æ–™æ•°æ®:', materialTemplate);
await addMaterialTemplateBatch([materialTemplate]);
```

### æ£€æŸ¥æ•°æ®åº“è®°å½•

```sql
SELECT id, template_id, item_template_id, material_id, default_quantity
FROM erp_subsystem_material_template
WHERE item_template_id = ?
ORDER BY template_id, create_time DESC;
```

**é¢„æœŸ**ï¼š
- âœ… åŒä¸€ `item_template_id` çš„è®°å½•æœ‰ä¸åŒçš„ `template_id`
- âœ… æ¯ä¸ª `template_id` + `item_template_id` ç»„åˆçš„ç‰©æ–™åˆ—è¡¨ç‹¬ç«‹

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å­ç³»ç»Ÿç‰©æ–™å¢åˆ æ”¹æ“ä½œæ•°æ®éš”ç¦»ä¿®å¤.md](./å­ç³»ç»Ÿç‰©æ–™å¢åˆ æ”¹æ“ä½œæ•°æ®éš”ç¦»ä¿®å¤.md) - è¯¦ç»†ä¿®å¤è¯´æ˜
- [å­ç³»ç»Ÿç‰©æ–™æŸ¥è¯¢APIä½¿ç”¨æŒ‡å—.md](./å­ç³»ç»Ÿç‰©æ–™æŸ¥è¯¢APIä½¿ç”¨æŒ‡å—.md) - APIä½¿ç”¨è¯´æ˜
- [å­ç³»ç»Ÿç‰©æ–™ç‹¬ç«‹ç®¡ç†åŠŸèƒ½ä¿®å¤.md](./å­ç³»ç»Ÿç‰©æ–™ç‹¬ç«‹ç®¡ç†åŠŸèƒ½ä¿®å¤.md) - é—®é¢˜åˆ†æ

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **æŸ¥è¯¢æ—¶å¿…é¡»ä¼ é€’ templateId**ï¼ˆåœ¨å­ç³»ç»Ÿç®¡ç†é¡µé¢ï¼‰
2. **æ–°å¢æ—¶å¿…é¡»è®¾ç½® templateId**ï¼ˆåœ¨å­ç³»ç»Ÿç®¡ç†é¡µé¢ï¼‰
3. **ç¼–è¾‘æ—¶ä½¿ç”¨ Object.assign** ä¿ç•™æ‰€æœ‰å­—æ®µ
4. **åˆ é™¤å‰ç¡®è®¤æ•°æ®å½’å±** é¿å…è¯¯åˆ å…¶ä»–å­ç³»ç»Ÿçš„ç‰©æ–™
5. **æ·»åŠ æ—¥å¿—** æ–¹ä¾¿æ’æŸ¥é—®é¢˜

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®ä¿ï¼š

- [ ] æŸ¥è¯¢æ“ä½œä¼ é€’äº† `templateId` å‚æ•°ï¼ˆå­ç³»ç»Ÿé¡µé¢ï¼‰
- [ ] æ–°å¢æ“ä½œè®¾ç½®äº† `templateId` å­—æ®µï¼ˆå­ç³»ç»Ÿé¡µé¢ï¼‰
- [ ] ç¼–è¾‘æ“ä½œä¿ç•™äº†åŸæœ‰çš„ `templateId`
- [ ] åˆ é™¤æ“ä½œä¸ä¼šå½±å“å…¶ä»–å­ç³»ç»Ÿ
- [ ] æµ‹è¯•äº†æ•°æ®éš”ç¦»æ•ˆæœ
- [ ] ä»£ç é€šè¿‡äº† lint æ£€æŸ¥
- [ ] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Š

---

**æœ€åæ›´æ–°**ï¼š2025-11-06

