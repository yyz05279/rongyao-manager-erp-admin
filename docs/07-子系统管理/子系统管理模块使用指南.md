# 子系统管理模块 - 使用指南

## 目录

- [功能概述](#功能概述)
- [页面路由权限配置](#页面路由权限配置)
- [功能结构](#功能结构)
- [使用说明](#使用说明)
- [API 接口说明](#api接口说明)

## 功能概述

子系统管理模块是一个三级嵌套结构的管理系统，用于管理子系统、子项和物料信息。

**三级结构关系：**

```
子系统（Subsystem）
  └── 子项（SubItem）
        └── 物料（Material）
```

## 页面路由权限配置

### 1. 菜单配置示例

在系统管理后台的菜单管理中，按照以下结构配置菜单：

```
子系统管理（一级菜单）
  └── 子系统列表
        ├── 菜单名称：子系统列表
        ├── 路由地址：index
        ├── 组件路径：erp/subsystem/index
        ├── 权限标识：erp:subsystem:list
        └── 图标：list
```

### 2. 权限标识列表

#### 子系统管理权限

| 功能           | 权限标识               | 说明                             |
| -------------- | ---------------------- | -------------------------------- |
| 子系统列表查询 | `erp:subsystem:list`   | 查看子系统列表                   |
| 子系统详情查询 | `erp:subsystem:query`  | 查看子系统详情                   |
| 新增子系统     | `erp:subsystem:add`    | 创建新的子系统                   |
| 修改子系统     | `erp:subsystem:edit`   | 编辑子系统信息                   |
| 删除子系统     | `erp:subsystem:remove` | 删除子系统（级联删除子项和物料） |
| 导出子系统     | `erp:subsystem:export` | 导出子系统数据                   |

#### 子项管理权限

| 功能         | 权限标识                       | 说明                     |
| ------------ | ------------------------------ | ------------------------ |
| 子项列表查询 | `erp:subsystem:subitem:list`   | 查看子项列表             |
| 子项详情查询 | `erp:subsystem:subitem:query`  | 查看子项详情             |
| 新增子项     | `erp:subsystem:subitem:add`    | 创建新的子项             |
| 修改子项     | `erp:subsystem:subitem:edit`   | 编辑子项信息             |
| 删除子项     | `erp:subsystem:subitem:remove` | 删除子项（级联删除物料） |

#### 物料管理权限

| 功能         | 权限标识                        | 说明         |
| ------------ | ------------------------------- | ------------ |
| 物料列表查询 | `erp:subsystem:material:list`   | 查看物料列表 |
| 物料详情查询 | `erp:subsystem:material:query`  | 查看物料详情 |
| 新增物料     | `erp:subsystem:material:add`    | 创建新的物料 |
| 修改物料     | `erp:subsystem:material:edit`   | 编辑物料信息 |
| 删除物料     | `erp:subsystem:material:remove` | 删除物料     |
| 导出物料     | `erp:subsystem:material:export` | 导出物料数据 |

### 3. 角色权限配置示例

在系统管理后台的角色管理中，为不同角色分配相应权限：

#### 管理员角色（完全权限）

```
✓ erp:subsystem:list
✓ erp:subsystem:query
✓ erp:subsystem:add
✓ erp:subsystem:edit
✓ erp:subsystem:remove
✓ erp:subsystem:export
✓ erp:subsystem:subitem:list
✓ erp:subsystem:subitem:query
✓ erp:subsystem:subitem:add
✓ erp:subsystem:subitem:edit
✓ erp:subsystem:subitem:remove
✓ erp:subsystem:material:list
✓ erp:subsystem:material:query
✓ erp:subsystem:material:add
✓ erp:subsystem:material:edit
✓ erp:subsystem:material:remove
✓ erp:subsystem:material:export
```

#### 普通用户角色（只读权限）

```
✓ erp:subsystem:list
✓ erp:subsystem:query
✓ erp:subsystem:subitem:list
✓ erp:subsystem:subitem:query
✓ erp:subsystem:material:list
✓ erp:subsystem:material:query
```

#### 编辑员角色（编辑权限，无删除）

```
✓ erp:subsystem:list
✓ erp:subsystem:query
✓ erp:subsystem:add
✓ erp:subsystem:edit
✓ erp:subsystem:export
✓ erp:subsystem:subitem:list
✓ erp:subsystem:subitem:query
✓ erp:subsystem:subitem:add
✓ erp:subsystem:subitem:edit
✓ erp:subsystem:material:list
✓ erp:subsystem:material:query
✓ erp:subsystem:material:add
✓ erp:subsystem:material:edit
✓ erp:subsystem:material:export
```

### 4. 前端路由配置

子系统管理作为独立的一级菜单，路由配置在 `/src/router/modules/subsystem.ts` 中：

```typescript
{
  path: '/subsystem',
  component: Layout,
  redirect: '/subsystem/index',
  name: 'Subsystem',
  meta: {
    title: '子系统管理',
    icon: 'component',
    alwaysShow: true
  },
  children: [
    {
      path: 'index',
      component: () => import('@/views/erp/subsystem/index.vue'),
      name: 'SubsystemManagement',
      meta: {
        title: '子系统列表',
        icon: 'list'
      },
      permissions: ['erp:subsystem:list']
    }
  ]
}
```

### 5. 菜单数据库配置示例（SQL）

如果需要直接在数据库中配置菜单，可参考以下 SQL 语句：

```sql
-- 1. 插入子系统管理一级菜单（parent_id为0表示一级菜单）
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
VALUES ('子系统管理', 0, 3, 'subsystem', NULL, 1, 0, 'M', '0', '0', NULL, 'component', 'admin', NOW(), '', NULL, '子系统管理一级菜单');

-- 获取刚插入的一级菜单ID
SET @subsystem_parent_id = LAST_INSERT_ID();

-- 2. 插入子系统列表子菜单
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
VALUES ('子系统列表', @subsystem_parent_id, 1, 'index', 'erp/subsystem/index', 1, 0, 'C', '0', '0', 'erp:subsystem:list', 'list', 'admin', NOW(), '', NULL, '子系统列表菜单');

-- 获取子系统列表菜单ID
SET @subsystem_menu_id = LAST_INSERT_ID();

-- 3. 插入子系统管理按钮权限
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
VALUES
('子系统查询', @subsystem_menu_id, 1, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:query', '#', 'admin', NOW(), '', NULL, ''),
('子系统新增', @subsystem_menu_id, 2, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:add', '#', 'admin', NOW(), '', NULL, ''),
('子系统修改', @subsystem_menu_id, 3, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:edit', '#', 'admin', NOW(), '', NULL, ''),
('子系统删除', @subsystem_menu_id, 4, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:remove', '#', 'admin', NOW(), '', NULL, ''),
('子系统导出', @subsystem_menu_id, 5, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:export', '#', 'admin', NOW(), '', NULL, '');

-- 4. 插入子项管理按钮权限
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
VALUES
('子项查询', @subsystem_menu_id, 11, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:subitem:query', '#', 'admin', NOW(), '', NULL, ''),
('子项新增', @subsystem_menu_id, 12, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:subitem:add', '#', 'admin', NOW(), '', NULL, ''),
('子项修改', @subsystem_menu_id, 13, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:subitem:edit', '#', 'admin', NOW(), '', NULL, ''),
('子项删除', @subsystem_menu_id, 14, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:subitem:remove', '#', 'admin', NOW(), '', NULL, '');

-- 5. 插入物料管理按钮权限
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
VALUES
('物料查询', @subsystem_menu_id, 21, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:material:query', '#', 'admin', NOW(), '', NULL, ''),
('物料新增', @subsystem_menu_id, 22, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:material:add', '#', 'admin', NOW(), '', NULL, ''),
('物料修改', @subsystem_menu_id, 23, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:material:edit', '#', 'admin', NOW(), '', NULL, ''),
('物料删除', @subsystem_menu_id, 24, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:material:remove', '#', 'admin', NOW(), '', NULL, ''),
('物料导出', @subsystem_menu_id, 25, '#', '', 1, 0, 'F', '0', '0', 'erp:subsystem:material:export', '#', 'admin', NOW(), '', NULL, '');
```

## 功能结构

### 文件结构

```
src/
├── api/
│   └── erp/
│       └── subsystem/
│           ├── index.ts          # API接口定义
│           └── types.ts          # TypeScript类型定义
├── views/
│   └── erp/
│       └── subsystem/
│           ├── index.vue                         # 主列表页面
│           └── components/
│               ├── SubsystemForm.vue            # 子系统表单
│               ├── SubsystemDetail.vue          # 子系统详情（含子项和物料）
│               ├── SubItemForm.vue              # 子项表单
│               └── MaterialForm.vue             # 物料表单
└── router/
    └── modules/
        └── saltprocess.ts        # 路由配置（已添加子系统管理路由）
```

## 使用说明

### 1. 子系统管理

#### 新增子系统

1. 点击"新增子系统"按钮
2. 填写子系统信息：
   - 子系统编码（必填）
   - 子系统名称（必填）
   - 关联项目（可选）
   - 状态（启用/禁用）
   - 描述
   - 备注
3. 点击"确定"保存

#### 查看子系统详情

- 点击表格行或"查看详情"按钮
- 查看子系统基本信息、子项列表和物料列表

#### 编辑子系统

- 点击"编辑"按钮
- 修改子系统信息
- 点击"确定"保存

#### 删除子系统

- 选择要删除的子系统
- 点击"删除"按钮
- 确认删除操作
- **注意：删除子系统会级联删除其下的所有子项和物料**

### 2. 子项管理

#### 新增子项

1. 在子系统详情页面点击"新增子项"按钮
2. 填写子项信息：
   - 子项编码（必填）
   - 子项名称（必填）
   - 描述
   - 备注
3. 点击"确定"保存

#### 编辑子项

- 在子项卡片上点击"编辑"按钮
- 修改子项信息
- 点击"确定"保存

#### 删除子项

- 在子项卡片上点击"删除"按钮
- 确认删除操作
- **注意：删除子项会级联删除其下的所有物料**

### 3. 物料管理

#### 新增物料

1. 在子项卡片上点击"添加物料"按钮
2. 填写物料信息：
   - 基本信息：物料编码、物料名称、规格型号、单位
   - 数量信息：数量、单重、总重、单体积、总体积
   - 生产信息：制造商、型号、序列号、生产日期
   - 特殊属性：是否易碎品、是否危险品、包装方式
   - 备注信息
3. 点击"确定"保存

**智能计算功能：**

- 输入单重和数量后，系统自动计算总重
- 输入单体积和数量后，系统自动计算总体积

#### 编辑物料

- 在物料列表中点击"编辑"按钮
- 修改物料信息
- 点击"确定"保存

#### 删除物料

- 在物料列表中点击"删除"按钮
- 确认删除操作

## API 接口说明

### 基础 URL

```
/erp/subsystem
```

### 子系统接口

| 接口         | 方法   | 路径           | 说明                               |
| ------------ | ------ | -------------- | ---------------------------------- |
| 查询列表     | GET    | `/list`        | 分页查询子系统列表                 |
| 获取详情     | GET    | `/{id}`        | 获取子系统基本信息                 |
| 获取完整详情 | GET    | `/{id}/detail` | 获取子系统完整信息（含子项和物料） |
| 新增         | POST   | `/`            | 新增子系统                         |
| 修改         | PUT    | `/`            | 修改子系统                         |
| 删除         | DELETE | `/{ids}`       | 删除子系统                         |
| 导出         | GET    | `/export`      | 导出子系统列表                     |
| 统计信息     | GET    | `/statistics`  | 获取统计信息                       |

### 子项接口

| 接口     | 方法   | 路径             | 说明         |
| -------- | ------ | ---------------- | ------------ |
| 查询列表 | GET    | `/subitem/list`  | 查询子项列表 |
| 获取详情 | GET    | `/subitem/{id}`  | 获取子项详情 |
| 新增     | POST   | `/subitem`       | 新增子项     |
| 修改     | PUT    | `/subitem`       | 修改子项     |
| 删除     | DELETE | `/subitem/{ids}` | 删除子项     |

### 物料接口

| 接口     | 方法   | 路径               | 说明         |
| -------- | ------ | ------------------ | ------------ |
| 查询列表 | GET    | `/material/list`   | 查询物料列表 |
| 获取详情 | GET    | `/material/{id}`   | 获取物料详情 |
| 新增     | POST   | `/material`        | 新增物料     |
| 修改     | PUT    | `/material`        | 修改物料     |
| 删除     | DELETE | `/material/{ids}`  | 删除物料     |
| 导出     | GET    | `/material/export` | 导出物料列表 |

## 数据模型

### 子系统（Subsystem）

```typescript
{
  id: string;                    // 主键ID
  subsystemCode: string;         // 子系统编码
  subsystemName: string;         // 子系统名称
  projectId?: string;            // 项目ID
  projectName?: string;          // 项目名称
  status: number;                // 状态（0-禁用，1-启用）
  description?: string;          // 描述
  subItemCount?: number;         // 子项数量
  materialCount?: number;        // 物料总数
  totalWeight?: number;          // 总重量(kg)
  totalVolume?: number;          // 总体积(m³)
  remark?: string;               // 备注
  createBy?: string;             // 创建人
  createTime?: string;           // 创建时间
  updateBy?: string;             // 更新人
  updateTime?: string;           // 更新时间
}
```

### 子项（SubItem）

```typescript
{
  id: string;                    // 主键ID
  subsystemId: string;           // 子系统ID
  subsystemName?: string;        // 子系统名称
  subItemCode: string;           // 子项编码
  subItemName: string;           // 子项名称
  description?: string;          // 描述
  materialCount?: number;        // 物料数量
  totalWeight?: number;          // 总重量(kg)
  totalVolume?: number;          // 总体积(m³)
  remark?: string;               // 备注
  createBy?: string;             // 创建人
  createTime?: string;           // 创建时间
  updateBy?: string;             // 更新人
  updateTime?: string;           // 更新时间
}
```

### 物料（Material）

```typescript
{
  id: string;                    // 主键ID
  subItemId: string;             // 子项ID
  subItemName?: string;          // 子项名称
  materialCode: string;          // 物料编码
  materialName: string;          // 物料名称
  specification?: string;        // 规格型号
  quantity?: number;             // 数量
  unit?: string;                 // 单位
  unitWeight?: number;           // 单重(kg)
  totalWeight?: number;          // 总重(kg)
  unitVolume?: number;           // 单体积(m³)
  totalVolume?: number;          // 总体积(m³)
  manufacturer?: string;         // 制造商
  model?: string;                // 型号
  serialNumber?: string;         // 序列号
  productionDate?: string;       // 生产日期
  isFragile: number;             // 是否易碎品（0-否，1-是）
  isHazardous: number;           // 是否危险品（0-否，1-是）
  packagingMethod?: string;      // 包装方式
  remarks?: string;              // 备注
  createBy?: string;             // 创建人
  createTime?: string;           // 创建时间
  updateBy?: string;             // 更新人
  updateTime?: string;           // 更新时间
}
```

## 注意事项

1. **级联删除**：删除子系统会级联删除其下的所有子项和物料，删除子项会级联删除其下的所有物料，请谨慎操作。

2. **权限控制**：确保在后台正确配置了菜单权限和按钮权限，否则用户可能无法访问相应功能。

3. **数据关联**：子系统可以关联项目，子项必须归属于某个子系统，物料必须归属于某个子项。

4. **自动计算**：物料的总重量和总体积可以根据单重/单体积和数量自动计算。

5. **数据导出**：支持导出子系统列表和物料列表为 Excel 文件。

## 技术支持

如有问题，请联系技术支持团队。
