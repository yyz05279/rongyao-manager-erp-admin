openapi: 3.0.3
info:
  title: 财务管理API接口规范
  description: |
    基于RuoYi-Vue-Plus架构的财务管理模块API接口规范
    包含付款单和收款单的完整业务流程管理
  version: 1.0.0
  contact:
    name: 开发团队
    email: dev@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080/api
    description: 开发环境
  - url: https://api.example.com
    description: 生产环境

security:
  - bearerAuth: []

tags:
  - name: 付款单管理
    description: 付款单相关接口
  - name: 收款单管理
    description: 收款单相关接口
  - name: 基础数据
    description: 基础数据查询接口

paths:
  # 付款单接口
  /erp/finance/payment/list:
    get:
      tags:
        - 付款单管理
      summary: 查询付款单列表
      description: 分页查询付款单列表，支持多种筛选条件
      parameters:
        - name: pageNum
          in: query
          description: 页码
          required: false
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: pageSize
          in: query
          description: 每页数量
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: no
          in: query
          description: 付款单编号
          required: false
          schema:
            type: string
        - name: status
          in: query
          description: 付款状态
          required: false
          schema:
            type: integer
            enum: [0, 1, 2, 3, 4, 5]
        - name: supplierId
          in: query
          description: 供应商ID
          required: false
          schema:
            type: integer
        - name: supplierName
          in: query
          description: 供应商名称
          required: false
          schema:
            type: string
        - name: paymentTimeRange
          in: query
          description: 付款时间范围
          required: false
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
              format: date-time
            minItems: 2
            maxItems: 2
        - name: keyword
          in: query
          description: 关键字搜索
          required: false
          schema:
            type: string
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PageResult'
              example:
                code: 200
                msg: "查询成功"
                data:
                  rows:
                    - id: 1
                      no: "FK202401001"
                      status: 4
                      supplierName: "北京科技有限公司"
                      totalAmount: 150000.00
                      paymentTime: "2024-01-15 14:30:00"
                  total: 25
                  pageNum: 1
                  pageSize: 10
                  pages: 3
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /erp/finance/payment/{id}:
    get:
      tags:
        - 付款单管理
      summary: 查询付款单详情
      description: 根据ID查询付款单详细信息
      parameters:
        - name: id
          in: path
          description: 付款单ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentVO'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - 付款单管理
      summary: 删除付款单
      description: 根据ID删除付款单（支持批量删除）
      parameters:
        - name: id
          in: path
          description: 付款单ID（多个ID用逗号分隔）
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /erp/finance/payment:
    post:
      tags:
        - 付款单管理
      summary: 新增付款单
      description: 创建新的付款单
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentForm'
            example:
              supplierId: 1
              accountId: 1
              paymentMethod: "BANK_TRANSFER"
              paymentTime: "2024-01-20 10:00:00"
              totalAmount: 100000.00
              businessType: "设备采购"
              remark: "设备采购款"
              items:
                - subjectCode: "1001"
                  subjectName: "原材料"
                  amount: 100000.00
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
    put:
      tags:
        - 付款单管理
      summary: 修改付款单
      description: 更新付款单信息
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentForm'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /erp/finance/payment/{id}/submit:
    post:
      tags:
        - 付款单管理
      summary: 提交付款单审批
      description: 将付款单提交审批
      parameters:
        - name: id
          in: path
          description: 付款单ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 提交成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /erp/finance/payment/approve:
    post:
      tags:
        - 付款单管理
      summary: 审批付款单
      description: 审批或拒绝付款单
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentApprovalForm'
            example:
              id: 1
              action: "APPROVE"
              comment: "审批通过"
      responses:
        '200':
          description: 审批成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /erp/finance/payment/statistics:
    get:
      tags:
        - 付款单管理
      summary: 获取付款单统计
      description: 获取付款单统计信息
      parameters:
        - name: status
          in: query
          description: 状态筛选
          required: false
          schema:
            type: integer
        - name: createTimeRange
          in: query
          description: 创建时间范围
          required: false
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
              format: date-time
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentStatistics'

  # 收款单接口
  /erp/finance/receipt/list:
    get:
      tags:
        - 收款单管理
      summary: 查询收款单列表
      description: 分页查询收款单列表，支持多种筛选条件
      parameters:
        - name: pageNum
          in: query
          description: 页码
          required: false
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          description: 每页数量
          required: false
          schema:
            type: integer
            default: 10
        - name: no
          in: query
          description: 收款单编号
          required: false
          schema:
            type: string
        - name: status
          in: query
          description: 收款状态
          required: false
          schema:
            type: integer
        - name: customerId
          in: query
          description: 客户ID
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PageResult'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ApiResponse:
      type: object
      properties:
        code:
          type: integer
          description: 状态码
          example: 200
        msg:
          type: string
          description: 消息
          example: "操作成功"
        data:
          type: object
          description: 数据
        timestamp:
          type: integer
          description: 时间戳
          example: 1640995200000

    PageResult:
      type: object
      properties:
        rows:
          type: array
          items:
            type: object
          description: 数据列表
        total:
          type: integer
          description: 总记录数
        pageNum:
          type: integer
          description: 当前页码
        pageSize:
          type: integer
          description: 每页数量
        pages:
          type: integer
          description: 总页数

    PaymentVO:
      type: object
      properties:
        id:
          type: integer
          description: 付款单ID
        no:
          type: string
          description: 付款单编号
        status:
          type: integer
          enum: [0, 1, 2, 3, 4, 5]
          description: 付款状态（0-草稿，1-待审批，2-已审批，3-已拒绝，4-已付款，5-已取消）
        supplierId:
          type: integer
          description: 供应商ID
        supplierName:
          type: string
          description: 供应商名称
        accountId:
          type: integer
          description: 结算账户ID
        accountName:
          type: string
          description: 账户名称
        paymentMethod:
          type: string
          enum: [CASH, BANK_TRANSFER, CHECK, ELECTRONIC, OTHER]
          description: 付款方式
        paymentTime:
          type: string
          format: date-time
          description: 付款时间
        totalAmount:
          type: number
          format: decimal
          description: 合计金额
        paidAmount:
          type: number
          format: decimal
          description: 已付金额
        currency:
          type: string
          description: 币种
          default: CNY
        invoiceNo:
          type: string
          description: 发票号码
        contractNo:
          type: string
          description: 合同编号
        businessType:
          type: string
          description: 业务类型
        remark:
          type: string
          description: 备注
        items:
          type: array
          items:
            $ref: '#/components/schemas/PaymentItemVO'
          description: 付款明细
        createTime:
          type: string
          format: date-time
          description: 创建时间
        createByName:
          type: string
          description: 创建人

    PaymentItemVO:
      type: object
      properties:
        id:
          type: integer
          description: 明细ID
        subjectCode:
          type: string
          description: 科目编码
        subjectName:
          type: string
          description: 科目名称
        amount:
          type: number
          format: decimal
          description: 金额
        remark:
          type: string
          description: 备注

    PaymentForm:
      type: object
      required:
        - supplierId
        - accountId
        - paymentMethod
        - paymentTime
        - totalAmount
        - items
      properties:
        id:
          type: integer
          description: 付款单ID（更新时必填）
        supplierId:
          type: integer
          description: 供应商ID
        accountId:
          type: integer
          description: 结算账户ID
        paymentMethod:
          type: string
          enum: [CASH, BANK_TRANSFER, CHECK, ELECTRONIC, OTHER]
          description: 付款方式
        paymentTime:
          type: string
          format: date-time
          description: 付款时间
        totalAmount:
          type: number
          format: decimal
          minimum: 0.01
          description: 合计金额
        currency:
          type: string
          description: 币种
          default: CNY
        invoiceNo:
          type: string
          description: 发票号码
        contractNo:
          type: string
          description: 合同编号
        businessType:
          type: string
          description: 业务类型
        urgencyLevel:
          type: integer
          minimum: 1
          maximum: 5
          description: 紧急程度（1-5级）
        remark:
          type: string
          description: 备注
        items:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - subjectCode
              - subjectName
              - amount
            properties:
              subjectCode:
                type: string
                description: 科目编码
              subjectName:
                type: string
                description: 科目名称
              amount:
                type: number
                format: decimal
                minimum: 0.01
                description: 金额
              remark:
                type: string
                description: 备注

    PaymentApprovalForm:
      type: object
      required:
        - id
        - action
      properties:
        id:
          type: integer
          description: 付款单ID
        action:
          type: string
          enum: [APPROVE, REJECT]
          description: 审批动作
        comment:
          type: string
          description: 审批意见

    PaymentStatistics:
      type: object
      properties:
        totalCount:
          type: integer
          description: 总数量
        totalAmount:
          type: number
          format: decimal
          description: 总金额
        paidAmount:
          type: number
          format: decimal
          description: 已付金额
        pendingAmount:
          type: number
          format: decimal
          description: 待付金额
        statusStatistics:
          type: array
          items:
            type: object
            properties:
              status:
                type: integer
                description: 状态
              count:
                type: integer
                description: 数量
              amount:
                type: number
                format: decimal
                description: 金额
        monthlyStatistics:
          type: array
          items:
            type: object
            properties:
              month:
                type: string
                description: 月份
              count:
                type: integer
                description: 数量
              amount:
                type: number
                format: decimal
                description: 金额

  responses:
    BadRequest:
      description: 请求参数错误
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            code: 400
            msg: "请求参数错误"
            data: null

    Unauthorized:
      description: 未授权访问
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            code: 401
            msg: "未授权访问"
            data: null

    NotFound:
      description: 资源不存在
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            code: 404
            msg: "资源不存在"
            data: null

    InternalServerError:
      description: 服务器内部错误
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            code: 500
            msg: "服务器内部错误"
            data: null
