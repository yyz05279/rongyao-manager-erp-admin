# 物料模板删除接口更新说明

## 更新概述

本次更新将物料模板删除功能从旧的单个删除接口迁移到新的批量删除接口，提升了接口的统一性和扩展性。

## 接口变更

### 旧接口
- **路径**: `DELETE /erp/subsystem/material-template/{id}`
- **示例**: `DELETE /erp/subsystem/material-template/1991414019012923393`
- **特点**: 只支持单个物料删除

### 新接口
- **路径**: `DELETE /erp/subsystem/item-template/{itemTemplateId}/materials/{ids}`
- **参数说明**:
  - `itemTemplateId`: 子项模板ID（路径参数）
  - `ids`: 物料ID列表，多个ID用逗号分隔（路径参数）
- **特点**: 支持单个和批量删除

## 代码更改

### 1. API接口层更新

#### 文件: `src/api/erp/subsystem/item-template.ts`

已有新接口定义（无需修改）：

```typescript
/**
 * 删除子项模板的物料
 * @param itemTemplateId 子项模板ID
 * @param ids 物料ID数组
 */
export const deleteItemMaterials = (
  itemTemplateId: number,
  ids: number[]
): AxiosPromise<void> => {
  const idStr = ids.join(',');
  return request({
    url: `/erp/subsystem/item-template/${itemTemplateId}/materials/${idStr}`,
    method: 'delete'
  });
};
```

### 2. 页面组件更新

#### 文件: `src/views/erp/subsystem/item-template/index.vue`

**更新内容**:

1. **导入更新**:
```typescript
// 移除旧接口导入
- import { delMaterialTemplate } from '@/api/erp/subsystem/material-template';

// 添加新接口导入
+ import { deleteItemMaterials } from '@/api/erp/subsystem/item-template';
```

2. **删除物料函数更新**:
```typescript
// 旧代码
- await delMaterialTemplate(row.id);

// 新代码
+ await deleteItemMaterials(Number(materialDialog.itemId), [Number(row.id)]);
```

3. **同步物料变更函数更新**:
```typescript
// 旧代码
- await delMaterialTemplate(deleteIds);

// 新代码
+ await deleteItemMaterials(Number(itemTemplateId), deleteIds);
```

#### 文件: `src/views/erp/subsystem/template/components/ItemTemplateManagement.vue`

**更新内容**:

1. **导入更新**:
```typescript
// 移除旧接口导入
- import { delMaterialTemplate } from '@/api/erp/subsystem/material-template';

// 添加新接口导入
+ import { deleteItemMaterials } from '@/api/erp/subsystem/item-template';
```

2. **删除物料函数更新**:
```typescript
// 旧代码（子系统模式）
- await delMaterialTemplate(row.id);

// 新代码（子系统模式）
+ await deleteItemMaterials(Number(selectedItemId.value), [Number(row.id)]);
```

3. **同步物料变更函数更新**:
```typescript
// 旧代码
- await delMaterialTemplate(deleteIds);

// 新代码
+ await deleteItemMaterials(Number(itemTemplateId), deleteIds.map(id => Number(id)));
```

## 功能特性

### 1. 支持单个删除
```typescript
// 删除单个物料
await deleteItemMaterials(10, [1]);
```

### 2. 支持批量删除
```typescript
// 删除多个物料
await deleteItemMaterials(10, [1, 2, 3]);
```

### 3. 用户提示优化
- 单个删除：显示物料名称
- 批量删除：显示多个物料名称（用顿号分隔）

## 兼容性说明

- ✅ 保持了原有的删除确认提示
- ✅ 保持了原有的成功/失败消息提示
- ✅ 保持了原有的列表刷新逻辑
- ✅ 支持设备系统模式和子系统模式的双重API调用

## 测试建议

### 1. 功能测试
- [ ] 测试单个物料删除功能
- [ ] 测试批量物料删除功能（如果支持）
- [ ] 测试删除确认提示是否正常显示
- [ ] 测试删除成功后列表是否正确刷新

### 2. 异常测试
- [ ] 测试删除不存在的物料ID
- [ ] 测试删除时网络异常的处理
- [ ] 测试取消删除操作

### 3. 界面测试
- [ ] 验证删除按钮的显示和禁用状态
- [ ] 验证删除成功/失败的提示信息
- [ ] 验证删除后的数据一致性

## 注意事项

1. **类型转换**: 新接口要求 `itemTemplateId` 和 `ids` 都是 `number` 类型，代码中已添加 `Number()` 转换
2. **数组格式**: 即使删除单个物料，也需要传递数组格式 `[id]`
3. **错误处理**: 保持了原有的错误处理逻辑，用户取消操作不会显示错误提示

## 相关文档

- [子项模板物料管理API更新文档](./07-子系统管理/子项模板物料管理API更新文档.md)
- [设备系统模版物料编辑删除接口文档](./08-项目设备系统管理/设备系统模版物料编辑删除接口文档.md)

## 更新日期

2025-11-20

